var X=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var W=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};var V=(i,t,e)=>(X(i,t,"access private method"),e);import{F as FontFaceObserver}from"./index.d2b5948f.js";import"https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js";import"https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TimelineLite.min.js";var PI_OVER_180=Math.PI/180;function detectBrowser(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}const glob=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},Konva$3={_global:glob,version:"8.4.3",isBrowser:detectBrowser(),isUnminified:/param/.test(function(i){}.toString()),dblClickWindow:400,getAngle(i){return Konva$3.angleDeg?i*PI_OVER_180:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return Konva$3.DD.isDragging},isDragReady(){return!!Konva$3.DD.node},releaseCanvasOnDestroy:!0,document:glob.document,_injectGlobal(i){glob.Konva=i}},_registerNode=i=>{Konva$3[i.prototype.getClassName()]=i};Konva$3._injectGlobal(Konva$3);class Transform{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new Transform(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){var e=Math.cos(t),r=Math.sin(t),n=this.m[0]*e+this.m[2]*r,a=this.m[1]*e+this.m[3]*r,o=this.m[0]*-r+this.m[2]*e,h=this.m[1]*-r+this.m[3]*e;return this.m[0]=n,this.m[1]=a,this.m[2]=o,this.m[3]=h,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){var r=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,a=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=r,this.m[1]=n,this.m[2]=a,this.m[3]=o,this}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],r=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],h=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=h,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,r=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),h=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=r,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=h,this}getMatrix(){return this.m}decompose(){var t=this.m[0],e=this.m[1],r=this.m[2],n=this.m[3],a=this.m[4],o=this.m[5],h=t*n-e*r;let l={x:a,y:o,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!=0||e!=0){var d=Math.sqrt(t*t+e*e);l.rotation=e>0?Math.acos(t/d):-Math.acos(t/d),l.scaleX=d,l.scaleY=h/d,l.skewX=(t*r+e*n)/h,l.skewY=0}else if(r!=0||n!=0){var u=Math.sqrt(r*r+n*n);l.rotation=Math.PI/2-(n>0?Math.acos(-r/u):-Math.acos(r/u)),l.scaleX=h/u,l.scaleY=u,l.skewX=0,l.skewY=(t*r+e*n)/h}return l.rotation=Util._getRotation(l.rotation),l}}var OBJECT_ARRAY="[object Array]",OBJECT_NUMBER="[object Number]",OBJECT_STRING="[object String]",OBJECT_BOOLEAN="[object Boolean]",PI_OVER_DEG180=Math.PI/180,DEG180_OVER_PI=180/Math.PI,HASH$1="#",EMPTY_STRING$1="",ZERO="0",KONVA_WARNING="Konva warning: ",KONVA_ERROR="Konva error: ",RGB_PAREN="rgb(",COLORS={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},RGB_REGEX=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,animQueue=[];const req=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(i){setTimeout(i,60)},Util={_isElement(i){return!!(i&&i.nodeType==1)},_isFunction(i){return!!(i&&i.constructor&&i.call&&i.apply)},_isPlainObject(i){return!!i&&i.constructor===Object},_isArray(i){return Object.prototype.toString.call(i)===OBJECT_ARRAY},_isNumber(i){return Object.prototype.toString.call(i)===OBJECT_NUMBER&&!isNaN(i)&&isFinite(i)},_isString(i){return Object.prototype.toString.call(i)===OBJECT_STRING},_isBoolean(i){return Object.prototype.toString.call(i)===OBJECT_BOOLEAN},isObject(i){return i instanceof Object},isValidSelector(i){if(typeof i!="string")return!1;var t=i[0];return t==="#"||t==="."||t===t.toUpperCase()},_sign(i){return i===0||i>0?1:-1},requestAnimFrame(i){animQueue.push(i),animQueue.length===1&&req(function(){const t=animQueue;animQueue=[],t.forEach(function(e){e()})})},createCanvasElement(){var i=document.createElement("canvas");try{i.style=i.style||{}}catch{}return i},createImageElement(){return document.createElement("img")},_isInDocument(i){for(;i=i.parentNode;)if(i==document)return!0;return!1},_urlToImage(i,t){var e=Util.createImageElement();e.onload=function(){t(e)},e.src=i},_rgbToHex(i,t,e){return((1<<24)+(i<<16)+(t<<8)+e).toString(16).slice(1)},_hexToRgb(i){i=i.replace(HASH$1,EMPTY_STRING$1);var t=parseInt(i,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},getRandomColor(){for(var i=(Math.random()*16777215<<0).toString(16);i.length<6;)i=ZERO+i;return HASH$1+i},getRGB(i){var t;return i in COLORS?(t=COLORS[i],{r:t[0],g:t[1],b:t[2]}):i[0]===HASH$1?this._hexToRgb(i.substring(1)):i.substr(0,4)===RGB_PAREN?(t=RGB_REGEX.exec(i.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},colorToRGBA(i){return i=i||"black",Util._namedColorToRBA(i)||Util._hex3ColorToRGBA(i)||Util._hex4ColorToRGBA(i)||Util._hex6ColorToRGBA(i)||Util._hex8ColorToRGBA(i)||Util._rgbColorToRGBA(i)||Util._rgbaColorToRGBA(i)||Util._hslColorToRGBA(i)},_namedColorToRBA(i){var t=COLORS[i.toLowerCase()];return t?{r:t[0],g:t[1],b:t[2],a:1}:null},_rgbColorToRGBA(i){if(i.indexOf("rgb(")===0){i=i.match(/rgb\(([^)]+)\)/)[1];var t=i.split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:1}}},_rgbaColorToRGBA(i){if(i.indexOf("rgba(")===0){i=i.match(/rgba\(([^)]+)\)/)[1];var t=i.split(/ *, */).map((e,r)=>e.slice(-1)==="%"?r===3?parseInt(e)/100:parseInt(e)/100*255:Number(e));return{r:t[0],g:t[1],b:t[2],a:t[3]}}},_hex8ColorToRGBA(i){if(i[0]==="#"&&i.length===9)return{r:parseInt(i.slice(1,3),16),g:parseInt(i.slice(3,5),16),b:parseInt(i.slice(5,7),16),a:parseInt(i.slice(7,9),16)/255}},_hex6ColorToRGBA(i){if(i[0]==="#"&&i.length===7)return{r:parseInt(i.slice(1,3),16),g:parseInt(i.slice(3,5),16),b:parseInt(i.slice(5,7),16),a:1}},_hex4ColorToRGBA(i){if(i[0]==="#"&&i.length===5)return{r:parseInt(i[1]+i[1],16),g:parseInt(i[2]+i[2],16),b:parseInt(i[3]+i[3],16),a:parseInt(i[4]+i[4],16)/255}},_hex3ColorToRGBA(i){if(i[0]==="#"&&i.length===4)return{r:parseInt(i[1]+i[1],16),g:parseInt(i[2]+i[2],16),b:parseInt(i[3]+i[3],16),a:1}},_hslColorToRGBA(i){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(i)){const[t,...e]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(i),r=Number(e[0])/360,n=Number(e[1])/100,a=Number(e[2])/100;let o,h,l;if(n===0)return l=a*255,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};a<.5?o=a*(1+n):o=a+n-a*n;const d=2*a-o,u=[0,0,0];for(let c=0;c<3;c++)h=r+1/3*-(c-1),h<0&&h++,h>1&&h--,6*h<1?l=d+(o-d)*6*h:2*h<1?l=o:3*h<2?l=d+(o-d)*(2/3-h)*6:l=d,u[c]=l*255;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection(i,t){return!(t.x>i.x+i.width||t.x+t.width<i.x||t.y>i.y+i.height||t.y+t.height<i.y)},cloneObject(i){var t={};for(var e in i)this._isPlainObject(i[e])?t[e]=this.cloneObject(i[e]):this._isArray(i[e])?t[e]=this.cloneArray(i[e]):t[e]=i[e];return t},cloneArray(i){return i.slice(0)},degToRad(i){return i*PI_OVER_DEG180},radToDeg(i){return i*DEG180_OVER_PI},_degToRad(i){return Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),Util.degToRad(i)},_radToDeg(i){return Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),Util.radToDeg(i)},_getRotation(i){return Konva$3.angleDeg?Util.radToDeg(i):i},_capitalize(i){return i.charAt(0).toUpperCase()+i.slice(1)},throw(i){throw new Error(KONVA_ERROR+i)},error(i){console.error(KONVA_ERROR+i)},warn(i){!Konva$3.showWarnings||console.warn(KONVA_WARNING+i)},each(i,t){for(var e in i)t(e,i[e])},_inRange(i,t,e){return t<=i&&i<e},_getProjectionToSegment(i,t,e,r,n,a){var o,h,l,d=(i-e)*(i-e)+(t-r)*(t-r);if(d==0)o=i,h=t,l=(n-e)*(n-e)+(a-r)*(a-r);else{var u=((n-i)*(e-i)+(a-t)*(r-t))/d;u<0?(o=i,h=t,l=(i-n)*(i-n)+(t-a)*(t-a)):u>1?(o=e,h=r,l=(e-n)*(e-n)+(r-a)*(r-a)):(o=i+u*(e-i),h=t+u*(r-t),l=(o-n)*(o-n)+(h-a)*(h-a))}return[o,h,l]},_getProjectionToLine(i,t,e){var r=Util.cloneObject(i),n=Number.MAX_VALUE;return t.forEach(function(a,o){if(!(!e&&o===t.length-1)){var h=t[(o+1)%t.length],l=Util._getProjectionToSegment(a.x,a.y,h.x,h.y,i.x,i.y),d=l[0],u=l[1],c=l[2];c<n&&(r.x=d,r.y=u,n=c)}}),r},_prepareArrayForTween(i,t,e){var r,n=[],a=[];if(i.length>t.length){var o=t;t=i,i=o}for(r=0;r<i.length;r+=2)n.push({x:i[r],y:i[r+1]});for(r=0;r<t.length;r+=2)a.push({x:t[r],y:t[r+1]});var h=[];return a.forEach(function(l){var d=Util._getProjectionToLine(l,n,e);h.push(d.x),h.push(d.y)}),h},_prepareToStringify(i){var t;i.visitedByCircularReferenceRemoval=!0;for(var e in i)if(!!(i.hasOwnProperty(e)&&i[e]&&typeof i[e]=="object")){if(t=Object.getOwnPropertyDescriptor(i,e),i[e].visitedByCircularReferenceRemoval||Util._isElement(i[e]))if(t.configurable)delete i[e];else return null;else if(Util._prepareToStringify(i[e])===null)if(t.configurable)delete i[e];else return null}return delete i.visitedByCircularReferenceRemoval,i},_assign(i,t){for(var e in t)i[e]=t[e];return i},_getFirstPointerId(i){return i.touches?i.changedTouches[0].identifier:i.pointerId||999},releaseCanvas(...i){!Konva$3.releaseCanvasOnDestroy||i.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(i,t,e,r){let n=0,a=0,o=0,h=0;typeof r=="number"?n=a=o=h=Math.min(r,t/2,e/2):(n=Math.min(r[0]||0,t/2,e/2),a=Math.min(r[1]||0,t/2,e/2),h=Math.min(r[2]||0,t/2,e/2),o=Math.min(r[3]||0,t/2,e/2)),i.moveTo(n,0),i.lineTo(t-a,0),i.arc(t-a,a,a,Math.PI*3/2,0,!1),i.lineTo(t,e-h),i.arc(t-h,e-h,h,0,Math.PI/2,!1),i.lineTo(o,e),i.arc(o,e-o,o,Math.PI/2,Math.PI,!1),i.lineTo(0,n),i.arc(n,n,n,Math.PI,Math.PI*3/2,!1)}};function _formatValue(i){return Util._isString(i)?'"'+i+'"':Object.prototype.toString.call(i)==="[object Number]"||Util._isBoolean(i)?i:Object.prototype.toString.call(i)}function RGBComponent(i){return i>255?255:i<0?0:Math.round(i)}function getNumberValidator(){if(Konva$3.isUnminified)return function(i,t){return Util._isNumber(i)||Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),i}}function getNumberOrArrayOfNumbersValidator(i){if(Konva$3.isUnminified)return function(t,e){let r=Util._isNumber(t),n=Util._isArray(t)&&t.length==i;return!r&&!n&&Util.warn(_formatValue(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or Array<number>('+i+")"),t}}function getNumberOrAutoValidator(){if(Konva$3.isUnminified)return function(i,t){var e=Util._isNumber(i),r=i==="auto";return e||r||Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),i}}function getStringValidator(){if(Konva$3.isUnminified)return function(i,t){return Util._isString(i)||Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),i}}function getStringOrGradientValidator(){if(Konva$3.isUnminified)return function(i,t){const e=Util._isString(i),r=Object.prototype.toString.call(i)==="[object CanvasGradient]"||i&&i.addColorStop;return e||r||Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),i}}function getNumberArrayValidator(){if(Konva$3.isUnminified)return function(i,t){const e=Int8Array?Object.getPrototypeOf(Int8Array):null;return e&&i instanceof e||(Util._isArray(i)?i.forEach(function(r){Util._isNumber(r)||Util.warn('"'+t+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),i}}function getBooleanValidator(){if(Konva$3.isUnminified)return function(i,t){var e=i===!0||i===!1;return e||Util.warn(_formatValue(i)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),i}}function getComponentValidator(i){if(Konva$3.isUnminified)return function(t,e){return t==null||Util.isObject(t)||Util.warn(_formatValue(t)+' is a not valid value for "'+e+'" attribute. The value should be an object with properties '+i),t}}var GET="get",SET$1="set";const Factory={addGetterSetter(i,t,e,r,n){Factory.addGetter(i,t,e),Factory.addSetter(i,t,r,n),Factory.addOverloadedGetterSetter(i,t)},addGetter(i,t,e){var r=GET+Util._capitalize(t);i.prototype[r]=i.prototype[r]||function(){var n=this.attrs[t];return n===void 0?e:n}},addSetter(i,t,e,r){var n=SET$1+Util._capitalize(t);i.prototype[n]||Factory.overWriteSetter(i,t,e,r)},overWriteSetter(i,t,e,r){var n=SET$1+Util._capitalize(t);i.prototype[n]=function(a){return e&&a!==void 0&&a!==null&&(a=e.call(this,a,t)),this._setAttr(t,a),r&&r.call(this),this}},addComponentsGetterSetter(i,t,e,r,n){var a=e.length,o=Util._capitalize,h=GET+o(t),l=SET$1+o(t),d,u;i.prototype[h]=function(){var f={};for(d=0;d<a;d++)u=e[d],f[u]=this.getAttr(t+o(u));return f};var c=getComponentValidator(e);i.prototype[l]=function(f){var p=this.attrs[t],g;r&&(f=r.call(this,f)),c&&c.call(this,f,t);for(g in f)!f.hasOwnProperty(g)||this._setAttr(t+o(g),f[g]);return f||e.forEach(_=>{this._setAttr(t+o(_),void 0)}),this._fireChangeEvent(t,p,f),n&&n.call(this),this},Factory.addOverloadedGetterSetter(i,t)},addOverloadedGetterSetter(i,t){var e=Util._capitalize(t),r=SET$1+e,n=GET+e;i.prototype[t]=function(){return arguments.length?(this[r](arguments[0]),this):this[n]()}},addDeprecatedGetterSetter(i,t,e,r){Util.error("Adding deprecated "+t);var n=GET+Util._capitalize(t),a=t+" property is deprecated and will be removed soon. Look at Konva change log for more information.";i.prototype[n]=function(){Util.error(a);var o=this.attrs[t];return o===void 0?e:o},Factory.addSetter(i,t,r,function(){Util.error(a)}),Factory.addOverloadedGetterSetter(i,t)},backCompat(i,t){Util.each(t,function(e,r){var n=i.prototype[r],a=GET+Util._capitalize(e),o=SET$1+Util._capitalize(e);function h(){n.apply(this,arguments),Util.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}i.prototype[e]=h,i.prototype[a]=h,i.prototype[o]=h})},afterSetFilter(){this._filterUpToDate=!1}};function simplifyArray(i){var t=[],e=i.length,r=Util,n,a;for(n=0;n<e;n++)a=i[n],r._isNumber(a)?a=Math.round(a*1e3)/1e3:r._isString(a)||(a=a+""),t.push(a);return t}var COMMA=",",OPEN_PAREN="(",CLOSE_PAREN=")",OPEN_PAREN_BRACKET="([",CLOSE_BRACKET_PAREN="])",SEMICOLON=";",DOUBLE_PAREN="()",EQUALS="=",CONTEXT_METHODS=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],CONTEXT_PROPERTIES=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const traceArrMax=100;class Context{constructor(t){this.canvas=t,Konva$3.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var r=this.traceArr,n=r.length,a="",o,h,l,d;for(o=0;o<n;o++)h=r[o],l=h.method,l?(d=h.args,a+=l,t?a+=DOUBLE_PAREN:Util._isArray(d[0])?a+=OPEN_PAREN_BRACKET+d.join(COMMA)+CLOSE_BRACKET_PAREN:(e&&(d=d.map(u=>typeof u=="number"?Math.floor(u):u)),a+=OPEN_PAREN+d.join(COMMA)+CLOSE_PAREN)):(a+=h.property,t||(a+=EQUALS+h.val)),a+=SEMICOLON;return a}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr,r;e.push(t),r=e.length,r>=traceArrMax&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();e!==1&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,r,n,a,o){this._context.arc(t,e,r,n,a,o)}arcTo(t,e,r,n,a){this._context.arcTo(t,e,r,n,a)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,r,n,a,o){this._context.bezierCurveTo(t,e,r,n,a,o)}clearRect(t,e,r,n){this._context.clearRect(t,e,r,n)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(t,e){var r=arguments;if(r.length===2)return this._context.createImageData(t,e);if(r.length===1)return this._context.createImageData(t)}createLinearGradient(t,e,r,n){return this._context.createLinearGradient(t,e,r,n)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,r,n,a,o){return this._context.createRadialGradient(t,e,r,n,a,o)}drawImage(t,e,r,n,a,o,h,l,d){var u=arguments,c=this._context;u.length===3?c.drawImage(t,e,r):u.length===5?c.drawImage(t,e,r,n,a):u.length===9&&c.drawImage(t,e,r,n,a,o,h,l,d)}ellipse(t,e,r,n,a,o,h,l){this._context.ellipse(t,e,r,n,a,o,h,l)}isPointInPath(t,e,r,n){return r?this._context.isPointInPath(r,t,e,n):this._context.isPointInPath(t,e,n)}fill(t){t?this._context.fill(t):this._context.fill()}fillRect(t,e,r,n){this._context.fillRect(t,e,r,n)}strokeRect(t,e,r,n){this._context.strokeRect(t,e,r,n)}fillText(t,e,r,n){n?this._context.fillText(t,e,r,n):this._context.fillText(t,e,r)}measureText(t){return this._context.measureText(t)}getImageData(t,e,r,n){return this._context.getImageData(t,e,r,n)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,r,n){this._context.rect(t,e,r,n)}putImageData(t,e,r){this._context.putImageData(t,e,r)}quadraticCurveTo(t,e,r,n){this._context.quadraticCurveTo(t,e,r,n)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,r,n,a,o){this._context.setTransform(t,e,r,n,a,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,r,n){this._context.strokeText(t,e,r,n)}transform(t,e,r,n,a,o){this._context.transform(t,e,r,n,a,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t=this,e=CONTEXT_METHODS.length,r=this.setAttr,n,a,o=function(h){var l=t[h],d;t[h]=function(){return a=simplifyArray(Array.prototype.slice.call(arguments,0)),d=l.apply(t,arguments),t._trace({method:h,args:a}),d}};for(n=0;n<e;n++)o(CONTEXT_METHODS[n]);t.setAttr=function(){r.apply(t,arguments);var h=arguments[0],l=arguments[1];(h==="shadowOffsetX"||h==="shadowOffsetY"||h==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),t._trace({property:h,val:l})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;var r=!e||e==="source-over";r||this.setAttr("globalCompositeOperation",e)}}CONTEXT_PROPERTIES.forEach(function(i){Object.defineProperty(Context.prototype,i,{get(){return this._context[i]},set(t){this._context[i]=t}})});class SceneContext extends Context{constructor(t){super(t),this._context=t._canvas.getContext("2d")}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),r=t.getFillPriority();if(e&&r==="color"){this._fillColor(t);return}const n=t.getFillPatternImage();if(n&&r==="pattern"){this._fillPattern(t);return}const a=t.getFillLinearGradientColorStops();if(a&&r==="linear-gradient"){this._fillLinearGradient(t);return}const o=t.getFillRadialGradientColorStops();if(o&&r==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):n?this._fillPattern(t):a?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),r=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),a=this.createLinearGradient(e.x,e.y,r.x,r.y);if(n){for(var o=0;o<n.length;o+=2)a.addColorStop(n[o],n[o+1]);this.setAttr("strokeStyle",a)}}_stroke(t){var e=t.dash(),r=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!r){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var a=t.getStrokeLinearGradientColorStops();a?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),r||this.restore()}}_applyShadow(t){var e,r,n,a=(e=t.getShadowRGBA())!==null&&e!==void 0?e:"black",o=(r=t.getShadowBlur())!==null&&r!==void 0?r:5,h=(n=t.getShadowOffset())!==null&&n!==void 0?n:{x:0,y:0},l=t.getAbsoluteScale(),d=this.canvas.getPixelRatio(),u=l.x*d,c=l.y*d;this.setAttr("shadowColor",a),this.setAttr("shadowBlur",o*Math.min(Math.abs(u),Math.abs(c))),this.setAttr("shadowOffsetX",h.x*u),this.setAttr("shadowOffsetY",h.y*c)}}class HitContext extends Context{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const a=t.getStrokeScaleEnabled();if(!a){this.save();var e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(t);var r=t.hitStrokeWidth(),n=r==="auto"?t.strokeWidth():r;this.setAttr("lineWidth",n),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),a||this.restore()}}}var _pixelRatio;function getDevicePixelRatio(){if(_pixelRatio)return _pixelRatio;var i=Util.createCanvasElement(),t=i.getContext("2d");return _pixelRatio=function(){var e=Konva$3._global.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/r}(),Util.releaseCanvas(i),_pixelRatio}class Canvas{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=t||{},r=e.pixelRatio||Konva$3.pixelRatio||getDevicePixelRatio();this.pixelRatio=r,this._canvas=Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio,r=this.getContext()._context;r.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio,r=this.getContext()._context;r.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch{try{return this._canvas.toDataURL()}catch(n){return Util.error("Unable to get data URL. "+n.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}Factory.addGetterSetter(Canvas,"pixelRatio",void 0,getNumberValidator());class SceneCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.context=new SceneContext(this),this.setSize(t.width,t.height)}}class HitCanvas extends Canvas{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new HitContext(this),this.setSize(t.width,t.height)}}const DD={get isDragging(){var i=!1;return DD._dragElements.forEach(t=>{t.dragStatus==="dragging"&&(i=!0)}),i},justDragged:!1,get node(){var i;return DD._dragElements.forEach(t=>{i=t.node}),i},_dragElements:new Map,_drag(i){const t=[];DD._dragElements.forEach((e,r)=>{const{node:n}=e,a=n.getStage();a.setPointersPositions(i),e.pointerId===void 0&&(e.pointerId=Util._getFirstPointerId(i));const o=a._changedPointerPositions.find(d=>d.id===e.pointerId);if(!!o){if(e.dragStatus!=="dragging"){var h=n.dragDistance(),l=Math.max(Math.abs(o.x-e.startPointerPos.x),Math.abs(o.y-e.startPointerPos.y));if(l<h||(n.startDrag({evt:i}),!n.isDragging()))return}n._setDragPosition(i,e),t.push(n)}}),t.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:i},!0)})},_endDragBefore(i){const t=[];DD._dragElements.forEach(e=>{const{node:r}=e,n=r.getStage();if(i&&n.setPointersPositions(i),!n._changedPointerPositions.find(h=>h.id===e.pointerId))return;(e.dragStatus==="dragging"||e.dragStatus==="stopped")&&(DD.justDragged=!0,Konva$3._mouseListenClick=!1,Konva$3._touchListenClick=!1,Konva$3._pointerListenClick=!1,e.dragStatus="stopped");const o=e.node.getLayer()||e.node instanceof Konva$3.Stage&&e.node;o&&t.indexOf(o)===-1&&t.push(o)}),t.forEach(e=>{e.draw()})},_endDragAfter(i){DD._dragElements.forEach((t,e)=>{t.dragStatus==="stopped"&&t.node.fire("dragend",{type:"dragend",target:t.node,evt:i},!0),t.dragStatus!=="dragging"&&DD._dragElements.delete(e)})}};Konva$3.isBrowser&&(window.addEventListener("mouseup",DD._endDragBefore,!0),window.addEventListener("touchend",DD._endDragBefore,!0),window.addEventListener("mousemove",DD._drag),window.addEventListener("touchmove",DD._drag),window.addEventListener("mouseup",DD._endDragAfter,!1),window.addEventListener("touchend",DD._endDragAfter,!1));var ABSOLUTE_OPACITY="absoluteOpacity",ALL_LISTENERS="allEventListeners",ABSOLUTE_TRANSFORM="absoluteTransform",ABSOLUTE_SCALE="absoluteScale",CANVAS="canvas",CHANGE="Change",CHILDREN="children",KONVA="konva",LISTENING="listening",MOUSEENTER$1="mouseenter",MOUSELEAVE$1="mouseleave",SET="set",SHAPE="Shape",SPACE$1=" ",STAGE$1="stage",TRANSFORM="transform",UPPER_STAGE="Stage",VISIBLE="visible",TRANSFORM_CHANGE_STR$1=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(SPACE$1);let idCounter$1=1;class Node{constructor(t){this._id=idCounter$1++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){(t===TRANSFORM||t===ABSOLUTE_TRANSFORM)&&this._cache.get(t)?this._cache.get(t).dirty=!0:t?this._cache.delete(t):this._cache.clear()}_getCache(t,e){var r=this._cache.get(t),n=t===TRANSFORM||t===ABSOLUTE_TRANSFORM,a=r===void 0||n&&r.dirty===!0;return a&&(r=e.call(this),this._cache.set(t,r)),r}_calculate(t,e,r){if(!this._attachedDepsListeners.get(t)){const n=e.map(a=>a+"Change.konva").join(SPACE$1);this.on(n,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,r)}_getCanvasCache(){return this._cache.get(CANVAS)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===ABSOLUTE_TRANSFORM&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(CANVAS)){const{scene:t,filter:e,hit:r}=this._cache.get(CANVAS);Util.releaseCanvas(t,e,r),this._cache.delete(CANVAS)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},r={};(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var n=Math.ceil(e.width||r.width),a=Math.ceil(e.height||r.height),o=e.pixelRatio,h=e.x===void 0?Math.floor(r.x):e.x,l=e.y===void 0?Math.floor(r.y):e.y,d=e.offset||0,u=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(!n||!a){Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}n+=d*2+1,a+=d*2+1,h-=d,l-=d;var f=new SceneCanvas({pixelRatio:o,width:n,height:a}),p=new SceneCanvas({pixelRatio:o,width:0,height:0}),g=new HitCanvas({pixelRatio:c,width:n,height:a}),_=f.getContext(),v=g.getContext();return g.isCache=!0,f.isCache=!0,this._cache.delete(CANVAS),this._filterUpToDate=!1,e.imageSmoothingEnabled===!1&&(f.getContext()._context.imageSmoothingEnabled=!1,p.getContext()._context.imageSmoothingEnabled=!1),_.save(),v.save(),_.translate(-h,-l),v.translate(-h,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY),this._clearSelfAndDescendantCache(ABSOLUTE_SCALE),this.drawScene(f,this),this.drawHit(g,this),this._isUnderCache=!1,_.restore(),v.restore(),u&&(_.save(),_.beginPath(),_.rect(0,0,n,a),_.closePath(),_.setAttr("strokeStyle","red"),_.setAttr("lineWidth",5),_.stroke(),_.restore()),this._cache.set(CANVAS,{scene:f,filter:p,hit:g,x:h,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(CANVAS)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var r=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],n,a,o,h,l=this.getAbsoluteTransform(e);return r.forEach(function(d){var u=l.point(d);n===void 0&&(n=o=u.x,a=h=u.y),n=Math.min(n,u.x),a=Math.min(a,u.y),o=Math.max(o,u.x),h=Math.max(h,u.y)}),{x:n,y:a,width:o-n,height:h-a}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var r=this._getCachedSceneCanvas(),n=r.pixelRatio;t.drawImage(r._canvas,0,0,r.width/n,r.height/n),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),r=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t=this.filters(),e=this._getCanvasCache(),r=e.scene,n=e.filter,a=n.getContext(),o,h,l,d;if(t){if(!this._filterUpToDate){var u=r.pixelRatio;n.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(o=t.length,a.clear(),a.drawImage(r._canvas,0,0,r.getWidth()/u,r.getHeight()/u),h=a.getImageData(0,0,n.getWidth(),n.getHeight()),l=0;l<o;l++){if(d=t[l],typeof d!="function"){Util.error("Filter should be type of function, but got "+typeof d+" instead. Please check correct filters");continue}d.call(this,h),a.putImageData(h,0,0)}}catch(c){Util.error("Unable to apply filter. "+c.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return n}return r}on(t,e){if(this._cache&&this._cache.delete(ALL_LISTENERS),arguments.length===3)return this._delegate.apply(this,arguments);var r=t.split(SPACE$1),n=r.length,a,o,h,l,d;for(a=0;a<n;a++)o=r[a],h=o.split("."),l=h[0],d=h[1]||"",this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:d,handler:e});return this}off(t,e){var r=(t||"").split(SPACE$1),n=r.length,a,o,h,l,d,u;if(this._cache&&this._cache.delete(ALL_LISTENERS),!t)for(o in this.eventListeners)this._off(o);for(a=0;a<n;a++)if(h=r[a],l=h.split("."),d=l[0],u=l[1],d)this.eventListeners[d]&&this._off(d,u,e);else for(o in this.eventListeners)this._off(o,u,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(r){e.call(this,r.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,r){var n=this;this.on(t,function(a){for(var o=a.target.findAncestors(e,!0,n),h=0;h<o.length;h++)a=Util.cloneObject(a),a.currentTarget=o[h],r.call(o[h],a)})}remove(){return this.isDragging()&&this.stopDrag(),DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM),this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY),this._clearSelfAndDescendantCache(ABSOLUTE_SCALE),this._clearSelfAndDescendantCache(STAGE$1),this._clearSelfAndDescendantCache(VISIBLE),this._clearSelfAndDescendantCache(LISTENING)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+Util._capitalize(t);return Util._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{var e,r;if(!t)return this;for(e in t)e!==CHILDREN&&(r=SET+Util._capitalize(e),Util._isFunction(this[r])?this[r](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(LISTENING,this._isListening)}_isListening(t){if(!this.listening())return!1;const r=this.getParent();return r&&r!==t&&this!==t?r._isListening(t):!0}isVisible(){return this._getCache(VISIBLE,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const r=this.getParent();return r&&r!==t&&this!==t?r._isVisible(t):!0}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var r=this.getLayer(),n=!1;DD._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(o.node.nodeType==="Stage"||o.node.getLayer()===r)&&(n=!0)});var a=!e&&!Konva$3.hitOnDragEnabled&&n;return this.isListening()&&this.isVisible()&&!a}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t=this.getDepth(),e=this,r=0,n,a,o,h;function l(d){for(n=[],a=d.length,o=0;o<a;o++)h=d[o],r++,h.nodeType!==SHAPE&&(n=n.concat(h.getChildren().slice())),h._id===e._id&&(o=a);n.length>0&&n[0].getDepth()<=t&&l(n)}return e.nodeType!==UPPER_STAGE&&l(e.getStage().getChildren()),r}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(TRANSFORM),this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,r=this.parent;for(;r;){if(r.isCached()){e=!0;break}r=r.parent}e&&!t&&(t=!0);var n=this.getAbsoluteTransform(t).getMatrix(),a=new Transform,o=this.offset();return a.m=n.slice(),a.translate(o.x,o.y),a.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache(TRANSFORM);var r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(t.x,t.y),t={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache(TRANSFORM),this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,r=t.y,n=this.x(),a=this.y();return e!==void 0&&(n+=e),r!==void 0&&(a+=r),this.setPosition({x:n,y:a}),this}_eachAncestorReverse(t,e){var r=[],n=this.getParent(),a,o;if(!(e&&e._id===this._id)){for(r.unshift(this);n&&(!e||n._id!==e._id);)r.unshift(n),n=n.parent;for(a=r.length,o=0;o<a;o++)t(r[o])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(t){if(!this.parent)return Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(ABSOLUTE_OPACITY,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t={},e=this.getAttrs(),r,n,a,o,h;t.attrs={};for(r in e)n=e[r],h=Util.isObject(n)&&!Util._isPlainObject(n)&&!Util._isArray(n),!h&&(a=typeof this[r]=="function"&&this[r],delete e[r],o=a?a.call(this):null,e[r]=n,o!==n&&(t.attrs[r]=n));return t.className=this.getClassName(),Util._prepareToStringify(t)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,r){var n=[];e&&this._isMatch(t)&&n.push(this);for(var a=this.parent;a;){if(a===r)return n;a._isMatch(t)&&n.push(a),a=a.parent}return n}isAncestorOf(t){return!1}findAncestor(t,e,r){return this.findAncestors(t,e,r)[0]}_isMatch(t){if(!t)return!1;if(typeof t=="function")return t(this);var e=t.replace(/ /g,"").split(","),r=e.length,n,a;for(n=0;n<r;n++)if(a=e[n],Util.isValidSelector(a)||(Util.warn('Selector "'+a+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Util.warn("Konva is awesome, right?")),a.charAt(0)==="#"){if(this.id()===a.slice(1))return!0}else if(a.charAt(0)==="."){if(this.hasName(a.slice(1)))return!0}else if(this.className===a||this.nodeType===a)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(STAGE$1,this._getStage)}_getStage(){var t=this.getParent();if(t)return t.getStage()}fire(t,e={},r){return e.target=e.target||this,r?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(ABSOLUTE_TRANSFORM,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new Transform,this._eachAncestorReverse(function(n){var a=n.transformsEnabled();a==="all"?e.multiply(n.getTransform()):a==="position"&&e.translate(n.x()-n.offsetX(),n.y()-n.offsetY())},t),e;e=this._cache.get(ABSOLUTE_TRANSFORM)||new Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var r=this.transformsEnabled();if(r==="all")e.multiply(this.getTransform());else if(r==="position"){const n=this.attrs.x||0,a=this.attrs.y||0,o=this.attrs.offsetX||0,h=this.attrs.offsetY||0;e.translate(n-o,a-h)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(TRANSFORM,this._getTransform)}_getTransform(){var t,e,r=this._cache.get(TRANSFORM)||new Transform;r.reset();var n=this.x(),a=this.y(),o=Konva$3.getAngle(this.rotation()),h=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,l=(e=this.attrs.scaleY)!==null&&e!==void 0?e:1,d=this.attrs.skewX||0,u=this.attrs.skewY||0,c=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return(n!==0||a!==0)&&r.translate(n,a),o!==0&&r.rotate(o),(d!==0||u!==0)&&r.skew(d,u),(h!==1||l!==1)&&r.scale(h,l),(c!==0||f!==0)&&r.translate(-1*c,-1*f),r.dirty=!1,r}clone(t){var e=Util.cloneObject(this.attrs),r,n,a,o,h;for(r in t)e[r]=t[r];var l=new this.constructor(e);for(r in this.eventListeners)for(n=this.eventListeners[r],a=n.length,o=0;o<a;o++)h=n[o],h.name.indexOf(KONVA)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(h));return l}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),r=this.getStage(),n=t.x!==void 0?t.x:Math.floor(e.x),a=t.y!==void 0?t.y:Math.floor(e.y),o=t.pixelRatio||1,h=new SceneCanvas({width:t.width||Math.ceil(e.width)||(r?r.width():0),height:t.height||Math.ceil(e.height)||(r?r.height():0),pixelRatio:o}),l=h.getContext();return t.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(n||a)&&l.translate(-1*n,-1*a),this.drawScene(h),l.restore(),h}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};var e=t.mimeType||null,r=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,r);return t.callback&&t.callback(n),n}toImage(t){return new Promise((e,r)=>{try{const n=t==null?void 0:t.callback;n&&delete t.callback,Util._urlToImage(this.toDataURL(t),function(a){e(a),n==null||n(a)})}catch(n){r(n)}})}toBlob(t){return new Promise((e,r)=>{try{const n=t==null?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob(a=>{e(a),n==null||n(a)})}catch(n){r(n)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Konva$3.dragDistance}_off(t,e,r){var n=this.eventListeners[t],a,o,h;for(a=0;a<n.length;a++)if(o=n[a].name,h=n[a].handler,(o!=="konva"||e==="konva")&&(!e||o===e)&&(!r||r===h)){if(n.splice(a,1),n.length===0){delete this.eventListeners[t];break}a--}}_fireChangeEvent(t,e,r){this._fire(t+CHANGE,{oldVal:e,newVal:r})}addName(t){if(!this.hasName(t)){var e=this.name(),r=e?e+" "+t:t;this.name(r)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;var r=(e||"").split(/\s/g);return r.indexOf(t)!==-1}removeName(t){var e=(this.name()||"").split(/\s/g),r=e.indexOf(t);return r!==-1&&(e.splice(r,1),this.name(e.join(" "))),this}setAttr(t,e){var r=this[SET+Util._capitalize(t)];return Util._isFunction(r)?r.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(Konva$3.autoDrawEnabled){const t=this.getLayer()||this.getStage();t==null||t.batchDraw()}}_setAttr(t,e){var r=this.attrs[t];r===e&&!Util.isObject(e)||(e==null?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,r,e),this._requestDraw())}_setComponentAttr(t,e,r){var n;r!==void 0&&(n=this.attrs[t],n||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=r,this._fireChangeEvent(t,n,r))}_fireAndBubble(t,e,r){e&&this.nodeType===SHAPE&&(e.target=this);var n=(t===MOUSEENTER$1||t===MOUSELEAVE$1)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r);if(!n){this._fire(t,e);var a=(t===MOUSEENTER$1||t===MOUSELEAVE$1)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!a&&(r&&r.parent?this._fireAndBubble.call(this.parent,t,e,r):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){let e=this._cache.get(ALL_LISTENERS);if(!e){e={};let n=Object.getPrototypeOf(this);for(;n;){if(!n.eventListeners){n=Object.getPrototypeOf(n);continue}for(var r in n.eventListeners){const a=n.eventListeners[r],o=e[r]||[];e[r]=a.concat(o)}n=Object.getPrototypeOf(n)}this._cache.set(ALL_LISTENERS,e)}return e[t]}_fire(t,e){e=e||{},e.currentTarget=this,e.type=t;const r=this._getProtoListeners(t);if(r)for(var n=0;n<r.length;n++)r[n].handler.call(this,e);const a=this.eventListeners[t];if(a)for(var n=0;n<a.length;n++)a[n].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,r=this.getStage(),n=this.getAbsolutePosition(),a=r._getPointerById(e)||r._changedPointerPositions[0]||n;DD._dragElements.set(this._id,{node:this,startPointerPos:a,offset:{x:a.x-n.x,y:a.y-n.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){DD._dragElements.has(this._id)||this._createDragElement(t);const r=DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const r=this.getStage()._getPointerById(e.pointerId);if(!!r){var n={x:r.x-e.offset.x,y:r.y-e.offset.y},a=this.dragBoundFunc();if(a!==void 0){const o=a.call(this,n,t);o?n=o:Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==n.x||this._lastPos.y!==n.y)&&(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}}stopDrag(t){const e=DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),DD._endDragBefore(t),DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){var e=t.evt.button!==void 0,r=!e||Konva$3.dragButtons.indexOf(t.evt.button)>=0;if(!!r&&!this.isDragging()){var n=!1;DD._dragElements.forEach(a=>{this.isAncestorOf(a.node)&&(n=!0)}),n||this._createDragElement(t)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage();if(!t)return;const e=DD._dragElements.get(this._id),r=e&&e.dragStatus==="dragging",n=e&&e.dragStatus==="ready";r?this.stopDrag():n&&DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const r={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return Util.haveIntersection(r,this.getClientRect())}static create(t,e){return Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var r=Node.prototype.getClassName.call(t),n=t.children,a,o,h;e&&(t.attrs.container=e),Konva$3[r]||(Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=Konva$3[r];if(a=new l(t.attrs),n)for(o=n.length,h=0;h<o;h++)a.add(Node._createNode(n[h]));return a}}Node.prototype.nodeType="Node";Node.prototype._attrsAffectingSize=[];Node.prototype.eventListeners={};Node.prototype.on.call(Node.prototype,TRANSFORM_CHANGE_STR$1,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(TRANSFORM),this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM)});Node.prototype.on.call(Node.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(VISIBLE)});Node.prototype.on.call(Node.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(LISTENING)});Node.prototype.on.call(Node.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY)});const addGetterSetter=Factory.addGetterSetter;addGetterSetter(Node,"zIndex");addGetterSetter(Node,"absolutePosition");addGetterSetter(Node,"position");addGetterSetter(Node,"x",0,getNumberValidator());addGetterSetter(Node,"y",0,getNumberValidator());addGetterSetter(Node,"globalCompositeOperation","source-over",getStringValidator());addGetterSetter(Node,"opacity",1,getNumberValidator());addGetterSetter(Node,"name","",getStringValidator());addGetterSetter(Node,"id","",getStringValidator());addGetterSetter(Node,"rotation",0,getNumberValidator());Factory.addComponentsGetterSetter(Node,"scale",["x","y"]);addGetterSetter(Node,"scaleX",1,getNumberValidator());addGetterSetter(Node,"scaleY",1,getNumberValidator());Factory.addComponentsGetterSetter(Node,"skew",["x","y"]);addGetterSetter(Node,"skewX",0,getNumberValidator());addGetterSetter(Node,"skewY",0,getNumberValidator());Factory.addComponentsGetterSetter(Node,"offset",["x","y"]);addGetterSetter(Node,"offsetX",0,getNumberValidator());addGetterSetter(Node,"offsetY",0,getNumberValidator());addGetterSetter(Node,"dragDistance",null,getNumberValidator());addGetterSetter(Node,"width",0,getNumberValidator());addGetterSetter(Node,"height",0,getNumberValidator());addGetterSetter(Node,"listening",!0,getBooleanValidator());addGetterSetter(Node,"preventDefault",!0,getBooleanValidator());addGetterSetter(Node,"filters",null,function(i){return this._filterUpToDate=!1,i});addGetterSetter(Node,"visible",!0,getBooleanValidator());addGetterSetter(Node,"transformsEnabled","all",getStringValidator());addGetterSetter(Node,"size");addGetterSetter(Node,"dragBoundFunc");addGetterSetter(Node,"draggable",!1,getBooleanValidator());Factory.backCompat(Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Container extends Node{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var r=[];return e.forEach(function(n){t(n)&&r.push(n)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const r=t[0];return r.getParent()?(r.moveTo(this),this):(this._validateAdd(r),r.index=this.getChildren().length,r.parent=this,r._clearCaches(),this.getChildren().push(r),this._fire("add",{child:r}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var r=[];return this._descendants(n=>{const a=n._isMatch(t);return a&&r.push(n),!!(a&&e)}),r}_descendants(t){let e=!1;const r=this.getChildren();for(const n of r){if(e=t(n),e)return!0;if(!!n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1}toObject(){var t=Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(r){e.add(r.clone())}),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach(function(r){r.isVisible()&&r.intersects(t)&&e.push(r)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),!this.isCached()&&((e=this.children)===null||e===void 0||e.forEach(function(r){r._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(e,r){e.index=r}),this._requestDraw()}drawScene(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas(),a=n&&n.getContext(),o=this._getCanvasCache(),h=o&&o.scene,l=n&&n.isCache;if(!this.isVisible()&&!l)return this;if(h){a.save();var d=this.getAbsoluteTransform(e).getMatrix();a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedSceneCanvas(a),a.restore()}else this._drawChildren("drawScene",n,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var r=this.getLayer(),n=t||r&&r.hitCanvas,a=n&&n.getContext(),o=this._getCanvasCache(),h=o&&o.hit;if(h){a.save();var l=this.getAbsoluteTransform(e).getMatrix();a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(a),a.restore()}else this._drawChildren("drawHit",n,e);return this}_drawChildren(t,e,r){var n,a=e&&e.getContext(),o=this.clipWidth(),h=this.clipHeight(),l=this.clipFunc(),d=o&&h||l;const u=r===this;if(d){a.save();var c=this.getAbsoluteTransform(r),f=c.getMatrix();if(a.transform(f[0],f[1],f[2],f[3],f[4],f[5]),a.beginPath(),l)l.call(this,a,this);else{var p=this.clipX(),g=this.clipY();a.rect(p,g,o,h)}a.clip(),f=c.copy().invert().getMatrix(),a.transform(f[0],f[1],f[2],f[3],f[4],f[5])}var _=!u&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";_&&(a.save(),a._applyGlobalCompositeOperation(this)),(n=this.children)===null||n===void 0||n.forEach(function(v){v[t](e,r)}),_&&a.restore(),d&&a.restore()}getClientRect(t){var e;t=t||{};var r=t.skipTransform,n=t.relativeTo,a,o,h,l,d={x:1/0,y:1/0,width:0,height:0},u=this;(e=this.children)===null||e===void 0||e.forEach(function(_){if(!!_.visible()){var v=_.getClientRect({relativeTo:u,skipShadow:t.skipShadow,skipStroke:t.skipStroke});v.width===0&&v.height===0||(a===void 0?(a=v.x,o=v.y,h=v.x+v.width,l=v.y+v.height):(a=Math.min(a,v.x),o=Math.min(o,v.y),h=Math.max(h,v.x+v.width),l=Math.max(l,v.y+v.height)))}});for(var c=this.find("Shape"),f=!1,p=0;p<c.length;p++){var g=c[p];if(g._isVisible(this)){f=!0;break}}return f&&a!==void 0?d={x:a,y:o,width:h-a,height:l-o}:d={x:0,y:0,width:0,height:0},r?d:this._transformedRect(d,n)}}Factory.addComponentsGetterSetter(Container,"clip",["x","y","width","height"]);Factory.addGetterSetter(Container,"clipX",void 0,getNumberValidator());Factory.addGetterSetter(Container,"clipY",void 0,getNumberValidator());Factory.addGetterSetter(Container,"clipWidth",void 0,getNumberValidator());Factory.addGetterSetter(Container,"clipHeight",void 0,getNumberValidator());Factory.addGetterSetter(Container,"clipFunc");const Captures=new Map,SUPPORT_POINTER_EVENTS=Konva$3._global.PointerEvent!==void 0;function getCapturedShape(i){return Captures.get(i)}function createEvent(i){return{evt:i,pointerId:i.pointerId}}function hasPointerCapture(i,t){return Captures.get(i)===t}function setPointerCapture(i,t){releaseCapture(i),t.getStage()&&(Captures.set(i,t),SUPPORT_POINTER_EVENTS&&t._fire("gotpointercapture",createEvent(new PointerEvent("gotpointercapture"))))}function releaseCapture(i,t){const e=Captures.get(i);if(!e)return;const r=e.getStage();r&&r.content,Captures.delete(i),SUPPORT_POINTER_EVENTS&&e._fire("lostpointercapture",createEvent(new PointerEvent("lostpointercapture")))}var STAGE="Stage",STRING="string",PX="px",MOUSEOUT="mouseout",MOUSELEAVE="mouseleave",MOUSEOVER="mouseover",MOUSEENTER="mouseenter",MOUSEMOVE="mousemove",MOUSEDOWN="mousedown",MOUSEUP="mouseup",POINTERMOVE="pointermove",POINTERDOWN="pointerdown",POINTERUP="pointerup",POINTERCANCEL="pointercancel",LOSTPOINTERCAPTURE="lostpointercapture",POINTEROUT="pointerout",POINTERLEAVE="pointerleave",POINTEROVER="pointerover",POINTERENTER="pointerenter",CONTEXTMENU="contextmenu",TOUCHSTART="touchstart",TOUCHEND="touchend",TOUCHMOVE="touchmove",TOUCHCANCEL="touchcancel",WHEEL="wheel",MAX_LAYERS_NUMBER=5,EVENTS=[[MOUSEENTER,"_pointerenter"],[MOUSEDOWN,"_pointerdown"],[MOUSEMOVE,"_pointermove"],[MOUSEUP,"_pointerup"],[MOUSELEAVE,"_pointerleave"],[TOUCHSTART,"_pointerdown"],[TOUCHMOVE,"_pointermove"],[TOUCHEND,"_pointerup"],[TOUCHCANCEL,"_pointercancel"],[MOUSEOVER,"_pointerover"],[WHEEL,"_wheel"],[CONTEXTMENU,"_contextmenu"],[POINTERDOWN,"_pointerdown"],[POINTERMOVE,"_pointermove"],[POINTERUP,"_pointerup"],[POINTERCANCEL,"_pointercancel"],[LOSTPOINTERCAPTURE,"_lostpointercapture"]];const EVENTS_MAP={mouse:{[POINTEROUT]:MOUSEOUT,[POINTERLEAVE]:MOUSELEAVE,[POINTEROVER]:MOUSEOVER,[POINTERENTER]:MOUSEENTER,[POINTERMOVE]:MOUSEMOVE,[POINTERDOWN]:MOUSEDOWN,[POINTERUP]:MOUSEUP,[POINTERCANCEL]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[POINTEROUT]:"touchout",[POINTERLEAVE]:"touchleave",[POINTEROVER]:"touchover",[POINTERENTER]:"touchenter",[POINTERMOVE]:TOUCHMOVE,[POINTERDOWN]:TOUCHSTART,[POINTERUP]:TOUCHEND,[POINTERCANCEL]:TOUCHCANCEL,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[POINTEROUT]:POINTEROUT,[POINTERLEAVE]:POINTERLEAVE,[POINTEROVER]:POINTEROVER,[POINTERENTER]:POINTERENTER,[POINTERMOVE]:POINTERMOVE,[POINTERDOWN]:POINTERDOWN,[POINTERUP]:POINTERUP,[POINTERCANCEL]:POINTERCANCEL,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},getEventType=i=>i.indexOf("pointer")>=0?"pointer":i.indexOf("touch")>=0?"touch":"mouse",getEventsMap=i=>{const t=getEventType(i);if(t==="pointer")return Konva$3.pointerEventsEnabled&&EVENTS_MAP.pointer;if(t==="touch")return EVENTS_MAP.touch;if(t==="mouse")return EVENTS_MAP.mouse};function checkNoClip(i={}){return(i.clipFunc||i.clipWidth||i.clipHeight)&&Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),i}const NO_POINTERS_MESSAGE="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);",stages=[];class Stage extends Container{constructor(t){super(checkNoClip(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{checkNoClip(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e=t.getType()==="Layer",r=t.getType()==="FastLayer";e||r||Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if(typeof t===STRING){if(t.charAt(0)==="."){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var r;t.charAt(0)!=="#"?r=t:r=t.slice(1),t=document.getElementById(r)}if(!t)throw"Can not find container in document with id "+r}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t=this.children,e=t.length,r;for(r=0;r<e;r++)t[r].clear();return this}clone(t){return t||(t={}),t.container=typeof document<"u"&&document.createElement("div"),Container.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&Util._isInDocument(t)&&this.container().removeChild(t);var e=stages.indexOf(this);return e>-1&&stages.splice(e,1),Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(Util.warn(NO_POINTERS_MESSAGE),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){t=t||{},t.x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var e=new SceneCanvas({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),r=e.getContext()._context,n=this.children;return(t.x||t.y)&&r.translate(-1*t.x,-1*t.y),n.forEach(function(a){if(!!a.isVisible()){var o=a._toKonvaCanvas(t);r.drawImage(o._canvas,t.x,t.y,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}}),e}getIntersection(t){if(!t)return null;var e=this.children,r=e.length,n=r-1,a;for(a=n;a>=0;a--){const o=e[a].getIntersection(t);if(o)return o}return null}_resizeDOM(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+PX,this.content.style.height=e+PX),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(r=>{r.setSize({width:t,height:e}),r.draw()})}add(t,...e){if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}super.add(t);var n=this.children.length;return n>MAX_LAYERS_NUMBER&&Util.warn("The stage has "+n+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),Konva$3.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return hasPointerCapture(t,this)}setPointerCapture(t){setPointerCapture(t,this)}releaseCapture(t){releaseCapture(t)}getLayers(){return this.children}_bindContentEvents(){!Konva$3.isBrowser||EVENTS.forEach(([t,e])=>{this.content.addEventListener(t,r=>{this[e](r)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=getEventsMap(t.type);this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=getEventsMap(t.type);this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=getEventsMap(t.type),r=getEventType(t.type);if(!!e){this.setPointersPositions(t);var n=this._getTargetShape(r),a=!DD.isDragging||Konva$3.hitOnDragEnabled;n&&a?(n._fireAndBubble(e.pointerout,{evt:t}),n._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[r+"targetShape"]=null):a&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(t){const e=getEventsMap(t.type),r=getEventType(t.type);if(!!e){this.setPointersPositions(t);var n=!1;this._changedPointerPositions.forEach(a=>{var o=this.getIntersection(a);if(DD.justDragged=!1,Konva$3["_"+r+"ListenClick"]=!0,!(o&&o.isListening()))return;Konva$3.capturePointerEventsEnabled&&o.setPointerCapture(a.id),this[r+"ClickStartShape"]=o,o._fireAndBubble(e.pointerdown,{evt:t,pointerId:a.id}),n=!0;const l=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&l&&t.preventDefault()}),n||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){const e=getEventsMap(t.type),r=getEventType(t.type);if(!e)return;DD.isDragging&&DD.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t);var n=!DD.isDragging||Konva$3.hitOnDragEnabled;if(!n)return;var a={};let o=!1;var h=this._getTargetShape(r);this._changedPointerPositions.forEach(l=>{const d=getCapturedShape(l.id)||this.getIntersection(l),u=l.id,c={evt:t,pointerId:u};var f=h!==d;if(f&&h&&(h._fireAndBubble(e.pointerout,Object.assign({},c),d),h._fireAndBubble(e.pointerleave,Object.assign({},c),d)),d){if(a[d._id])return;a[d._id]=!0}d&&d.isListening()?(o=!0,f&&(d._fireAndBubble(e.pointerover,Object.assign({},c),h),d._fireAndBubble(e.pointerenter,Object.assign({},c),h),this[r+"targetShape"]=d),d._fireAndBubble(e.pointermove,Object.assign({},c))):h&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:u}),this[r+"targetShape"]=null)}),o||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=getEventsMap(t.type),r=getEventType(t.type);if(!e)return;this.setPointersPositions(t);const n=this[r+"ClickStartShape"],a=this[r+"ClickEndShape"];var o={};let h=!1;this._changedPointerPositions.forEach(l=>{const d=getCapturedShape(l.id)||this.getIntersection(l);if(d){if(d.releaseCapture(l.id),o[d._id])return;o[d._id]=!0}const u=l.id,c={evt:t,pointerId:u};let f=!1;Konva$3["_"+r+"InDblClickWindow"]?(f=!0,clearTimeout(this[r+"DblTimeout"])):DD.justDragged||(Konva$3["_"+r+"InDblClickWindow"]=!0,clearTimeout(this[r+"DblTimeout"])),this[r+"DblTimeout"]=setTimeout(function(){Konva$3["_"+r+"InDblClickWindow"]=!1},Konva$3.dblClickWindow),d&&d.isListening()?(h=!0,this[r+"ClickEndShape"]=d,d._fireAndBubble(e.pointerup,Object.assign({},c)),Konva$3["_"+r+"ListenClick"]&&n&&n===d&&(d._fireAndBubble(e.pointerclick,Object.assign({},c)),f&&a&&a===d&&d._fireAndBubble(e.pointerdblclick,Object.assign({},c)))):(this[r+"ClickEndShape"]=null,Konva$3["_"+r+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:u}),f&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:u}))}),h||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Konva$3["_"+r+"ListenClick"]=!1,t.cancelable&&r!=="touch"&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(CONTEXTMENU,{evt:t}):this._fire(CONTEXTMENU,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(WHEEL,{evt:t}):this._fire(WHEEL,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(POINTERUP,createEvent(t)),releaseCapture(t.pointerId)}_lostpointercapture(t){releaseCapture(t.pointerId)}setPointersPositions(t){var e=this._getContentPosition(),r=null,n=null;t=t||window.event,t.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,a=>{this._pointerPositions.push({id:a.identifier,x:(a.clientX-e.left)/e.scaleX,y:(a.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,a=>{this._changedPointerPositions.push({id:a.identifier,x:(a.clientX-e.left)/e.scaleX,y:(a.clientY-e.top)/e.scaleY})})):(r=(t.clientX-e.left)/e.scaleX,n=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:r,y:n},this._pointerPositions=[{x:r,y:n,id:Util._getFirstPointerId(t)}],this._changedPointerPositions=[{x:r,y:n,id:Util._getFirstPointerId(t)}])}_setPointerPosition(t){Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!Konva$3.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}Stage.prototype.nodeType=STAGE;_registerNode(Stage);Factory.addGetterSetter(Stage,"container");var HAS_SHADOW="hasShadow",SHADOW_RGBA="shadowRGBA",patternImage="patternImage",linearGradient="linearGradient",radialGradient="radialGradient";let dummyContext$1;function getDummyContext$1(){return dummyContext$1||(dummyContext$1=Util.createCanvasElement().getContext("2d"),dummyContext$1)}const shapes={};function _fillFunc$2(i){i.fill()}function _strokeFunc$2(i){i.stroke()}function _fillFuncHit(i){i.fill()}function _strokeFuncHit(i){i.stroke()}function _clearHasShadowCache(){this._clearCache(HAS_SHADOW)}function _clearGetShadowRGBACache(){this._clearCache(SHADOW_RGBA)}function _clearFillPatternCache(){this._clearCache(patternImage)}function _clearLinearGradientCache(){this._clearCache(linearGradient)}function _clearRadialGradientCache(){this._clearCache(radialGradient)}class Shape extends Node{constructor(t){super(t);let e;for(;e=Util.getRandomColor(),!(e&&!(e in shapes)););this.colorKey=e,shapes[e]=this}getContext(){return Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(HAS_SHADOW,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(patternImage,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var t=getDummyContext$1();const e=t.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(e&&e.setTransform){const r=new Transform;r.translate(this.fillPatternX(),this.fillPatternY()),r.rotate(Konva$3.getAngle(this.fillPatternRotation())),r.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),r.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=r.getMatrix(),a=typeof DOMMatrix>"u"?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);e.setTransform(a)}return e}}_getLinearGradient(){return this._getCache(linearGradient,this.__getLinearGradient)}__getLinearGradient(){var t=this.fillLinearGradientColorStops();if(t){for(var e=getDummyContext$1(),r=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),a=e.createLinearGradient(r.x,r.y,n.x,n.y),o=0;o<t.length;o+=2)a.addColorStop(t[o],t[o+1]);return a}}_getRadialGradient(){return this._getCache(radialGradient,this.__getRadialGradient)}__getRadialGradient(){var t=this.fillRadialGradientColorStops();if(t){for(var e=getDummyContext$1(),r=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),a=e.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius()),o=0;o<t.length;o+=2)a.addColorStop(t[o],t[o+1]);return a}}getShadowRGBA(){return this._getCache(SHADOW_RGBA,this._getShadowRGBA)}_getShadowRGBA(){if(!!this.hasShadow()){var t=Util.colorToRGBA(this.shadowColor());if(t)return"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return t==="auto"?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){var e=this.getStage(),r=e.bufferHitCanvas,n;return r.getContext().clear(),this.drawHit(r,null,!0),n=r.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data,n[3]>0}destroy(){return Node.prototype.destroy.call(this),delete shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!this.getStage()||!((e=this.attrs.perfectDrawEnabled)!==null&&e!==void 0?e:!0))return!1;const n=t||this.hasFill(),a=this.hasStroke(),o=this.getAbsoluteOpacity()!==1;if(n&&a&&o)return!0;const h=this.hasShadow(),l=this.shadowForStrokeEnabled();return!!(n&&a&&h&&l)}setStrokeHitEnabled(t){Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){const e=t.skipTransform,r=t.relativeTo,n=this.getSelfRect(),o=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,h=n.width+o,l=n.height+o,d=!t.skipShadow&&this.hasShadow(),u=d?this.shadowOffsetX():0,c=d?this.shadowOffsetY():0,f=h+Math.abs(u),p=l+Math.abs(c),g=d&&this.shadowBlur()||0,_=f+g*2,v=p+g*2,E={width:_,height:v,x:-(o/2+g)+Math.min(u,0)+n.x,y:-(o/2+g)+Math.min(c,0)+n.y};return e?E:this._transformedRect(E,r)}drawScene(t,e){var r=this.getLayer(),n=t||r.getCanvas(),a=n.getContext(),o=this._getCanvasCache(),h=this.getSceneFunc(),l=this.hasShadow(),d,u,c,f=n.isCache,p=e===this;if(!this.isVisible()&&!p)return this;if(o){a.save();var g=this.getAbsoluteTransform(e).getMatrix();return a.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedSceneCanvas(a),a.restore(),this}if(!h)return this;if(a.save(),this._useBufferCanvas()&&!f){d=this.getStage(),u=d.bufferCanvas,c=u.getContext(),c.clear(),c.save(),c._applyLineJoin(this);var _=this.getAbsoluteTransform(e).getMatrix();c.transform(_[0],_[1],_[2],_[3],_[4],_[5]),h.call(this,c,this),c.restore();var v=u.pixelRatio;l&&a._applyShadow(this),a._applyOpacity(this),a._applyGlobalCompositeOperation(this),a.drawImage(u._canvas,0,0,u.width/v,u.height/v)}else{if(a._applyLineJoin(this),!p){var _=this.getAbsoluteTransform(e).getMatrix();a.transform(_[0],_[1],_[2],_[3],_[4],_[5]),a._applyOpacity(this),a._applyGlobalCompositeOperation(this)}l&&a._applyShadow(this),h.call(this,a,this)}return a.restore(),this}drawHit(t,e,r=!1){if(!this.shouldDrawHit(e,r))return this;var n=this.getLayer(),a=t||n.hitCanvas,o=a&&a.getContext(),h=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),d=l&&l.hit;if(this.colorKey||Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),d){o.save();var u=this.getAbsoluteTransform(e).getMatrix();return o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!h)return this;if(o.save(),o._applyLineJoin(this),!(this===e)){var f=this.getAbsoluteTransform(e).getMatrix();o.transform(f[0],f[1],f[2],f[3],f[4],f[5])}return h.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){var e=this._getCanvasCache(),r=this._getCachedSceneCanvas(),n=e.hit,a=n.getContext(),o=n.getWidth(),h=n.getHeight(),l,d,u,c,f,p;a.clear(),a.drawImage(r._canvas,0,0,o,h);try{for(l=a.getImageData(0,0,o,h),d=l.data,u=d.length,c=Util._hexToRgb(this.colorKey),f=0;f<u;f+=4)p=d[f+3],p>t?(d[f]=c.r,d[f+1]=c.g,d[f+2]=c.b,d[f+3]=255):d[f+3]=0;a.putImageData(l,0,0)}catch(g){Util.error("Unable to draw hit graph from cached scene canvas. "+g.message)}return this}hasPointerCapture(t){return hasPointerCapture(t,this)}setPointerCapture(t){setPointerCapture(t,this)}releaseCapture(t){releaseCapture(t)}}Shape.prototype._fillFunc=_fillFunc$2;Shape.prototype._strokeFunc=_strokeFunc$2;Shape.prototype._fillFuncHit=_fillFuncHit;Shape.prototype._strokeFuncHit=_strokeFuncHit;Shape.prototype._centroid=!1;Shape.prototype.nodeType="Shape";_registerNode(Shape);Shape.prototype.eventListeners={};Shape.prototype.on.call(Shape.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",_clearHasShadowCache);Shape.prototype.on.call(Shape.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",_clearGetShadowRGBACache);Shape.prototype.on.call(Shape.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",_clearFillPatternCache);Shape.prototype.on.call(Shape.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",_clearLinearGradientCache);Shape.prototype.on.call(Shape.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",_clearRadialGradientCache);Factory.addGetterSetter(Shape,"stroke",void 0,getStringOrGradientValidator());Factory.addGetterSetter(Shape,"strokeWidth",2,getNumberValidator());Factory.addGetterSetter(Shape,"fillAfterStrokeEnabled",!1);Factory.addGetterSetter(Shape,"hitStrokeWidth","auto",getNumberOrAutoValidator());Factory.addGetterSetter(Shape,"strokeHitEnabled",!0,getBooleanValidator());Factory.addGetterSetter(Shape,"perfectDrawEnabled",!0,getBooleanValidator());Factory.addGetterSetter(Shape,"shadowForStrokeEnabled",!0,getBooleanValidator());Factory.addGetterSetter(Shape,"lineJoin");Factory.addGetterSetter(Shape,"lineCap");Factory.addGetterSetter(Shape,"sceneFunc");Factory.addGetterSetter(Shape,"hitFunc");Factory.addGetterSetter(Shape,"dash");Factory.addGetterSetter(Shape,"dashOffset",0,getNumberValidator());Factory.addGetterSetter(Shape,"shadowColor",void 0,getStringValidator());Factory.addGetterSetter(Shape,"shadowBlur",0,getNumberValidator());Factory.addGetterSetter(Shape,"shadowOpacity",1,getNumberValidator());Factory.addComponentsGetterSetter(Shape,"shadowOffset",["x","y"]);Factory.addGetterSetter(Shape,"shadowOffsetX",0,getNumberValidator());Factory.addGetterSetter(Shape,"shadowOffsetY",0,getNumberValidator());Factory.addGetterSetter(Shape,"fillPatternImage");Factory.addGetterSetter(Shape,"fill",void 0,getStringOrGradientValidator());Factory.addGetterSetter(Shape,"fillPatternX",0,getNumberValidator());Factory.addGetterSetter(Shape,"fillPatternY",0,getNumberValidator());Factory.addGetterSetter(Shape,"fillLinearGradientColorStops");Factory.addGetterSetter(Shape,"strokeLinearGradientColorStops");Factory.addGetterSetter(Shape,"fillRadialGradientStartRadius",0);Factory.addGetterSetter(Shape,"fillRadialGradientEndRadius",0);Factory.addGetterSetter(Shape,"fillRadialGradientColorStops");Factory.addGetterSetter(Shape,"fillPatternRepeat","repeat");Factory.addGetterSetter(Shape,"fillEnabled",!0);Factory.addGetterSetter(Shape,"strokeEnabled",!0);Factory.addGetterSetter(Shape,"shadowEnabled",!0);Factory.addGetterSetter(Shape,"dashEnabled",!0);Factory.addGetterSetter(Shape,"strokeScaleEnabled",!0);Factory.addGetterSetter(Shape,"fillPriority","color");Factory.addComponentsGetterSetter(Shape,"fillPatternOffset",["x","y"]);Factory.addGetterSetter(Shape,"fillPatternOffsetX",0,getNumberValidator());Factory.addGetterSetter(Shape,"fillPatternOffsetY",0,getNumberValidator());Factory.addComponentsGetterSetter(Shape,"fillPatternScale",["x","y"]);Factory.addGetterSetter(Shape,"fillPatternScaleX",1,getNumberValidator());Factory.addGetterSetter(Shape,"fillPatternScaleY",1,getNumberValidator());Factory.addComponentsGetterSetter(Shape,"fillLinearGradientStartPoint",["x","y"]);Factory.addComponentsGetterSetter(Shape,"strokeLinearGradientStartPoint",["x","y"]);Factory.addGetterSetter(Shape,"fillLinearGradientStartPointX",0);Factory.addGetterSetter(Shape,"strokeLinearGradientStartPointX",0);Factory.addGetterSetter(Shape,"fillLinearGradientStartPointY",0);Factory.addGetterSetter(Shape,"strokeLinearGradientStartPointY",0);Factory.addComponentsGetterSetter(Shape,"fillLinearGradientEndPoint",["x","y"]);Factory.addComponentsGetterSetter(Shape,"strokeLinearGradientEndPoint",["x","y"]);Factory.addGetterSetter(Shape,"fillLinearGradientEndPointX",0);Factory.addGetterSetter(Shape,"strokeLinearGradientEndPointX",0);Factory.addGetterSetter(Shape,"fillLinearGradientEndPointY",0);Factory.addGetterSetter(Shape,"strokeLinearGradientEndPointY",0);Factory.addComponentsGetterSetter(Shape,"fillRadialGradientStartPoint",["x","y"]);Factory.addGetterSetter(Shape,"fillRadialGradientStartPointX",0);Factory.addGetterSetter(Shape,"fillRadialGradientStartPointY",0);Factory.addComponentsGetterSetter(Shape,"fillRadialGradientEndPoint",["x","y"]);Factory.addGetterSetter(Shape,"fillRadialGradientEndPointX",0);Factory.addGetterSetter(Shape,"fillRadialGradientEndPointY",0);Factory.addGetterSetter(Shape,"fillPatternRotation",0);Factory.backCompat(Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var HASH="#",BEFORE_DRAW="beforeDraw",DRAW="draw",INTERSECTION_OFFSETS=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],INTERSECTION_OFFSETS_LEN=INTERSECTION_OFFSETS.length;class Layer extends Container{constructor(t){super(t),this.canvas=new SceneCanvas,this.hitCanvas=new HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var t=Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return!e||!e.content?!1:(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return Node.prototype.remove.call(this),t&&t.parentNode&&Util._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,r=!1;;){for(let n=0;n<INTERSECTION_OFFSETS_LEN;n++){const a=INTERSECTION_OFFSETS[n],o=this._getIntersection({x:t.x+a.x*e,y:t.y+a.y*e}),h=o.shape;if(h)return h;if(r=!!o.antialiased,!o.antialiased)break}if(r)e+=1;else return null}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=r[3];if(n===255){const a=Util._rgbToHex(r[0],r[1],r[2]),o=shapes[HASH+a];return o?{shape:o}:{antialiased:!0}}else if(n>0)return{antialiased:!0};return{}}drawScene(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas();return this._fire(BEFORE_DRAW,{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),Container.prototype.drawScene.call(this,n,e),this._fire(DRAW,{node:this}),this}drawHit(t,e){var r=this.getLayer(),n=t||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),Container.prototype.drawHit.call(this,n,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Layer.prototype.nodeType="Layer";_registerNode(Layer);Factory.addGetterSetter(Layer,"imageSmoothingEnabled",!0);Factory.addGetterSetter(Layer,"clearBeforeDraw",!0);Factory.addGetterSetter(Layer,"hitGraphEnabled",!0,getBooleanValidator());class FastLayer extends Layer{constructor(t){super(t),this.listening(!1),Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}FastLayer.prototype.nodeType="FastLayer";_registerNode(FastLayer);class Group extends Container{_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Util.throw("You may only add groups and shapes to groups.")}}Group.prototype.nodeType="Group";_registerNode(Group);var now=function(){return glob.performance&&glob.performance.now?function(){return glob.performance.now()}:function(){return new Date().getTime()}}();class Animation{constructor(t,e){this.id=Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:now(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e=[];return t?t.length>0?e=t:e=[t]:e=[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e=this.layers,r=e.length,n;for(n=0;n<r;n++)if(e[n]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t=Animation,e=t.animations,r=e.length,n;for(n=0;n<r;n++)if(e[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=now(),Animation._addAnimation(this),this}stop(){return Animation._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e=t.id,r=this.animations,n=r.length,a;for(a=0;a<n;a++)if(r[a].id===e){this.animations.splice(a,1);break}}static _runFrames(){var t={},e=this.animations,r,n,a,o,h,l,d,u,c;for(o=0;o<e.length;o++)if(r=e[o],n=r.layers,a=r.func,r._updateFrameObject(now()),l=n.length,a?c=a.call(r,r.frame)!==!1:c=!0,!!c)for(h=0;h<l;h++)d=n[h],d._id!==void 0&&(t[d._id]=d);for(u in t)!t.hasOwnProperty(u)||t[u].batchDraw()}static _animationLoop(){var t=Animation;t.animations.length?(t._runFrames(),Util.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,Util.requestAnimFrame(this._animationLoop))}}Animation.animations=[];Animation.animIdCounter=0;Animation.animRunning=!1;var blacklist={node:1,duration:1,easing:1,onFinish:1,yoyo:1},PAUSED=1,PLAYING=2,REVERSING=3,idCounter=0,colorAttrs=["fill","stroke","shadowColor"];class TweenEngine{constructor(t,e,r,n,a,o,h){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=h,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=a-this.begin,this.pause()}fire(t){var e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return t===void 0&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=PLAYING,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=REVERSING,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var t=this.getTimer()-this._startTime;this.state===PLAYING?this.setTime(t):this.state===REVERSING&&this.setTime(this.duration-t)}pause(){this.state=PAUSED,this.fire("onPause")}getTimer(){return new Date().getTime()}}class Tween{constructor(t){var e=this,r=t.node,n=r._id,a,o=t.easing||Easings.Linear,h=!!t.yoyo,l;typeof t.duration>"u"?a=.3:t.duration===0?a=.001:a=t.duration,this.node=r,this._id=idCounter++;var d=r.getLayer()||(r instanceof Konva$3.Stage?r.getLayers():null);d||Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Animation(function(){e.tween.onEnterFrame()},d),this.tween=new TweenEngine(l,function(u){e._tweenFunc(u)},o,0,1,a*1e3,h),this._addListeners(),Tween.attrs[n]||(Tween.attrs[n]={}),Tween.attrs[n][this._id]||(Tween.attrs[n][this._id]={}),Tween.tweens[n]||(Tween.tweens[n]={});for(l in t)blacklist[l]===void 0&&this._addAttr(l,t[l]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){var r=this.node,n=r._id,a,o,h,l,d,u,c,f;if(h=Tween.tweens[n][t],h&&delete Tween.attrs[n][h][t],a=r.getAttr(t),Util._isArray(e))if(o=[],d=Math.max(e.length,a.length),t==="points"&&e.length!==a.length&&(e.length>a.length?(c=a,a=Util._prepareArrayForTween(a,e,r.closed())):(u=e,e=Util._prepareArrayForTween(e,a,r.closed()))),t.indexOf("fill")===0)for(l=0;l<d;l++)if(l%2===0)o.push(e[l]-a[l]);else{var p=Util.colorToRGBA(a[l]);f=Util.colorToRGBA(e[l]),a[l]=p,o.push({r:f.r-p.r,g:f.g-p.g,b:f.b-p.b,a:f.a-p.a})}else for(l=0;l<d;l++)o.push(e[l]-a[l]);else colorAttrs.indexOf(t)!==-1?(a=Util.colorToRGBA(a),f=Util.colorToRGBA(e),o={r:f.r-a.r,g:f.g-a.g,b:f.b-a.b,a:f.a-a.a}):o=e-a;Tween.attrs[n][this._id][t]={start:a,diff:o,end:e,trueEnd:u,trueStart:c},Tween.tweens[n][t]=this._id}_tweenFunc(t){var e=this.node,r=Tween.attrs[e._id][this._id],n,a,o,h,l,d,u,c;for(n in r){if(a=r[n],o=a.start,h=a.diff,c=a.end,Util._isArray(o))if(l=[],u=Math.max(o.length,c.length),n.indexOf("fill")===0)for(d=0;d<u;d++)d%2===0?l.push((o[d]||0)+h[d]*t):l.push("rgba("+Math.round(o[d].r+h[d].r*t)+","+Math.round(o[d].g+h[d].g*t)+","+Math.round(o[d].b+h[d].b*t)+","+(o[d].a+h[d].a*t)+")");else for(d=0;d<u;d++)l.push((o[d]||0)+h[d]*t);else colorAttrs.indexOf(n)!==-1?l="rgba("+Math.round(o.r+h.r*t)+","+Math.round(o.g+h.g*t)+","+Math.round(o.b+h.b*t)+","+(o.a+h.a*t)+")":l=o+h*t;e.setAttr(n,l)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var t=this.node,e=Tween.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var t=this.node,e=Tween.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(t*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var t=this.node._id,e=this._id,r=Tween.tweens[t],n;this.pause();for(n in r)delete Tween.tweens[t][n];delete Tween.attrs[t][e]}}Tween.attrs={};Tween.tweens={};Node.prototype.to=function(i){var t=i.onFinish;i.node=this,i.onFinish=function(){this.destroy(),t&&t()};var e=new Tween(i);e.play()};const Easings={BackEaseIn(i,t,e,r){var n=1.70158;return e*(i/=r)*i*((n+1)*i-n)+t},BackEaseOut(i,t,e,r){var n=1.70158;return e*((i=i/r-1)*i*((n+1)*i+n)+1)+t},BackEaseInOut(i,t,e,r){var n=1.70158;return(i/=r/2)<1?e/2*(i*i*(((n*=1.525)+1)*i-n))+t:e/2*((i-=2)*i*(((n*=1.525)+1)*i+n)+2)+t},ElasticEaseIn(i,t,e,r,n,a){var o=0;return i===0?t:(i/=r)===1?t+e:(a||(a=r*.3),!n||n<Math.abs(e)?(n=e,o=a/4):o=a/(2*Math.PI)*Math.asin(e/n),-(n*Math.pow(2,10*(i-=1))*Math.sin((i*r-o)*(2*Math.PI)/a))+t)},ElasticEaseOut(i,t,e,r,n,a){var o=0;return i===0?t:(i/=r)===1?t+e:(a||(a=r*.3),!n||n<Math.abs(e)?(n=e,o=a/4):o=a/(2*Math.PI)*Math.asin(e/n),n*Math.pow(2,-10*i)*Math.sin((i*r-o)*(2*Math.PI)/a)+e+t)},ElasticEaseInOut(i,t,e,r,n,a){var o=0;return i===0?t:(i/=r/2)===2?t+e:(a||(a=r*(.3*1.5)),!n||n<Math.abs(e)?(n=e,o=a/4):o=a/(2*Math.PI)*Math.asin(e/n),i<1?-.5*(n*Math.pow(2,10*(i-=1))*Math.sin((i*r-o)*(2*Math.PI)/a))+t:n*Math.pow(2,-10*(i-=1))*Math.sin((i*r-o)*(2*Math.PI)/a)*.5+e+t)},BounceEaseOut(i,t,e,r){return(i/=r)<1/2.75?e*(7.5625*i*i)+t:i<2/2.75?e*(7.5625*(i-=1.5/2.75)*i+.75)+t:i<2.5/2.75?e*(7.5625*(i-=2.25/2.75)*i+.9375)+t:e*(7.5625*(i-=2.625/2.75)*i+.984375)+t},BounceEaseIn(i,t,e,r){return e-Easings.BounceEaseOut(r-i,0,e,r)+t},BounceEaseInOut(i,t,e,r){return i<r/2?Easings.BounceEaseIn(i*2,0,e,r)*.5+t:Easings.BounceEaseOut(i*2-r,0,e,r)*.5+e*.5+t},EaseIn(i,t,e,r){return e*(i/=r)*i+t},EaseOut(i,t,e,r){return-e*(i/=r)*(i-2)+t},EaseInOut(i,t,e,r){return(i/=r/2)<1?e/2*i*i+t:-e/2*(--i*(i-2)-1)+t},StrongEaseIn(i,t,e,r){return e*(i/=r)*i*i*i*i+t},StrongEaseOut(i,t,e,r){return e*((i=i/r-1)*i*i*i*i+1)+t},StrongEaseInOut(i,t,e,r){return(i/=r/2)<1?e/2*i*i*i*i*i+t:e/2*((i-=2)*i*i*i*i+2)+t},Linear(i,t,e,r){return e*i/r+t}},Konva$2=Util._assign(Konva$3,{Util,Transform,Node,Container,Stage,stages,Layer,FastLayer,Group,DD,Shape,shapes,Animation,Tween,Easings,Context,Canvas});class Arc extends Shape{_sceneFunc(t){var e=Konva$3.getAngle(this.angle()),r=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,r),t.arc(0,0,this.innerRadius(),e,0,!r),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),r=this.clockwise(),n=Konva$3.getAngle(r?360-this.angle():this.angle()),a=Math.cos(Math.min(n,Math.PI)),o=1,h=Math.sin(Math.min(Math.max(Math.PI,n),3*Math.PI/2)),l=Math.sin(Math.min(n,Math.PI/2)),d=a*(a>0?t:e),u=o*e,c=h*(h>0?t:e),f=l*(l>0?e:t);return{x:d,y:r?-1*f:c,width:u-d,height:f-c}}}Arc.prototype._centroid=!0;Arc.prototype.className="Arc";Arc.prototype._attrsAffectingSize=["innerRadius","outerRadius"];_registerNode(Arc);Factory.addGetterSetter(Arc,"innerRadius",0,getNumberValidator());Factory.addGetterSetter(Arc,"outerRadius",0,getNumberValidator());Factory.addGetterSetter(Arc,"angle",0,getNumberValidator());Factory.addGetterSetter(Arc,"clockwise",!1,getBooleanValidator());function getControlPoints(i,t,e,r,n,a,o){var h=Math.sqrt(Math.pow(e-i,2)+Math.pow(r-t,2)),l=Math.sqrt(Math.pow(n-e,2)+Math.pow(a-r,2)),d=o*h/(h+l),u=o*l/(h+l),c=e-d*(n-i),f=r-d*(a-t),p=e+u*(n-i),g=r+u*(a-t);return[c,f,p,g]}function expandPoints(i,t){var e=i.length,r=[],n,a;for(n=2;n<e-2;n+=2)a=getControlPoints(i[n-2],i[n-1],i[n],i[n+1],i[n+2],i[n+3],t),!isNaN(a[0])&&(r.push(a[0]),r.push(a[1]),r.push(i[n]),r.push(i[n+1]),r.push(a[2]),r.push(a[3]));return r}class Line extends Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){var e=this.points(),r=e.length,n=this.tension(),a=this.closed(),o=this.bezier(),h,l,d;if(!!r){if(t.beginPath(),t.moveTo(e[0],e[1]),n!==0&&r>4){for(h=this.getTensionPoints(),l=h.length,d=a?0:4,a||t.quadraticCurveTo(h[0],h[1],h[2],h[3]);d<l-2;)t.bezierCurveTo(h[d++],h[d++],h[d++],h[d++],h[d++],h[d++]);a||t.quadraticCurveTo(h[l-2],h[l-1],e[r-2],e[r-1])}else if(o)for(d=2;d<r;)t.bezierCurveTo(e[d++],e[d++],e[d++],e[d++],e[d++],e[d++]);else for(d=2;d<r;d+=2)t.lineTo(e[d],e[d+1]);a?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():expandPoints(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,r=this.tension(),n=getControlPoints(t[e-2],t[e-1],t[0],t[1],t[2],t[3],r),a=getControlPoints(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],r),o=expandPoints(t,r),h=[n[2],n[3]].concat(o).concat([a[0],a[1],t[e-2],t[e-1],a[2],a[3],n[0],n[1],t[0],t[1]]);return h}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:t=this.points();for(var e=t[0],r=t[0],n=t[1],a=t[1],o,h,l=0;l<t.length/2;l++)o=t[l*2],h=t[l*2+1],e=Math.min(e,o),r=Math.max(r,o),n=Math.min(n,h),a=Math.max(a,h);return{x:e,y:n,width:r-e,height:a-n}}}Line.prototype.className="Line";Line.prototype._attrsAffectingSize=["points","bezier","tension"];_registerNode(Line);Factory.addGetterSetter(Line,"closed",!1);Factory.addGetterSetter(Line,"bezier",!1);Factory.addGetterSetter(Line,"tension",0,getNumberValidator());Factory.addGetterSetter(Line,"points",[],getNumberArrayValidator());class Path extends Shape{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this.dataArray=Path.parsePathData(this.data()),this.pathLength=0;for(var e=0;e<this.dataArray.length;++e)this.pathLength+=this.dataArray[e].pathLength;this.on("dataChange.konva",function(){this.dataArray=Path.parsePathData(this.data()),this.pathLength=0;for(var r=0;r<this.dataArray.length;++r)this.pathLength+=this.dataArray[r].pathLength})}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var r=!1,n=0;n<e.length;n++){var a=e[n].command,o=e[n].points;switch(a){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var h=o[0],l=o[1],d=o[2],u=o[3],c=o[4],f=o[5],p=o[6],g=o[7],_=d>u?d:u,v=d>u?1:d/u,E=d>u?u/d:1;t.translate(h,l),t.rotate(p),t.scale(v,E),t.arc(0,0,_,c,c+f,1-g),t.scale(1/v,1/E),t.rotate(-p),t.translate(-h,-l);break;case"z":r=!0,t.closePath();break}}!r&&!this.hasFill()?t.strokeShape(this):t.fillStrokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach(function(d){if(d.command==="A"){var u=d.points[4],c=d.points[5],f=d.points[4]+c,p=Math.PI/180;if(Math.abs(u-f)<p&&(p=Math.abs(u-f)),c<0)for(let g=u-p;g>f;g-=p){const _=Path.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],g,0);t.push(_.x,_.y)}else for(let g=u+p;g<f;g+=p){const _=Path.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],g,0);t.push(_.x,_.y)}}else if(d.command==="C")for(let g=0;g<=1;g+=.01){const _=Path.getPointOnCubicBezier(g,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3],d.points[4],d.points[5]);t.push(_.x,_.y)}else t=t.concat(d.points)});for(var e=t[0],r=t[0],n=t[1],a=t[1],o,h,l=0;l<t.length/2;l++)o=t[l*2],h=t[l*2+1],isNaN(o)||(e=Math.min(e,o),r=Math.max(r,o)),isNaN(h)||(n=Math.min(n,h),a=Math.max(a,h));return{x:e,y:n,width:r-e,height:a-n}}getLength(){return this.pathLength}getPointAtLength(t){var e,r=0,n=this.dataArray.length;if(!n)return null;for(;r<n&&t>this.dataArray[r].pathLength;)t-=this.dataArray[r].pathLength,++r;if(r===n)return e=this.dataArray[r-1].points.slice(-2),{x:e[0],y:e[1]};if(t<.01)return e=this.dataArray[r].points.slice(0,2),{x:e[0],y:e[1]};var a=this.dataArray[r],o=a.points;switch(a.command){case"L":return Path.getPointOnLine(t,a.start.x,a.start.y,o[0],o[1]);case"C":return Path.getPointOnCubicBezier(t/a.pathLength,a.start.x,a.start.y,o[0],o[1],o[2],o[3],o[4],o[5]);case"Q":return Path.getPointOnQuadraticBezier(t/a.pathLength,a.start.x,a.start.y,o[0],o[1],o[2],o[3]);case"A":var h=o[0],l=o[1],d=o[2],u=o[3],c=o[4],f=o[5],p=o[6];return c+=f*t/a.pathLength,Path.getPointOnEllipticalArc(h,l,d,u,c,p)}return null}static getLineLength(t,e,r,n){return Math.sqrt((r-t)*(r-t)+(n-e)*(n-e))}static getPointOnLine(t,e,r,n,a,o,h){o===void 0&&(o=e),h===void 0&&(h=r);var l=(a-r)/(n-e+1e-8),d=Math.sqrt(t*t/(1+l*l));n<e&&(d*=-1);var u=l*d,c;if(n===e)c={x:o,y:h+u};else if((h-r)/(o-e+1e-8)===l)c={x:o+d,y:h+u};else{var f,p,g=this.getLineLength(e,r,n,a),_=(o-e)*(n-e)+(h-r)*(a-r);_=_/(g*g),f=e+_*(n-e),p=r+_*(a-r);var v=this.getLineLength(o,h,f,p),E=Math.sqrt(t*t-v*v);d=Math.sqrt(E*E/(1+l*l)),n<e&&(d*=-1),u=l*d,c={x:f+d,y:p+u}}return c}static getPointOnCubicBezier(t,e,r,n,a,o,h,l,d){function u(v){return v*v*v}function c(v){return 3*v*v*(1-v)}function f(v){return 3*v*(1-v)*(1-v)}function p(v){return(1-v)*(1-v)*(1-v)}var g=l*u(t)+o*c(t)+n*f(t)+e*p(t),_=d*u(t)+h*c(t)+a*f(t)+r*p(t);return{x:g,y:_}}static getPointOnQuadraticBezier(t,e,r,n,a,o,h){function l(p){return p*p}function d(p){return 2*p*(1-p)}function u(p){return(1-p)*(1-p)}var c=o*l(t)+n*d(t)+e*u(t),f=h*l(t)+a*d(t)+r*u(t);return{x:c,y:f}}static getPointOnEllipticalArc(t,e,r,n,a,o){var h=Math.cos(o),l=Math.sin(o),d={x:r*Math.cos(a),y:n*Math.sin(a)};return{x:t+(d.x*h-d.y*l),y:e+(d.x*l+d.y*h)}}static parsePathData(t){if(!t)return[];var e=t,r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<r.length;n++)e=e.replace(new RegExp(r[n],"g"),"|"+r[n]);var a=e.split("|"),o=[],h=[],l=0,d=0,u=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c;for(n=1;n<a.length;n++){var f=a[n],p=f.charAt(0);for(f=f.slice(1),h.length=0;c=u.exec(f);)h.push(c[0]);for(var g=[],_=0,v=h.length;_<v;_++){if(h[_]==="00"){g.push(0,0);continue}var E=parseFloat(h[_]);isNaN(E)?g.push(0):g.push(E)}for(;g.length>0&&!isNaN(g[0]);){var C=null,m=[],A=l,S=d,w,y,b,O,T,P,R,x,I,L;switch(p){case"l":l+=g.shift(),d+=g.shift(),C="L",m.push(l,d);break;case"L":l=g.shift(),d=g.shift(),m.push(l,d);break;case"m":var N=g.shift(),D=g.shift();if(l+=N,d+=D,C="M",o.length>2&&o[o.length-1].command==="z"){for(var $=o.length-2;$>=0;$--)if(o[$].command==="M"){l=o[$].points[0]+N,d=o[$].points[1]+D;break}}m.push(l,d),p="l";break;case"M":l=g.shift(),d=g.shift(),C="M",m.push(l,d),p="L";break;case"h":l+=g.shift(),C="L",m.push(l,d);break;case"H":l=g.shift(),C="L",m.push(l,d);break;case"v":d+=g.shift(),C="L",m.push(l,d);break;case"V":d=g.shift(),C="L",m.push(l,d);break;case"C":m.push(g.shift(),g.shift(),g.shift(),g.shift()),l=g.shift(),d=g.shift(),m.push(l,d);break;case"c":m.push(l+g.shift(),d+g.shift(),l+g.shift(),d+g.shift()),l+=g.shift(),d+=g.shift(),C="C",m.push(l,d);break;case"S":y=l,b=d,w=o[o.length-1],w.command==="C"&&(y=l+(l-w.points[2]),b=d+(d-w.points[3])),m.push(y,b,g.shift(),g.shift()),l=g.shift(),d=g.shift(),C="C",m.push(l,d);break;case"s":y=l,b=d,w=o[o.length-1],w.command==="C"&&(y=l+(l-w.points[2]),b=d+(d-w.points[3])),m.push(y,b,l+g.shift(),d+g.shift()),l+=g.shift(),d+=g.shift(),C="C",m.push(l,d);break;case"Q":m.push(g.shift(),g.shift()),l=g.shift(),d=g.shift(),m.push(l,d);break;case"q":m.push(l+g.shift(),d+g.shift()),l+=g.shift(),d+=g.shift(),C="Q",m.push(l,d);break;case"T":y=l,b=d,w=o[o.length-1],w.command==="Q"&&(y=l+(l-w.points[0]),b=d+(d-w.points[1])),l=g.shift(),d=g.shift(),C="Q",m.push(y,b,l,d);break;case"t":y=l,b=d,w=o[o.length-1],w.command==="Q"&&(y=l+(l-w.points[0]),b=d+(d-w.points[1])),l+=g.shift(),d+=g.shift(),C="Q",m.push(y,b,l,d);break;case"A":O=g.shift(),T=g.shift(),P=g.shift(),R=g.shift(),x=g.shift(),I=l,L=d,l=g.shift(),d=g.shift(),C="A",m=this.convertEndpointToCenterParameterization(I,L,l,d,R,x,O,T,P);break;case"a":O=g.shift(),T=g.shift(),P=g.shift(),R=g.shift(),x=g.shift(),I=l,L=d,l+=g.shift(),d+=g.shift(),C="A",m=this.convertEndpointToCenterParameterization(I,L,l,d,R,x,O,T,P);break}o.push({command:C||p,points:m,start:{x:A,y:S},pathLength:this.calcLength(A,S,C||p,m)})}(p==="z"||p==="Z")&&o.push({command:"z",points:[],start:void 0,pathLength:0})}return o}static calcLength(t,e,r,n){var a,o,h,l,d=Path;switch(r){case"L":return d.getLineLength(t,e,n[0],n[1]);case"C":for(a=0,o=d.getPointOnCubicBezier(0,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),l=.01;l<=1;l+=.01)h=d.getPointOnCubicBezier(l,t,e,n[0],n[1],n[2],n[3],n[4],n[5]),a+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;return a;case"Q":for(a=0,o=d.getPointOnQuadraticBezier(0,t,e,n[0],n[1],n[2],n[3]),l=.01;l<=1;l+=.01)h=d.getPointOnQuadraticBezier(l,t,e,n[0],n[1],n[2],n[3]),a+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;return a;case"A":a=0;var u=n[4],c=n[5],f=n[4]+c,p=Math.PI/180;if(Math.abs(u-f)<p&&(p=Math.abs(u-f)),o=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],u,0),c<0)for(l=u-p;l>f;l-=p)h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),a+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;else for(l=u+p;l<f;l+=p)h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),a+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;return h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],f,0),a+=d.getLineLength(o.x,o.y,h.x,h.y),a}return 0}static convertEndpointToCenterParameterization(t,e,r,n,a,o,h,l,d){var u=d*(Math.PI/180),c=Math.cos(u)*(t-r)/2+Math.sin(u)*(e-n)/2,f=-1*Math.sin(u)*(t-r)/2+Math.cos(u)*(e-n)/2,p=c*c/(h*h)+f*f/(l*l);p>1&&(h*=Math.sqrt(p),l*=Math.sqrt(p));var g=Math.sqrt((h*h*(l*l)-h*h*(f*f)-l*l*(c*c))/(h*h*(f*f)+l*l*(c*c)));a===o&&(g*=-1),isNaN(g)&&(g=0);var _=g*h*f/l,v=g*-l*c/h,E=(t+r)/2+Math.cos(u)*_-Math.sin(u)*v,C=(e+n)/2+Math.sin(u)*_+Math.cos(u)*v,m=function(T){return Math.sqrt(T[0]*T[0]+T[1]*T[1])},A=function(T,P){return(T[0]*P[0]+T[1]*P[1])/(m(T)*m(P))},S=function(T,P){return(T[0]*P[1]<T[1]*P[0]?-1:1)*Math.acos(A(T,P))},w=S([1,0],[(c-_)/h,(f-v)/l]),y=[(c-_)/h,(f-v)/l],b=[(-1*c-_)/h,(-1*f-v)/l],O=S(y,b);return A(y,b)<=-1&&(O=Math.PI),A(y,b)>=1&&(O=0),o===0&&O>0&&(O=O-2*Math.PI),o===1&&O<0&&(O=O+2*Math.PI),[E,C,h,l,w,O,u,o]}}Path.prototype.className="Path";Path.prototype._attrsAffectingSize=["data"];_registerNode(Path);Factory.addGetterSetter(Path,"data");class Arrow extends Line{_sceneFunc(t){super._sceneFunc(t);var e=Math.PI*2,r=this.points(),n=r,a=this.tension()!==0&&r.length>4;a&&(n=this.getTensionPoints());var o=this.pointerLength(),h=r.length,l,d;if(a){const f=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],r[h-2],r[h-1]],p=Path.calcLength(n[n.length-4],n[n.length-3],"C",f),g=Path.getPointOnQuadraticBezier(Math.min(1,1-o/p),f[0],f[1],f[2],f[3],f[4],f[5]);l=r[h-2]-g.x,d=r[h-1]-g.y}else l=r[h-2]-r[h-4],d=r[h-1]-r[h-3];var u=(Math.atan2(d,l)+e)%e,c=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(r[h-2],r[h-1]),t.rotate(u),t.moveTo(0,0),t.lineTo(-o,c/2),t.lineTo(-o,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(r[0],r[1]),a?(l=(n[0]+n[2])/2-r[0],d=(n[1]+n[3])/2-r[1]):(l=r[2]-r[0],d=r[3]-r[1]),t.rotate((Math.atan2(-d,-l)+e)%e),t.moveTo(0,0),t.lineTo(-o,c/2),t.lineTo(-o,-c/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+e*2,height:t.height+e*2}}}Arrow.prototype.className="Arrow";_registerNode(Arrow);Factory.addGetterSetter(Arrow,"pointerLength",10,getNumberValidator());Factory.addGetterSetter(Arrow,"pointerWidth",10,getNumberValidator());Factory.addGetterSetter(Arrow,"pointerAtBeginning",!1);Factory.addGetterSetter(Arrow,"pointerAtEnding",!0);class Circle$1 extends Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}Circle$1.prototype._centroid=!0;Circle$1.prototype.className="Circle";Circle$1.prototype._attrsAffectingSize=["radius"];_registerNode(Circle$1);Factory.addGetterSetter(Circle$1,"radius",0,getNumberValidator());class Ellipse extends Shape{_sceneFunc(t){var e=this.radiusX(),r=this.radiusY();t.beginPath(),t.save(),e!==r&&t.scale(1,r/e),t.arc(0,0,e,0,Math.PI*2,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}Ellipse.prototype.className="Ellipse";Ellipse.prototype._centroid=!0;Ellipse.prototype._attrsAffectingSize=["radiusX","radiusY"];_registerNode(Ellipse);Factory.addComponentsGetterSetter(Ellipse,"radius",["x","y"]);Factory.addGetterSetter(Ellipse,"radiusX",0,getNumberValidator());Factory.addGetterSetter(Ellipse,"radiusY",0,getNumberValidator());class Image$1 extends Shape{constructor(t){super(t),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&t.readyState===4||t&&t.addEventListener&&t.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),r=this.getHeight(),n=this.cornerRadius(),a=this.attrs.image;let o;if(a){const h=this.attrs.cropWidth,l=this.attrs.cropHeight;h&&l?o=[a,this.cropX(),this.cropY(),h,l,0,0,e,r]:o=[a,0,0,e,r]}(this.hasFill()||this.hasStroke()||n)&&(t.beginPath(),n?Util.drawRoundedRectPath(t,e,r,n):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)),a&&(n&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){var e=this.width(),r=this.height(),n=this.cornerRadius();t.beginPath(),n?Util.drawRoundedRectPath(t,e,r,n):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return(t=this.attrs.width)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.width}getHeight(){var t,e;return(t=this.attrs.height)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.height}static fromURL(t,e,r=null){var n=Util.createImageElement();n.onload=function(){var a=new Image$1({image:n});e(a)},n.onerror=r,n.crossOrigin="Anonymous",n.src=t}}Image$1.prototype.className="Image";_registerNode(Image$1);Factory.addGetterSetter(Image$1,"cornerRadius",0,getNumberOrArrayOfNumbersValidator(4));Factory.addGetterSetter(Image$1,"image");Factory.addComponentsGetterSetter(Image$1,"crop",["x","y","width","height"]);Factory.addGetterSetter(Image$1,"cropX",0,getNumberValidator());Factory.addGetterSetter(Image$1,"cropY",0,getNumberValidator());Factory.addGetterSetter(Image$1,"cropWidth",0,getNumberValidator());Factory.addGetterSetter(Image$1,"cropHeight",0,getNumberValidator());var ATTR_CHANGE_LIST$2=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],CHANGE_KONVA$1="Change.konva",NONE$1="none",UP="up",RIGHT$1="right",DOWN="down",LEFT$1="left",attrChangeListLen$1=ATTR_CHANGE_LIST$2.length;class Label extends Group{constructor(t){super(t),this.on("add.konva",function(e){this._addListeners(e.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e=this,r,n=function(){e._sync()};for(r=0;r<attrChangeListLen$1;r++)t.on(ATTR_CHANGE_LIST$2[r]+CHANGE_KONVA$1,n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t=this.getText(),e=this.getTag(),r,n,a,o,h,l,d;if(t&&e){switch(r=t.width(),n=t.height(),a=e.pointerDirection(),o=e.pointerWidth(),d=e.pointerHeight(),h=0,l=0,a){case UP:h=r/2,l=-1*d;break;case RIGHT$1:h=r+o,l=n/2;break;case DOWN:h=r/2,l=n+d;break;case LEFT$1:h=-1*o,l=n/2;break}e.setAttrs({x:-1*h,y:-1*l,width:r,height:n}),t.setAttrs({x:-1*h,y:-1*l})}}}Label.prototype.className="Label";_registerNode(Label);class Tag extends Shape{_sceneFunc(t){var e=this.width(),r=this.height(),n=this.pointerDirection(),a=this.pointerWidth(),o=this.pointerHeight(),h=this.cornerRadius();let l=0,d=0,u=0,c=0;typeof h=="number"?l=d=u=c=Math.min(h,e/2,r/2):(l=Math.min(h[0]||0,e/2,r/2),d=Math.min(h[1]||0,e/2,r/2),c=Math.min(h[2]||0,e/2,r/2),u=Math.min(h[3]||0,e/2,r/2)),t.beginPath(),t.moveTo(l,0),n===UP&&(t.lineTo((e-a)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+a)/2,0)),t.lineTo(e-d,0),t.arc(e-d,d,d,Math.PI*3/2,0,!1),n===RIGHT$1&&(t.lineTo(e,(r-o)/2),t.lineTo(e+a,r/2),t.lineTo(e,(r+o)/2)),t.lineTo(e,r-c),t.arc(e-c,r-c,c,0,Math.PI/2,!1),n===DOWN&&(t.lineTo((e+a)/2,r),t.lineTo(e/2,r+o),t.lineTo((e-a)/2,r)),t.lineTo(u,r),t.arc(u,r-u,u,Math.PI/2,Math.PI,!1),n===LEFT$1&&(t.lineTo(0,(r+o)/2),t.lineTo(-1*a,r/2),t.lineTo(0,(r-o)/2)),t.lineTo(0,l),t.arc(l,l,l,Math.PI,Math.PI*3/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,r=this.pointerWidth(),n=this.pointerHeight(),a=this.pointerDirection(),o=this.width(),h=this.height();return a===UP?(e-=n,h+=n):a===DOWN?h+=n:a===LEFT$1?(t-=r*1.5,o+=r):a===RIGHT$1&&(o+=r*1.5),{x:t,y:e,width:o,height:h}}}Tag.prototype.className="Tag";_registerNode(Tag);Factory.addGetterSetter(Tag,"pointerDirection",NONE$1);Factory.addGetterSetter(Tag,"pointerWidth",0,getNumberValidator());Factory.addGetterSetter(Tag,"pointerHeight",0,getNumberValidator());Factory.addGetterSetter(Tag,"cornerRadius",0,getNumberOrArrayOfNumbersValidator(4));class Rect$1 extends Shape{_sceneFunc(t){var e=this.cornerRadius(),r=this.width(),n=this.height();t.beginPath(),e?Util.drawRoundedRectPath(t,r,n,e):t.rect(0,0,r,n),t.closePath(),t.fillStrokeShape(this)}}Rect$1.prototype.className="Rect";_registerNode(Rect$1);Factory.addGetterSetter(Rect$1,"cornerRadius",0,getNumberOrArrayOfNumbersValidator(4));class RegularPolygon extends Shape{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var r=1;r<e.length;r++)t.lineTo(e[r].x,e[r].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,r=[];for(var n=0;n<t;n++)r.push({x:e*Math.sin(n*2*Math.PI/t),y:-1*e*Math.cos(n*2*Math.PI/t)});return r}getSelfRect(){const t=this._getPoints();var e=t[0].x,r=t[0].y,n=t[0].x,a=t[0].y;return t.forEach(o=>{e=Math.min(e,o.x),r=Math.max(r,o.x),n=Math.min(n,o.y),a=Math.max(a,o.y)}),{x:e,y:n,width:r-e,height:a-n}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}RegularPolygon.prototype.className="RegularPolygon";RegularPolygon.prototype._centroid=!0;RegularPolygon.prototype._attrsAffectingSize=["radius"];_registerNode(RegularPolygon);Factory.addGetterSetter(RegularPolygon,"radius",0,getNumberValidator());Factory.addGetterSetter(RegularPolygon,"sides",0,getNumberValidator());var PIx2=Math.PI*2;class Ring extends Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,PIx2,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),PIx2,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}Ring.prototype.className="Ring";Ring.prototype._centroid=!0;Ring.prototype._attrsAffectingSize=["innerRadius","outerRadius"];_registerNode(Ring);Factory.addGetterSetter(Ring,"innerRadius",0,getNumberValidator());Factory.addGetterSetter(Ring,"outerRadius",0,getNumberValidator());class Sprite extends Shape{constructor(t){super(t),this._updated=!0,this.anim=new Animation(()=>{var e=this._updated;return this._updated=!1,e}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){!this.anim.isRunning()||(clearInterval(this.interval),this._setInterval())})}_sceneFunc(t){var e=this.animation(),r=this.frameIndex(),n=r*4,a=this.animations()[e],o=this.frameOffsets(),h=a[n+0],l=a[n+1],d=a[n+2],u=a[n+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,d,u),t.closePath(),t.fillStrokeShape(this)),c)if(o){var f=o[e],p=r*2;t.drawImage(c,h,l,d,u,f[p+0],f[p+1],d,u)}else t.drawImage(c,h,l,d,u,0,0,d,u)}_hitFunc(t){var e=this.animation(),r=this.frameIndex(),n=r*4,a=this.animations()[e],o=this.frameOffsets(),h=a[n+2],l=a[n+3];if(t.beginPath(),o){var d=o[e],u=r*2;t.rect(d[u+0],d[u+1],h,l)}else t.rect(0,0,h,l);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation(),r=this.animations(),n=r[e],a=n.length/4;t<a-1?this.frameIndex(t+1):this.frameIndex(0)}}Sprite.prototype.className="Sprite";_registerNode(Sprite);Factory.addGetterSetter(Sprite,"animation");Factory.addGetterSetter(Sprite,"animations");Factory.addGetterSetter(Sprite,"frameOffsets");Factory.addGetterSetter(Sprite,"image");Factory.addGetterSetter(Sprite,"frameIndex",0,getNumberValidator());Factory.addGetterSetter(Sprite,"frameRate",17,getNumberValidator());Factory.backCompat(Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class Star extends Shape{_sceneFunc(t){var e=this.innerRadius(),r=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-r);for(var a=1;a<n*2;a++){var o=a%2===0?r:e,h=o*Math.sin(a*Math.PI/n),l=-1*o*Math.cos(a*Math.PI/n);t.lineTo(h,l)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}Star.prototype.className="Star";Star.prototype._centroid=!0;Star.prototype._attrsAffectingSize=["innerRadius","outerRadius"];_registerNode(Star);Factory.addGetterSetter(Star,"numPoints",5,getNumberValidator());Factory.addGetterSetter(Star,"innerRadius",0,getNumberValidator());Factory.addGetterSetter(Star,"outerRadius",0,getNumberValidator());function stringToArray(i){return Array.from(i)}var AUTO="auto",CENTER="center",JUSTIFY="justify",CHANGE_KONVA="Change.konva",CONTEXT_2D="2d",DASH="-",LEFT="left",TEXT="text",TEXT_UPPER="Text",TOP="top",BOTTOM="bottom",MIDDLE="middle",NORMAL$1="normal",PX_SPACE="px ",SPACE=" ",RIGHT="right",WORD="word",CHAR="char",NONE="none",ELLIPSIS="\u2026",ATTR_CHANGE_LIST$1=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],attrChangeListLen=ATTR_CHANGE_LIST$1.length;function normalizeFontFamily(i){return i.split(",").map(t=>{t=t.trim();const e=t.indexOf(" ")>=0,r=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!r&&(t=`"${t}"`),t}).join(", ")}var dummyContext;function getDummyContext(){return dummyContext||(dummyContext=Util.createCanvasElement().getContext(CONTEXT_2D),dummyContext)}function _fillFunc$1(i){i.fillText(this._partialText,this._partialTextX,this._partialTextY)}function _strokeFunc$1(i){i.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function checkDefaultFill(i){return i=i||{},!i.fillLinearGradientColorStops&&!i.fillRadialGradientColorStops&&!i.fillPatternImage&&(i.fill=i.fill||"black"),i}class Text$1 extends Shape{constructor(t){super(checkDefaultFill(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<attrChangeListLen;e++)this.on(ATTR_CHANGE_LIST$1[e]+CHANGE_KONVA,this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,r=e.length;if(!!this.text()){var n=this.padding(),a=this.fontSize(),o=this.lineHeight()*a,h=this.verticalAlign(),l=0,d=this.align(),u=this.getWidth(),c=this.letterSpacing(),f=this.fill(),p=this.textDecoration(),g=p.indexOf("underline")!==-1,_=p.indexOf("line-through")!==-1,v,E=0,E=o/2,C=0,m=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",MIDDLE),t.setAttr("textAlign",LEFT),h===MIDDLE?l=(this.getHeight()-r*o-n*2)/2:h===BOTTOM&&(l=this.getHeight()-r*o-n*2),t.translate(n,l+n),v=0;v<r;v++){var C=0,m=0,A=e[v],S=A.text,w=A.width,y=A.lastInParagraph,b,O,T;if(t.save(),d===RIGHT?C+=u-w-n*2:d===CENTER&&(C+=(u-w-n*2)/2),g){t.save(),t.beginPath(),t.moveTo(C,E+m+Math.round(a/2)),b=S.split(" ").length-1,O=b===0,T=d===JUSTIFY&&!y?u-n*2:w,t.lineTo(C+Math.round(T),E+m+Math.round(a/2)),t.lineWidth=a/15;const N=this._getLinearGradient();t.strokeStyle=N||f,t.stroke(),t.restore()}if(_){t.save(),t.beginPath(),t.moveTo(C,E+m),b=S.split(" ").length-1,O=b===0,T=d===JUSTIFY&&y&&!O?u-n*2:w,t.lineTo(C+Math.round(T),E+m),t.lineWidth=a/15;const N=this._getLinearGradient();t.strokeStyle=N||f,t.stroke(),t.restore()}if(c!==0||d===JUSTIFY){b=S.split(" ").length-1;for(var P=stringToArray(S),R=0;R<P.length;R++){var x=P[R];x===" "&&!y&&d===JUSTIFY&&(C+=(u-n*2-w)/b),this._partialTextX=C,this._partialTextY=E+m,this._partialText=x,t.fillStrokeShape(this),C+=this.measureSize(x).width+c}}else this._partialTextX=C,this._partialTextY=E+m,this._partialText=S,t.fillStrokeShape(this);t.restore(),r>1&&(E+=o)}}}_hitFunc(t){var e=this.getWidth(),r=this.getHeight();t.beginPath(),t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=Util._isString(t)?t:t==null?"":t+"";return this._setAttr(TEXT,e),this}getWidth(){var t=this.attrs.width===AUTO||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var t=this.attrs.height===AUTO||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e=getDummyContext(),r=this.fontSize(),n;return e.save(),e.font=this._getContextFont(),n=e.measureText(t),e.restore(),{width:n.width,height:r}}_getContextFont(){return this.fontStyle()+SPACE+this.fontVariant()+SPACE+(this.fontSize()+PX_SPACE)+normalizeFontFamily(this.fontFamily())}_addTextLine(t){this.align()===JUSTIFY&&(t=t.trim());var r=this._getTextWidth(t);return this.textArr.push({text:t,width:r,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),r=t.length;return getDummyContext().measureText(t).width+(r?e*(r-1):0)}_setTextData(){var t=this.text().split(`
`),e=+this.fontSize(),r=0,n=this.lineHeight()*e,a=this.attrs.width,o=this.attrs.height,h=a!==AUTO&&a!==void 0,l=o!==AUTO&&o!==void 0,d=this.padding(),u=a-d*2,c=o-d*2,f=0,p=this.wrap(),g=p!==NONE,_=p!==CHAR&&g,v=this.ellipsis();this.textArr=[],getDummyContext().font=this._getContextFont();for(var E=v?this._getTextWidth(ELLIPSIS):0,C=0,m=t.length;C<m;++C){var A=t[C],S=this._getTextWidth(A);if(h&&S>u)for(;A.length>0;){for(var w=0,y=A.length,b="",O=0;w<y;){var T=w+y>>>1,P=A.slice(0,T+1),R=this._getTextWidth(P)+E;R<=u?(w=T+1,b=P,O=R):y=T}if(b){if(_){var x,I=A[b.length],L=I===SPACE||I===DASH;L&&O<=u?x=b.length:x=Math.max(b.lastIndexOf(SPACE),b.lastIndexOf(DASH))+1,x>0&&(w=x,b=b.slice(0,w),O=this._getTextWidth(b))}b=b.trimRight(),this._addTextLine(b),r=Math.max(r,O),f+=n;var N=this._shouldHandleEllipsis(f);if(N){this._tryToAddEllipsisToLastLine();break}if(A=A.slice(w),A=A.trimLeft(),A.length>0&&(S=this._getTextWidth(A),S<=u)){this._addTextLine(A),f+=n,r=Math.max(r,S);break}}else break}else this._addTextLine(A),f+=n,r=Math.max(r,S),this._shouldHandleEllipsis(f)&&C<m-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&f+n>c)break}this.textHeight=e,this.textWidth=r}_shouldHandleEllipsis(t){var e=+this.fontSize(),r=this.lineHeight()*e,n=this.attrs.height,a=n!==AUTO&&n!==void 0,o=this.padding(),h=n-o*2,l=this.wrap(),d=l!==NONE;return!d||a&&t+r>h}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==AUTO&&t!==void 0,r=this.padding(),n=t-r*2,a=this.ellipsis(),o=this.textArr[this.textArr.length-1];if(!(!o||!a)){if(e){var h=this._getTextWidth(o.text+ELLIPSIS)<n;h||(o.text=o.text.slice(0,o.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(o.text+ELLIPSIS)}}getStrokeScaleEnabled(){return!0}}Text$1.prototype._fillFunc=_fillFunc$1;Text$1.prototype._strokeFunc=_strokeFunc$1;Text$1.prototype.className=TEXT_UPPER;Text$1.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];_registerNode(Text$1);Factory.overWriteSetter(Text$1,"width",getNumberOrAutoValidator());Factory.overWriteSetter(Text$1,"height",getNumberOrAutoValidator());Factory.addGetterSetter(Text$1,"fontFamily","Arial");Factory.addGetterSetter(Text$1,"fontSize",12,getNumberValidator());Factory.addGetterSetter(Text$1,"fontStyle",NORMAL$1);Factory.addGetterSetter(Text$1,"fontVariant",NORMAL$1);Factory.addGetterSetter(Text$1,"padding",0,getNumberValidator());Factory.addGetterSetter(Text$1,"align",LEFT);Factory.addGetterSetter(Text$1,"verticalAlign",TOP);Factory.addGetterSetter(Text$1,"lineHeight",1,getNumberValidator());Factory.addGetterSetter(Text$1,"wrap",WORD);Factory.addGetterSetter(Text$1,"ellipsis",!1,getBooleanValidator());Factory.addGetterSetter(Text$1,"letterSpacing",0,getNumberValidator());Factory.addGetterSetter(Text$1,"text","",getStringValidator());Factory.addGetterSetter(Text$1,"textDecoration","");var EMPTY_STRING="",NORMAL="normal";function _fillFunc(i){i.fillText(this.partialText,0,0)}function _strokeFunc(i){i.strokeText(this.partialText,0,0)}class TextPath extends Shape{constructor(t){super(t),this.dummyCanvas=Util.createCanvasElement(),this.dataArray=[],this.dataArray=Path.parsePathData(this.attrs.data),this.on("dataChange.konva",function(){this.dataArray=Path.parsePathData(this.attrs.data),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),r=this.fill(),n=this.fontSize(),a=this.glyphInfo;e==="underline"&&t.beginPath();for(var o=0;o<a.length;o++){t.save();var h=a[o].p0;t.translate(h.x,h.y),t.rotate(a[o].rotation),this.partialText=a[o].text,t.fillStrokeShape(this),e==="underline"&&(o===0&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}e==="underline"&&(t.strokeStyle=r,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var r=e[0].p0;t.moveTo(r.x,r.y)}for(var n=0;n<e.length;n++){var a=e[n].p1;t.lineTo(a.x,a.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Text$1.prototype.setText.call(this,t)}_getContextFont(){return Text$1.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas,r=e.getContext("2d");r.save(),r.font=this._getContextFont();var n=r.measureText(t);return r.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}}_setTextData(){var t=this,e=this._getTextSize(this.attrs.text),r=this.letterSpacing(),n=this.align(),a=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var o=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);this.glyphInfo=[];for(var h=0,l=0;l<t.dataArray.length;l++)t.dataArray[l].pathLength>0&&(h+=t.dataArray[l].pathLength);var d=0;n==="center"&&(d=Math.max(0,h/2-o/2)),n==="right"&&(d=Math.max(0,h-o));for(var u=stringToArray(this.text()),c=this.text().split(" ").length-1,f,p,g,_=-1,v=0,E=function(){v=0;for(var R=t.dataArray,x=_+1;x<R.length;x++){if(R[x].pathLength>0)return _=x,R[x];R[x].command==="M"&&(f={x:R[x].points[0],y:R[x].points[1]})}return{}},C=function(R){var x=t._getTextSize(R).width+r;R===" "&&n==="justify"&&(x+=(h-o)/c);var I=0,L=0;for(p=void 0;Math.abs(x-I)/x>.01&&L<20;){L++;for(var N=I;g===void 0;)g=E(),g&&N+g.pathLength<x&&(N+=g.pathLength,g=void 0);if(Object.keys(g).length===0||f===void 0)return;var D=!1;switch(g.command){case"L":Path.getLineLength(f.x,f.y,g.points[0],g.points[1])>x?p=Path.getPointOnLine(x,f.x,f.y,g.points[0],g.points[1],f.x,f.y):g=void 0;break;case"A":var $=g.points[4],F=g.points[5],M=g.points[4]+F;v===0?v=$+1e-8:x>I?v+=Math.PI/180*F/Math.abs(F):v-=Math.PI/360*F/Math.abs(F),(F<0&&v<M||F>=0&&v>M)&&(v=M,D=!0),p=Path.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],v,g.points[6]);break;case"C":v===0?x>g.pathLength?v=1e-8:v=x/g.pathLength:x>I?v+=(x-I)/g.pathLength/2:v=Math.max(v-(I-x)/g.pathLength/2,0),v>1&&(v=1,D=!0),p=Path.getPointOnCubicBezier(v,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3],g.points[4],g.points[5]);break;case"Q":v===0?v=x/g.pathLength:x>I?v+=(x-I)/g.pathLength:v-=(I-x)/g.pathLength,v>1&&(v=1,D=!0),p=Path.getPointOnQuadraticBezier(v,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3]);break}p!==void 0&&(I=Path.getLineLength(f.x,f.y,p.x,p.y)),D&&(D=!1,g=void 0)}},m="C",A=t._getTextSize(m).width+r,S=d/A-1,w=0;w<S&&(C(m),!(f===void 0||p===void 0));w++)f=p;for(var y=0;y<u.length&&(C(u[y]),!(f===void 0||p===void 0));y++){var b=Path.getLineLength(f.x,f.y,p.x,p.y),O=0;if(a)try{O=a(u[y-1],u[y])*this.fontSize()}catch{O=0}f.x+=O,p.x+=O,this.textWidth+=O;var T=Path.getPointOnLine(O+b/2,f.x,f.y,p.x,p.y),P=Math.atan2(p.y-f.y,p.x-f.x);this.glyphInfo.push({transposeX:T.x,transposeY:T.y,text:u[y],rotation:P,p0:f,p1:p}),f=p}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach(function(u){t.push(u.p0.x),t.push(u.p0.y),t.push(u.p1.x),t.push(u.p1.y)});for(var e=t[0]||0,r=t[0]||0,n=t[1]||0,a=t[1]||0,o,h,l=0;l<t.length/2;l++)o=t[l*2],h=t[l*2+1],e=Math.min(e,o),r=Math.max(r,o),n=Math.min(n,h),a=Math.max(a,h);var d=this.fontSize();return{x:e-d/2,y:n-d/2,width:r-e+d,height:a-n+d}}destroy(){return Util.releaseCanvas(this.dummyCanvas),super.destroy()}}TextPath.prototype._fillFunc=_fillFunc;TextPath.prototype._strokeFunc=_strokeFunc;TextPath.prototype._fillFuncHit=_fillFunc;TextPath.prototype._strokeFuncHit=_strokeFunc;TextPath.prototype.className="TextPath";TextPath.prototype._attrsAffectingSize=["text","fontSize","data"];_registerNode(TextPath);Factory.addGetterSetter(TextPath,"data");Factory.addGetterSetter(TextPath,"fontFamily","Arial");Factory.addGetterSetter(TextPath,"fontSize",12,getNumberValidator());Factory.addGetterSetter(TextPath,"fontStyle",NORMAL);Factory.addGetterSetter(TextPath,"align","left");Factory.addGetterSetter(TextPath,"letterSpacing",0,getNumberValidator());Factory.addGetterSetter(TextPath,"textBaseline","middle");Factory.addGetterSetter(TextPath,"fontVariant",NORMAL);Factory.addGetterSetter(TextPath,"text",EMPTY_STRING);Factory.addGetterSetter(TextPath,"textDecoration",null);Factory.addGetterSetter(TextPath,"kerningFunc",null);var EVENTS_NAME="tr-konva",ATTR_CHANGE_LIST=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map(i=>i+`.${EVENTS_NAME}`).join(" "),NODES_RECT="nodesRect",TRANSFORM_CHANGE_STR=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],ANGLES={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const TOUCH_DEVICE="ontouchstart"in Konva$3._global;function getCursor(i,t){if(i==="rotater")return"crosshair";t+=Util.degToRad(ANGLES[i]||0);var e=(Util.radToDeg(t)%360+360)%360;return Util._inRange(e,315+22.5,360)||Util._inRange(e,0,22.5)?"ns-resize":Util._inRange(e,45-22.5,45+22.5)?"nesw-resize":Util._inRange(e,90-22.5,90+22.5)?"ew-resize":Util._inRange(e,135-22.5,135+22.5)?"nwse-resize":Util._inRange(e,180-22.5,180+22.5)?"ns-resize":Util._inRange(e,225-22.5,225+22.5)?"nesw-resize":Util._inRange(e,270-22.5,270+22.5)?"ew-resize":Util._inRange(e,315-22.5,315+22.5)?"nwse-resize":(Util.error("Transformer has unknown angle for cursor detection: "+e),"pointer")}var ANCHORS_NAMES=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],MAX_SAFE_INTEGER=1e8;function getCenter(i){return{x:i.x+i.width/2*Math.cos(i.rotation)+i.height/2*Math.sin(-i.rotation),y:i.y+i.height/2*Math.cos(i.rotation)+i.width/2*Math.sin(i.rotation)}}function rotateAroundPoint(i,t,e){const r=e.x+(i.x-e.x)*Math.cos(t)-(i.y-e.y)*Math.sin(t),n=e.y+(i.x-e.x)*Math.sin(t)+(i.y-e.y)*Math.cos(t);return Object.assign(Object.assign({},i),{rotation:i.rotation+t,x:r,y:n})}function rotateAroundCenter(i,t){const e=getCenter(i);return rotateAroundPoint(i,t,e)}function getSnap(i,t,e){let r=t;for(let n=0;n<i.length;n++){const a=Konva$3.getAngle(i[n]),o=Math.abs(a-t)%(Math.PI*2);Math.min(o,Math.PI*2-o)<e&&(r=a)}return r}class Transformer extends Group{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(ATTR_CHANGE_LIST,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return EVENTS_NAME+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter(n=>n.isAncestorOf(this)?(Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=t=e,t.length===1&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(n=>{const a=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},o=n._attrsAffectingSize.map(h=>h+"Change."+this._getEventNamespace()).join(" ");n.on(o,a),n.on(TRANSFORM_CHANGE_STR.map(h=>h+`.${this._getEventNamespace()}`).join(" "),a),n.on(`absoluteTransformChange.${this._getEventNamespace()}`,a),this._proxyDrag(n)}),this._resetTransformCache();var r=!!this.findOne(".top-left");return r&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,r=>{e=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back")&&this.startDrag(r,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!e)return;const n=t.getAbsolutePosition(),a=n.x-e.x,o=n.y-e.y;this.nodes().forEach(h=>{if(h===t||h.isDragging())return;const l=h.getAbsolutePosition();h.setAbsolutePosition({x:l.x+a,y:l.y+o}),h.startDrag(r)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(NODES_RECT),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(NODES_RECT,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),r){var n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),a=t.getAbsoluteScale(r),o=t.getAbsolutePosition(r),h=n.x*a.x-t.offsetX()*a.x,l=n.y*a.y-t.offsetY()*a.y;const d=(Konva$3.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),u={x:o.x+h*Math.cos(d)+l*Math.sin(-d),y:o.y+l*Math.cos(d)+h*Math.sin(d),width:n.width*a.x,height:n.height*a.y,rotation:d};return rotateAroundPoint(u,-Konva$3.getAngle(e),{x:0,y:0})}__getNodeRect(){var t=this.getNode();if(!t)return{x:-MAX_SAFE_INTEGER,y:-MAX_SAFE_INTEGER,width:0,height:0,rotation:0};const e=[];this.nodes().map(d=>{const u=d.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var c=[{x:u.x,y:u.y},{x:u.x+u.width,y:u.y},{x:u.x+u.width,y:u.y+u.height},{x:u.x,y:u.y+u.height}],f=d.getAbsoluteTransform();c.forEach(function(p){var g=f.point(p);e.push(g)})});const r=new Transform;r.rotate(-Konva$3.getAngle(this.rotation()));var n,a,o,h;e.forEach(function(d){var u=r.point(d);n===void 0&&(n=o=u.x,a=h=u.y),n=Math.min(n,u.x),a=Math.min(a,u.y),o=Math.max(o,u.x),h=Math.max(h,u.y)}),r.invert();const l=r.point({x:n,y:a});return{x:l.x,y:l.y,width:o-n,height:h-a,rotation:Konva$3.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),ANCHORS_NAMES.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new Rect$1({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:TOUCH_DEVICE?10:"auto"}),r=this;e.on("mousedown touchstart",function(n){r._handleMouseDown(n)}),e.on("dragstart",n=>{e.stopDrag(),n.cancelBubble=!0}),e.on("dragend",n=>{n.cancelBubble=!0}),e.on("mouseenter",()=>{var n=Konva$3.getAngle(this.rotation()),a=getCursor(t,n);e.getStage().content&&(e.getStage().content.style.cursor=a),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){var t=new Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(e){var r=this.getParent(),n=r.padding();e.beginPath(),e.rect(-n,-n,this.width()+n*2,this.height()+n*2),e.moveTo(this.width()/2,-n),r.rotateEnabled()&&e.lineTo(this.width()/2,-r.rotateAnchorOffset()*Util._sign(this.height())-n),e.fillStrokeShape(this)},hitFunc:(e,r)=>{if(!!this.shouldOverdrawWholeArea()){var n=this.padding();e.beginPath(),e.rect(-n,-n,r.width()+n*2,r.height()+n*2),e.fillStrokeShape(r)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",e=>{e.cancelBubble=!0}),t.on("dragmove",e=>{e.cancelBubble=!0}),t.on("dragend",e=>{e.cancelBubble=!0}),this.on("dragmove",e=>{this.update()})}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),r=e.width,n=e.height,a=Math.sqrt(Math.pow(r,2)+Math.pow(n,2));this.sin=Math.abs(n/a),this.cos=Math.abs(r/a),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var o=t.target.getAbsolutePosition(),h=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:h.x-o.x,y:h.y-o.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:t.evt,target:l})})}_handleMouseMove(t){var e,r,n,a=this.findOne("."+this._movingAnchorName),o=a.getStage();o.setPointersPositions(t);const h=o.getPointerPosition();let l={x:h.x-this._anchorDragOffset.x,y:h.y-this._anchorDragOffset.y};const d=a.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(d,l,t)),a.setAbsolutePosition(l);const u=a.getAbsolutePosition();if(!(d.x===u.x&&d.y===u.y)){if(this._movingAnchorName==="rotater"){var c=this._getNodeRect();e=a.x()-c.width/2,r=-a.y()+c.height/2;let R=Math.atan2(-r,e)+Math.PI/2;c.height<0&&(R-=Math.PI);var f=Konva$3.getAngle(this.rotation());const x=f+R,I=Konva$3.getAngle(this.rotationSnapTolerance()),N=getSnap(this.rotationSnaps(),x,I)-c.rotation,D=rotateAroundCenter(c,N);this._fitNodesInto(D,t);return}var p=this.keepRatio()||t.shiftKey,C=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(p){var g=C?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(g.x-a.x(),2)+Math.pow(g.y-a.y(),2));var _=this.findOne(".top-left").x()>g.x?-1:1,v=this.findOne(".top-left").y()>g.y?-1:1;e=n*this.cos*_,r=n*this.sin*v,this.findOne(".top-left").x(g.x-e),this.findOne(".top-left").y(g.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(a.y());else if(this._movingAnchorName==="top-right"){if(p){var g=C?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(a.x()-g.x,2)+Math.pow(g.y-a.y(),2));var _=this.findOne(".top-right").x()<g.x?-1:1,v=this.findOne(".top-right").y()>g.y?-1:1;e=n*this.cos*_,r=n*this.sin*v,this.findOne(".top-right").x(g.x+e),this.findOne(".top-right").y(g.y-r)}var E=a.position();this.findOne(".top-left").y(E.y),this.findOne(".bottom-right").x(E.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(a.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(a.x());else if(this._movingAnchorName==="bottom-left"){if(p){var g=C?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(g.x-a.x(),2)+Math.pow(a.y()-g.y,2));var _=g.x<a.x()?-1:1,v=a.y()<g.y?-1:1;e=n*this.cos*_,r=n*this.sin*v,a.x(g.x-e),a.y(g.y+r)}E=a.position(),this.findOne(".top-left").x(E.x),this.findOne(".bottom-right").y(E.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(a.y());else if(this._movingAnchorName==="bottom-right"){if(p){var g=C?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(a.x()-g.x,2)+Math.pow(a.y()-g.y,2));var _=this.findOne(".bottom-right").x()<g.x?-1:1,v=this.findOne(".bottom-right").y()<g.y?-1:1;e=n*this.cos*_,r=n*this.sin*v,this.findOne(".bottom-right").x(g.x+e),this.findOne(".bottom-right").y(g.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var C=this.centeredScaling()||t.altKey;if(C){var m=this.findOne(".top-left"),A=this.findOne(".bottom-right"),S=m.x(),w=m.y(),y=this.getWidth()-A.x(),b=this.getHeight()-A.y();A.move({x:-S,y:-w}),m.move({x:y,y:b})}var O=this.findOne(".top-left").getAbsolutePosition();e=O.x,r=O.y;var T=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),P=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:r,width:T,height:P,rotation:Konva$3.getAngle(this.rotation())},t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(r=>{r._fire("transformend",{evt:t,target:r})}),this._movingAnchorName=null}}_fitNodesInto(t,e){var r=this._getNodeRect();const n=1;if(Util._inRange(t.width,-this.padding()*2-n,n)){this.update();return}if(Util._inRange(t.height,-this.padding()*2-n,n)){this.update();return}const a=this.flipEnabled();var o=new Transform;if(o.rotate(Konva$3.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const c=o.point({x:-this.padding()*2,y:0});if(t.x+=c.x,t.y+=c.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=c.x,this._anchorDragOffset.y-=c.y,!a){this.update();return}}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const c=o.point({x:this.padding()*2,y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=c.x,this._anchorDragOffset.y-=c.y,t.width+=this.padding()*2,!a){this.update();return}}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const c=o.point({x:0,y:-this.padding()*2});if(t.x+=c.x,t.y+=c.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=c.x,this._anchorDragOffset.y-=c.y,t.height+=this.padding()*2,!a){this.update();return}}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const c=o.point({x:0,y:this.padding()*2});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=c.x,this._anchorDragOffset.y-=c.y,t.height+=this.padding()*2,!a){this.update();return}}if(this.boundBoxFunc()){const c=this.boundBoxFunc()(r,t);c?t=c:Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const h=1e7,l=new Transform;l.translate(r.x,r.y),l.rotate(r.rotation),l.scale(r.width/h,r.height/h);const d=new Transform;d.translate(t.x,t.y),d.rotate(t.rotation),d.scale(t.width/h,t.height/h);const u=d.multiply(l.invert());this._nodes.forEach(c=>{var f;const p=c.getParent().getAbsoluteTransform(),g=c.getTransform().copy();g.translate(c.offsetX(),c.offsetY());const _=new Transform;_.multiply(p.copy().invert()).multiply(u).multiply(p).multiply(g);const v=_.decompose();c.setAttrs(v),this._fire("transform",{evt:e,target:c}),c._fire("transform",{evt:e,target:c}),(f=c.getLayer())===null||f===void 0||f.batchDraw()}),this.rotation(Util._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(Util._getRotation(e.rotation));var r=e.width,n=e.height,a=this.enabledAnchors(),o=this.resizeEnabled(),h=this.padding(),l=this.anchorSize();this.find("._anchor").forEach(d=>{d.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+h,offsetY:l/2+h,visible:o&&a.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:l/2+h,visible:o&&a.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:l/2-h,offsetY:l/2+h,visible:o&&a.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:l/2+h,visible:o&&a.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:n/2,offsetX:l/2-h,visible:o&&a.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:l/2+h,offsetY:l/2-h,visible:o&&a.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:n,offsetY:l/2-h,visible:o&&a.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:n,offsetX:l/2-h,offsetY:l/2-h,visible:o&&a.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*Util._sign(n)-h,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),(t=this.getLayer())===null||t===void 0||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Node.prototype.toObject.call(this)}clone(t){var e=Node.prototype.clone.call(this,t);return e}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}function validateAnchors(i){return i instanceof Array||Util.warn("enabledAnchors value should be an array"),i instanceof Array&&i.forEach(function(t){ANCHORS_NAMES.indexOf(t)===-1&&Util.warn("Unknown anchor name: "+t+". Available names are: "+ANCHORS_NAMES.join(", "))}),i||[]}Transformer.prototype.className="Transformer";_registerNode(Transformer);Factory.addGetterSetter(Transformer,"enabledAnchors",ANCHORS_NAMES,validateAnchors);Factory.addGetterSetter(Transformer,"flipEnabled",!0,getBooleanValidator());Factory.addGetterSetter(Transformer,"resizeEnabled",!0);Factory.addGetterSetter(Transformer,"anchorSize",10,getNumberValidator());Factory.addGetterSetter(Transformer,"rotateEnabled",!0);Factory.addGetterSetter(Transformer,"rotationSnaps",[]);Factory.addGetterSetter(Transformer,"rotateAnchorOffset",50,getNumberValidator());Factory.addGetterSetter(Transformer,"rotationSnapTolerance",5,getNumberValidator());Factory.addGetterSetter(Transformer,"borderEnabled",!0);Factory.addGetterSetter(Transformer,"anchorStroke","rgb(0, 161, 255)");Factory.addGetterSetter(Transformer,"anchorStrokeWidth",1,getNumberValidator());Factory.addGetterSetter(Transformer,"anchorFill","white");Factory.addGetterSetter(Transformer,"anchorCornerRadius",0,getNumberValidator());Factory.addGetterSetter(Transformer,"borderStroke","rgb(0, 161, 255)");Factory.addGetterSetter(Transformer,"borderStrokeWidth",1,getNumberValidator());Factory.addGetterSetter(Transformer,"borderDash");Factory.addGetterSetter(Transformer,"keepRatio",!0);Factory.addGetterSetter(Transformer,"centeredScaling",!1);Factory.addGetterSetter(Transformer,"ignoreStroke",!1);Factory.addGetterSetter(Transformer,"padding",0,getNumberValidator());Factory.addGetterSetter(Transformer,"node");Factory.addGetterSetter(Transformer,"nodes");Factory.addGetterSetter(Transformer,"boundBoxFunc");Factory.addGetterSetter(Transformer,"anchorDragBoundFunc");Factory.addGetterSetter(Transformer,"shouldOverdrawWholeArea",!1);Factory.addGetterSetter(Transformer,"useSingleNodeRotation",!0);Factory.backCompat(Transformer,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Wedge extends Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,Konva$3.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}Wedge.prototype.className="Wedge";Wedge.prototype._centroid=!0;Wedge.prototype._attrsAffectingSize=["radius"];_registerNode(Wedge);Factory.addGetterSetter(Wedge,"radius",0,getNumberValidator());Factory.addGetterSetter(Wedge,"angle",0,getNumberValidator());Factory.addGetterSetter(Wedge,"clockwise",!1);Factory.backCompat(Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function filterGaussBlurRGBA(i,t){var e=i.data,r=i.width,n=i.height,a,o,h,l,d,u,c,f,p,g,_,v,E,C,m,A,S,w,y,b,O,T,P,R,x=t+t+1,I=r-1,L=n-1,N=t+1,D=N*(N+1)/2,$=new BlurStack,F=null,M=$,k=null,B=null,U=mul_table[t],G=shg_table[t];for(h=1;h<x;h++)M=M.next=new BlurStack,h===N&&(F=M);for(M.next=$,c=u=0,o=0;o<n;o++){for(A=S=w=y=f=p=g=_=0,v=N*(b=e[u]),E=N*(O=e[u+1]),C=N*(T=e[u+2]),m=N*(P=e[u+3]),f+=D*b,p+=D*O,g+=D*T,_+=D*P,M=$,h=0;h<N;h++)M.r=b,M.g=O,M.b=T,M.a=P,M=M.next;for(h=1;h<N;h++)l=u+((I<h?I:h)<<2),f+=(M.r=b=e[l])*(R=N-h),p+=(M.g=O=e[l+1])*R,g+=(M.b=T=e[l+2])*R,_+=(M.a=P=e[l+3])*R,A+=b,S+=O,w+=T,y+=P,M=M.next;for(k=$,B=F,a=0;a<r;a++)e[u+3]=P=_*U>>G,P!==0?(P=255/P,e[u]=(f*U>>G)*P,e[u+1]=(p*U>>G)*P,e[u+2]=(g*U>>G)*P):e[u]=e[u+1]=e[u+2]=0,f-=v,p-=E,g-=C,_-=m,v-=k.r,E-=k.g,C-=k.b,m-=k.a,l=c+((l=a+t+1)<I?l:I)<<2,A+=k.r=e[l],S+=k.g=e[l+1],w+=k.b=e[l+2],y+=k.a=e[l+3],f+=A,p+=S,g+=w,_+=y,k=k.next,v+=b=B.r,E+=O=B.g,C+=T=B.b,m+=P=B.a,A-=b,S-=O,w-=T,y-=P,B=B.next,u+=4;c+=r}for(a=0;a<r;a++){for(S=w=y=A=p=g=_=f=0,u=a<<2,v=N*(b=e[u]),E=N*(O=e[u+1]),C=N*(T=e[u+2]),m=N*(P=e[u+3]),f+=D*b,p+=D*O,g+=D*T,_+=D*P,M=$,h=0;h<N;h++)M.r=b,M.g=O,M.b=T,M.a=P,M=M.next;for(d=r,h=1;h<=t;h++)u=d+a<<2,f+=(M.r=b=e[u])*(R=N-h),p+=(M.g=O=e[u+1])*R,g+=(M.b=T=e[u+2])*R,_+=(M.a=P=e[u+3])*R,A+=b,S+=O,w+=T,y+=P,M=M.next,h<L&&(d+=r);for(u=a,k=$,B=F,o=0;o<n;o++)l=u<<2,e[l+3]=P=_*U>>G,P>0?(P=255/P,e[l]=(f*U>>G)*P,e[l+1]=(p*U>>G)*P,e[l+2]=(g*U>>G)*P):e[l]=e[l+1]=e[l+2]=0,f-=v,p-=E,g-=C,_-=m,v-=k.r,E-=k.g,C-=k.b,m-=k.a,l=a+((l=o+N)<L?l:L)*r<<2,f+=A+=k.r=e[l],p+=S+=k.g=e[l+1],g+=w+=k.b=e[l+2],_+=y+=k.a=e[l+3],k=k.next,v+=b=B.r,E+=O=B.g,C+=T=B.b,m+=P=B.a,A-=b,S-=O,w-=T,y-=P,B=B.next,u+=r}}const Blur=function(t){var e=Math.round(this.blurRadius());e>0&&filterGaussBlurRGBA(t,e)};Factory.addGetterSetter(Node,"blurRadius",0,getNumberValidator(),Factory.afterSetFilter);const Brighten=function(i){var t=this.brightness()*255,e=i.data,r=e.length,n;for(n=0;n<r;n+=4)e[n]+=t,e[n+1]+=t,e[n+2]+=t};Factory.addGetterSetter(Node,"brightness",0,getNumberValidator(),Factory.afterSetFilter);const Contrast=function(i){var t=Math.pow((this.contrast()+100)/100,2),e=i.data,r=e.length,n=150,a=150,o=150,h;for(h=0;h<r;h+=4)n=e[h],a=e[h+1],o=e[h+2],n/=255,n-=.5,n*=t,n+=.5,n*=255,a/=255,a-=.5,a*=t,a+=.5,a*=255,o/=255,o-=.5,o*=t,o+=.5,o*=255,n=n<0?0:n>255?255:n,a=a<0?0:a>255?255:a,o=o<0?0:o>255?255:o,e[h]=n,e[h+1]=a,e[h+2]=o};Factory.addGetterSetter(Node,"contrast",0,getNumberValidator(),Factory.afterSetFilter);const Emboss=function(i){var t=this.embossStrength()*10,e=this.embossWhiteLevel()*255,r=this.embossDirection(),n=this.embossBlend(),a=0,o=0,h=i.data,l=i.width,d=i.height,u=l*4,c=d;switch(r){case"top-left":a=-1,o=-1;break;case"top":a=-1,o=0;break;case"top-right":a=-1,o=1;break;case"right":a=0,o=1;break;case"bottom-right":a=1,o=1;break;case"bottom":a=1,o=0;break;case"bottom-left":a=1,o=-1;break;case"left":a=0,o=-1;break;default:Util.error("Unknown emboss direction: "+r)}do{var f=(c-1)*u,p=a;c+p<1&&(p=0),c+p>d&&(p=0);var g=(c-1+p)*l*4,_=l;do{var v=f+(_-1)*4,E=o;_+E<1&&(E=0),_+E>l&&(E=0);var C=g+(_-1+E)*4,m=h[v]-h[C],A=h[v+1]-h[C+1],S=h[v+2]-h[C+2],w=m,y=w>0?w:-w,b=A>0?A:-A,O=S>0?S:-S;if(b>y&&(w=A),O>y&&(w=S),w*=t,n){var T=h[v]+w,P=h[v+1]+w,R=h[v+2]+w;h[v]=T>255?255:T<0?0:T,h[v+1]=P>255?255:P<0?0:P,h[v+2]=R>255?255:R<0?0:R}else{var x=e-w;x<0?x=0:x>255&&(x=255),h[v]=h[v+1]=h[v+2]=x}}while(--_)}while(--c)};Factory.addGetterSetter(Node,"embossStrength",.5,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"embossWhiteLevel",.5,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"embossDirection","top-left",null,Factory.afterSetFilter);Factory.addGetterSetter(Node,"embossBlend",!1,null,Factory.afterSetFilter);function remap(i,t,e,r,n){var a=e-t,o=n-r,h;return a===0?r+o/2:o===0?r:(h=(i-t)/a,h=o*h+r,h)}const Enhance=function(i){var t=i.data,e=t.length,r=t[0],n=r,a,o=t[1],h=o,l,d=t[2],u=d,c,f,p=this.enhance();if(p!==0){for(f=0;f<e;f+=4)a=t[f+0],a<r?r=a:a>n&&(n=a),l=t[f+1],l<o?o=l:l>h&&(h=l),c=t[f+2],c<d?d=c:c>u&&(u=c);n===r&&(n=255,r=0),h===o&&(h=255,o=0),u===d&&(u=255,d=0);var g,_,v,E,C,m,A,S,w;for(p>0?(_=n+p*(255-n),v=r-p*(r-0),C=h+p*(255-h),m=o-p*(o-0),S=u+p*(255-u),w=d-p*(d-0)):(g=(n+r)*.5,_=n+p*(n-g),v=r+p*(r-g),E=(h+o)*.5,C=h+p*(h-E),m=o+p*(o-E),A=(u+d)*.5,S=u+p*(u-A),w=d+p*(d-A)),f=0;f<e;f+=4)t[f+0]=remap(t[f+0],r,n,v,_),t[f+1]=remap(t[f+1],o,h,m,C),t[f+2]=remap(t[f+2],d,u,w,S)}};Factory.addGetterSetter(Node,"enhance",0,getNumberValidator(),Factory.afterSetFilter);const Grayscale=function(i){var t=i.data,e=t.length,r,n;for(r=0;r<e;r+=4)n=.34*t[r]+.5*t[r+1]+.16*t[r+2],t[r]=n,t[r+1]=n,t[r+2]=n};Factory.addGetterSetter(Node,"hue",0,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"saturation",0,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"luminance",0,getNumberValidator(),Factory.afterSetFilter);const HSL=function(i){var t=i.data,e=t.length,r=1,n=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,o=this.luminance()*127,h,l=r*n*Math.cos(a*Math.PI/180),d=r*n*Math.sin(a*Math.PI/180),u=.299*r+.701*l+.167*d,c=.587*r-.587*l+.33*d,f=.114*r-.114*l-.497*d,p=.299*r-.299*l-.328*d,g=.587*r+.413*l+.035*d,_=.114*r-.114*l+.293*d,v=.299*r-.3*l+1.25*d,E=.587*r-.586*l-1.05*d,C=.114*r+.886*l-.2*d,m,A,S,w;for(h=0;h<e;h+=4)m=t[h+0],A=t[h+1],S=t[h+2],w=t[h+3],t[h+0]=u*m+c*A+f*S+o,t[h+1]=p*m+g*A+_*S+o,t[h+2]=v*m+E*A+C*S+o,t[h+3]=w},HSV=function(i){var t=i.data,e=t.length,r=Math.pow(2,this.value()),n=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,o,h=r*n*Math.cos(a*Math.PI/180),l=r*n*Math.sin(a*Math.PI/180),d=.299*r+.701*h+.167*l,u=.587*r-.587*h+.33*l,c=.114*r-.114*h-.497*l,f=.299*r-.299*h-.328*l,p=.587*r+.413*h+.035*l,g=.114*r-.114*h+.293*l,_=.299*r-.3*h+1.25*l,v=.587*r-.586*h-1.05*l,E=.114*r+.886*h-.2*l,C,m,A,S;for(o=0;o<e;o+=4)C=t[o+0],m=t[o+1],A=t[o+2],S=t[o+3],t[o+0]=d*C+u*m+c*A,t[o+1]=f*C+p*m+g*A,t[o+2]=_*C+v*m+E*A,t[o+3]=S};Factory.addGetterSetter(Node,"hue",0,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"saturation",0,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"value",0,getNumberValidator(),Factory.afterSetFilter);const Invert=function(i){var t=i.data,e=t.length,r;for(r=0;r<e;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]};var ToPolar=function(i,t,e){var r=i.data,n=t.data,a=i.width,o=i.height,h=e.polarCenterX||a/2,l=e.polarCenterY||o/2,d,u,c,f=0,p=0,g=0,_=0,v,E=Math.sqrt(h*h+l*l);u=a-h,c=o-l,v=Math.sqrt(u*u+c*c),E=v>E?v:E;var C=o,m=a,A,S,w=360/m*Math.PI/180,y,b;for(S=0;S<m;S+=1)for(y=Math.sin(S*w),b=Math.cos(S*w),A=0;A<C;A+=1)u=Math.floor(h+E*A/C*b),c=Math.floor(l+E*A/C*y),d=(c*a+u)*4,f=r[d+0],p=r[d+1],g=r[d+2],_=r[d+3],d=(S+A*a)*4,n[d+0]=f,n[d+1]=p,n[d+2]=g,n[d+3]=_},FromPolar=function(i,t,e){var r=i.data,n=t.data,a=i.width,o=i.height,h=e.polarCenterX||a/2,l=e.polarCenterY||o/2,d,u,c,f,p,g=0,_=0,v=0,E=0,C,m=Math.sqrt(h*h+l*l);u=a-h,c=o-l,C=Math.sqrt(u*u+c*c),m=C>m?C:m;var A=o,S=a,w,y,b=e.polarRotation||0,O,T;for(u=0;u<a;u+=1)for(c=0;c<o;c+=1)f=u-h,p=c-l,w=Math.sqrt(f*f+p*p)*A/m,y=(Math.atan2(p,f)*180/Math.PI+360+b)%360,y=y*S/360,O=Math.floor(y),T=Math.floor(w),d=(T*a+O)*4,g=r[d+0],_=r[d+1],v=r[d+2],E=r[d+3],d=(c*a+u)*4,n[d+0]=g,n[d+1]=_,n[d+2]=v,n[d+3]=E};const Kaleidoscope=function(i){var t=i.width,e=i.height,r,n,a,o,h,l,d,u,c,f,p=Math.round(this.kaleidoscopePower()),g=Math.round(this.kaleidoscopeAngle()),_=Math.floor(t*(g%360)/360);if(!(p<1)){var v=Util.createCanvasElement();v.width=t,v.height=e;var E=v.getContext("2d").getImageData(0,0,t,e);Util.releaseCanvas(v),ToPolar(i,E,{polarCenterX:t/2,polarCenterY:e/2});for(var C=t/Math.pow(2,p);C<=8;)C=C*2,p-=1;C=Math.ceil(C);var m=C,A=0,S=m,w=1;for(_+C>t&&(A=m,S=0,w=-1),n=0;n<e;n+=1)for(r=A;r!==S;r+=w)a=Math.round(r+_)%t,c=(t*n+a)*4,h=E.data[c+0],l=E.data[c+1],d=E.data[c+2],u=E.data[c+3],f=(t*n+r)*4,E.data[f+0]=h,E.data[f+1]=l,E.data[f+2]=d,E.data[f+3]=u;for(n=0;n<e;n+=1)for(m=Math.floor(C),o=0;o<p;o+=1){for(r=0;r<m+1;r+=1)c=(t*n+r)*4,h=E.data[c+0],l=E.data[c+1],d=E.data[c+2],u=E.data[c+3],f=(t*n+m*2-r-1)*4,E.data[f+0]=h,E.data[f+1]=l,E.data[f+2]=d,E.data[f+3]=u;m*=2}FromPolar(E,i,{polarRotation:0})}};Factory.addGetterSetter(Node,"kaleidoscopePower",2,getNumberValidator(),Factory.afterSetFilter);Factory.addGetterSetter(Node,"kaleidoscopeAngle",0,getNumberValidator(),Factory.afterSetFilter);function pixelAt(i,t,e){var r=(e*i.width+t)*4,n=[];return n.push(i.data[r++],i.data[r++],i.data[r++],i.data[r++]),n}function rgbDistance(i,t){return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow(i[2]-t[2],2))}function rgbMean(i){for(var t=[0,0,0],e=0;e<i.length;e++)t[0]+=i[e][0],t[1]+=i[e][1],t[2]+=i[e][2];return t[0]/=i.length,t[1]/=i.length,t[2]/=i.length,t}function backgroundMask(i,t){var e=pixelAt(i,0,0),r=pixelAt(i,i.width-1,0),n=pixelAt(i,0,i.height-1),a=pixelAt(i,i.width-1,i.height-1),o=t||10;if(rgbDistance(e,r)<o&&rgbDistance(r,a)<o&&rgbDistance(a,n)<o&&rgbDistance(n,e)<o){for(var h=rgbMean([r,e,a,n]),l=[],d=0;d<i.width*i.height;d++){var u=rgbDistance(h,[i.data[d*4],i.data[d*4+1],i.data[d*4+2]]);l[d]=u<o?0:255}return l}}function applyMask(i,t){for(var e=0;e<i.width*i.height;e++)i.data[4*e+3]=t[e]}function erodeMask(i,t,e){for(var r=[1,1,1,1,0,1,1,1,1],n=Math.round(Math.sqrt(r.length)),a=Math.floor(n/2),o=[],h=0;h<e;h++)for(var l=0;l<t;l++){for(var d=h*t+l,u=0,c=0;c<n;c++)for(var f=0;f<n;f++){var p=h+c-a,g=l+f-a;if(p>=0&&p<e&&g>=0&&g<t){var _=p*t+g,v=r[c*n+f];u+=i[_]*v}}o[d]=u===255*8?255:0}return o}function dilateMask(i,t,e){for(var r=[1,1,1,1,1,1,1,1,1],n=Math.round(Math.sqrt(r.length)),a=Math.floor(n/2),o=[],h=0;h<e;h++)for(var l=0;l<t;l++){for(var d=h*t+l,u=0,c=0;c<n;c++)for(var f=0;f<n;f++){var p=h+c-a,g=l+f-a;if(p>=0&&p<e&&g>=0&&g<t){var _=p*t+g,v=r[c*n+f];u+=i[_]*v}}o[d]=u>=255*4?255:0}return o}function smoothEdgeMask(i,t,e){for(var r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],n=Math.round(Math.sqrt(r.length)),a=Math.floor(n/2),o=[],h=0;h<e;h++)for(var l=0;l<t;l++){for(var d=h*t+l,u=0,c=0;c<n;c++)for(var f=0;f<n;f++){var p=h+c-a,g=l+f-a;if(p>=0&&p<e&&g>=0&&g<t){var _=p*t+g,v=r[c*n+f];u+=i[_]*v}}o[d]=u}return o}const Mask=function(i){var t=this.threshold(),e=backgroundMask(i,t);return e&&(e=erodeMask(e,i.width,i.height),e=dilateMask(e,i.width,i.height),e=smoothEdgeMask(e,i.width,i.height),applyMask(i,e)),i};Factory.addGetterSetter(Node,"threshold",0,getNumberValidator(),Factory.afterSetFilter);const Noise=function(i){var t=this.noise()*255,e=i.data,r=e.length,n=t/2,a;for(a=0;a<r;a+=4)e[a+0]+=n-2*n*Math.random(),e[a+1]+=n-2*n*Math.random(),e[a+2]+=n-2*n*Math.random()};Factory.addGetterSetter(Node,"noise",.2,getNumberValidator(),Factory.afterSetFilter);const Pixelate=function(i){var t=Math.ceil(this.pixelSize()),e=i.width,r=i.height,n,a,o,h,l,d,u,c=Math.ceil(e/t),f=Math.ceil(r/t),p,g,_,v,E,C,m,A=i.data;if(t<=0){Util.error("pixelSize value can not be <= 0");return}for(E=0;E<c;E+=1)for(C=0;C<f;C+=1){for(h=0,l=0,d=0,u=0,p=E*t,g=p+t,_=C*t,v=_+t,m=0,n=p;n<g;n+=1)if(!(n>=e))for(a=_;a<v;a+=1)a>=r||(o=(e*a+n)*4,h+=A[o+0],l+=A[o+1],d+=A[o+2],u+=A[o+3],m+=1);for(h=h/m,l=l/m,d=d/m,u=u/m,n=p;n<g;n+=1)if(!(n>=e))for(a=_;a<v;a+=1)a>=r||(o=(e*a+n)*4,A[o+0]=h,A[o+1]=l,A[o+2]=d,A[o+3]=u)}};Factory.addGetterSetter(Node,"pixelSize",8,getNumberValidator(),Factory.afterSetFilter);const Posterize=function(i){var t=Math.round(this.levels()*254)+1,e=i.data,r=e.length,n=255/t,a;for(a=0;a<r;a+=1)e[a]=Math.floor(e[a]/n)*n};Factory.addGetterSetter(Node,"levels",.5,getNumberValidator(),Factory.afterSetFilter);const RGB=function(i){var t=i.data,e=t.length,r=this.red(),n=this.green(),a=this.blue(),o,h;for(o=0;o<e;o+=4)h=(.34*t[o]+.5*t[o+1]+.16*t[o+2])/255,t[o]=h*r,t[o+1]=h*n,t[o+2]=h*a,t[o+3]=t[o+3]};Factory.addGetterSetter(Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});Factory.addGetterSetter(Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});Factory.addGetterSetter(Node,"blue",0,RGBComponent,Factory.afterSetFilter);const RGBA=function(i){var t=i.data,e=t.length,r=this.red(),n=this.green(),a=this.blue(),o=this.alpha(),h,l;for(h=0;h<e;h+=4)l=1-o,t[h]=r*o+t[h]*l,t[h+1]=n*o+t[h+1]*l,t[h+2]=a*o+t[h+2]*l};Factory.addGetterSetter(Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});Factory.addGetterSetter(Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});Factory.addGetterSetter(Node,"blue",0,RGBComponent,Factory.afterSetFilter);Factory.addGetterSetter(Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i});const Sepia=function(i){var t=i.data,e=t.length,r,n,a,o;for(r=0;r<e;r+=4)n=t[r+0],a=t[r+1],o=t[r+2],t[r+0]=Math.min(255,n*.393+a*.769+o*.189),t[r+1]=Math.min(255,n*.349+a*.686+o*.168),t[r+2]=Math.min(255,n*.272+a*.534+o*.131)},Solarize=function(i){var t=i.data,e=i.width,r=i.height,n=e*4,a=r;do{var o=(a-1)*n,h=e;do{var l=o+(h-1)*4,d=t[l],u=t[l+1],c=t[l+2];d>127&&(d=255-d),u>127&&(u=255-u),c>127&&(c=255-c),t[l]=d,t[l+1]=u,t[l+2]=c}while(--h)}while(--a)},Threshold=function(i){var t=this.threshold()*255,e=i.data,r=e.length,n;for(n=0;n<r;n+=1)e[n]=e[n]<t?0:255};Factory.addGetterSetter(Node,"threshold",.5,getNumberValidator(),Factory.afterSetFilter);const Konva$1=Konva$2.Util._assign(Konva$2,{Arc,Arrow,Circle:Circle$1,Ellipse,Image:Image$1,Label,Tag,Line,Path,Rect:Rect$1,RegularPolygon,Ring,Sprite,Star,Text:Text$1,TextPath,Transformer,Wedge,Filters:{Blur,Brighten,Contrast,Emboss,Enhance,Grayscale,HSL,HSV,Invert,Kaleidoscope,Mask,Noise,Pixelate,Posterize,RGB,RGBA,Sepia,Solarize,Threshold}}),configuration={placeHolderImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA6wAAAJYCAYAAABmT2v/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAHlZJREFUeNrs3Vtz4saigNEW4n4xHtt58P7/vy1+2alKZoy4GdgvBw7jcJGEJASsVZWq1BiEEKQmn7vVHf3555+bAAAAADXTcAkAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAACCFQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAAQrAAAAghUAAAAEKwAAAIIVAAAABCsAAACCFQAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAAAQrAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAAIFgBAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAAAAwQoAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAACCFQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAAQrAAAAghUAAAAEKwAAAIIVAAAABCsAAACCFQAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAABCsAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAAIFgBAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAAAAwQoAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAACCFQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAAQrAAAAghUAAAAEKwAAAIIVAAAABCsAAAAIVgAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAABCsAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAAIFgBAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAgGAFAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAAAAwQoAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAACCFQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAAQrAAAAghUAAAAEKwAAAIIVAAAABCsAAAAIVgAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAABCsAAAACFYA4Pre399dBABuVtMlAAChCgCCFQCoPFLf39/Dx8eHCwSAYAUA6hGqACBYAQCRCgCCFQBEat7nmhYMgGAFAGoTqgAgWAGA2keqUVYABCsAUKtQBQDBCgCIVAAQrAAgUvO+rmnBAAhWAKA2oQoAghUAEKkAUJCGSwAA5YVqHWNVQANwK4ywAoAYBADBCgAitT7nbPElAAQrAAjV0iyXy7BYLMJgMPCBACBYAUCkXtd6vQ7T6TRMJpOwWCxCCCF0u90Qx7EPCADBCgBCtXrz+TxMJpMwnU7DZrP57WdJkoTRaJT5PZkWDIBgBQCRmstqtQpJkoTJZBK+vr5CCCFEURSiKPotWieTSeZgBQDBCgAiNZPNZhNms1lIkiTMZrPdn0dRdPQ5X19fYT6fh06n40MEQLACgFAt1nK5DEmShCRJwnq9Pvv47wGbJEnmYDUtGADBCgAi9aDtAkpJkuwWUMprOp2G5+fnkyOxACBYAUConjSfz0OSJAcXUMprs9mE6XQa+v1+5uthlBUAwQoADxyp6/U6TCaTkCRJWK1Wu1DdX0Dp+2JKWU0mk8zBCgCCFQAeMFK3CyhNp9PfFlDaxum5f98/ThqLxSJ8fX2FZtNf8QAIVgAQqgcsl8vdvalpFlA653vEngrYyWQSxuNx5mtmWjAAghUA7jRS1+t1mM1mYTKZhOVyWeprnQrY6XSaOVgBQLACwB2G6mKxCJPJJMxms8IWULokYLcrD/d6vczX0igrAIIVAG48Ur8voHQqIo8tqPT950XKE6wAIFgB4EYj9dQCSvsBeurPDz1m/8+KitfZbBbW63VoNBq+PAAIVgC411DdLqA0nU53Cygdi9NLHTvuZrPJPCKbJEkYDoeZr7dpwQAIVgCocaRuNpvdKr9lL6CUNWTTjsjmCVYAEKwAUNNQXSwWIUmSqy6glDdkv5/v19dXWCwWod1u+3IBIFgB4BYjdbVa7UZTjy2gdAsOxWuSJJmD1bRgAAQrACL1ijabTZjP5yFJkjCfz0sLyGtvc7Pdk7Wse24BQLACIFQLcmgBpSLCMO/PD4V00abTaej3+5k/K6OsAAhWAERqydbrdZjNZhcvoFTFKOWp18gbs3mCFQAEKwBCtURFLKBUp6m0Wbe12b8OX19fodn01z4AghUAkXo1q9UqJEkSptNp7gWU6n6/56HzOxexSZKEp6enzJ+nacEACFYAROoFNptNmM1mYTqdhtlsljs4b3lhonMLPE2n08zBCgCCFQChmtN2AaUkScJ6vQ5RFGWOzntaPffUnqzb+3i73W7mz9koKwCCFQCRmsI2vCaTyW8LKOUJz3ve6uXQiOt0Os0crAAgWAEQqmds90z9voDSLYyoHnvN7fsoa7/W7687m83Cer0OjUbDlxoAwQqASL3EdgGlJEkOLqCUJT7LCtVLjrv/3DwLKeV5vel0GgaDQebvgmnBAAhWAB4+Ur8voHTtqKwierO83qURmydYAUCwAvDQobpcLnejqWmiLE08FhGYdbvP9dLpw19fX2G5XIZWq+WLD0DtRX/++efGZQAQqdewXq/DdDrdLaCUNg4fNVYPyROvvV4vjMfjzM8zLRiAqhlhBRCqldsuoDSdTn9beKioeLw0NG9p9eA8I66z2Sw8PT3d9SrJAAhWAERqatsFlCaTyb8WUCryHtO802VvOd625572vW/vE+71epm/R0ZZARCsANxFpG7NZrPdAkp59gGtagrwIyljGx0AEKwA3EyobnW73VyhCgAIVgBEKtzsd800ZQDBCoB4AAAQrACIVAAAwQogUgEABCsAtxeqq9UqxHHswwAABCuASL1+pG42mzCZTHZ7pv7nP//xwQAAghVAqF7PfD4Pn5+fIUmSsNlsQhRFRlcBAMEKIFKvY7VahclkEj4/P8PX19fuz6Mo8gEBAIIVQKxWL0mS8Pn5GWazmQ8DABCsAFzXcrkMn5+fu3tTQzCSCgAIVgCuZL1e70ZT5/P57s+FKgAgWAE46OPjo9RpwbPZbDeampWYBQAEKwCFWq1W4fPzM/z69Sv3AkpFxupyuazdNXr0GN9sNrU+vyiKQrPpf08AEKwAdxMg2ym/0+m0VoH23//+92QgnTu3S39edLDWJXYvic60zy3icXl+1m63wx9//OE/bAAEK8C1XTIteLFYhM/Pz/D5+RlWq1Vho6jb/VfLduo10r5+lnPN+57qOCIbRVHpI6VFvEYV5wmAYAWgZn7+/Bn++uuvykOybsFSZqzWferw9vyyXt+8z8v7GR/7uZgFII2GSwBwXR8fH5mf0+v1bvo9W9TpuuoSir4HAAhWgDvUarVCt9t96IAo81xdh/8/tqgEQLACkNloNKokZqoOlqJfL+vxbjHQsobl9vFFTak+dyzRC4BgBbhheaYFDwaD0Gg0Sg+CoqePVhkvjxCrl4Trtb4DYhYAwQpw56IoCoPB4GHfO/dxvS28BIBgBbgBeUZZ00wLvjQ+6jYiWtbKwI8awUWvCg0AghWAEEIInU4ntFotsfHtfQin6/2iQOQCIFgB2MkzylrHMCoqXPLsS3pv0VTH9yNMARCsADcuz7Tg4XAoEBCmAAhWAOonjuPQ7/dv4lwvXWDnmlNXbzEcr71FUNrP3mcGgGAFuGNppwVfeyGissOkrgst3cK047KnZItSAAQrwB3IMy241+uFOI5rG5JVBVVdt0jZntf391B2yOa5n7fMz0m0AiBYAR7UsXtZH1Gz2QzNZjM0Gv6aqxvRCkCmv9NdAoD6+fj4CO/v75mD9Z9//rnbUNlsNgePEUVRaLfbodPphE6nczBSl8tlmM/nYT6fh9VqdZVwOjTKWvaIcBRFhb9GGccEAMEKcOdarVbodrthNpsVHllFHeuSSDz03F6vF4bD4dmR1FarFVqtVhgOh2E2m4XJZBJWq1Wl97AeuqbbPy8zAOsWmGIXAMEK8KC2QVZGaNUhdLbnE0VReH5+Du12O/Nxut1u6HQ64efPn2GxWFQSqef+vMxR12scL08kG7kF4BA39wDUVJ7FlwaDwd3ftxnHcXh5eckVq/txNB6Pb2Y7IAAQrADcvCiKQr/fr+XCNpee03ZF3efn59BsFjNBaDAYhG63W4vrs9lsShlhvMZ3Ic/7MLoKgGAFuDF5RlnT7sl6i8bjcWGxun+9Wq1WITG9/8814rQKRfzioS5hDYBgBaBinU6n8KgrwqWBtl0FuAyXbgm0DdDv7/FYmO4vtnRvI4tGSgEQrACcdI+jrGXuM9tsNkuL4SrV8RcVACBYAe5Y3sWX7kkVo8a9Xq+Q4+yPmh6bHnzu53nEcXzw/t6qRzzTTIcGAMEK8MDiOL6rFXCrGP1stVqFr7D8fcrv91AtckrwaDQKURT965cVWYI4zbmk3dYGAAQrAEeVOYX2HoM1hHDRVjmHwu7QCOqhEdhLo7Xf7+8Wjmq327kXkSoqNE+9n2OvYeQVAMEKcKPyTAvu9XohjuPSwqOyv6gajYvfR1q3eA9os9n816jqvU0JB0CwAnCHLh1lrcPUzqKn6Vb5WvurB+/Hf5GrBD89Pf3rz1qt1m60OMvxq5juayQVAMEKcIfyjLIWsV0LxSvq3tXhcHh09LmMUdY0533q53mmCgMgWAG4U9+3azkWDFWFaZ7XqTKabynQW63WyZWN72WrHgAEKwB37NYXX1qtVpWF5Gq1uolrEkXRwanA3w0Gg5sZuTSaD4BgBbhxefdkrUu05D2P5XJZyfl9fX3dxPdgOBymut82juPQ7XZrH4xiFQDBCvCgDu3NWccwOfWz+XxeyblVFcaX6HQ6qSM0hHS/sCgqGIUnAIIV4MGVtfjSte9vPWU2m5V+HlW8xsV/aTcaYTQaZX5Ov98XowAIVgDqqdPphFardbPnv1qtQpIkpR1/s9mUevyijEajXNOq+/1+pdsDAYBgBSCTuiy+lHda8GQyCev1upRzSpKk9gsudbvd3d6qWUVRVMgoa1mfOwAIVoA7knfxpVsOh/V6Hf7+++/Cj7tYLMJkMqn1e4/j+OJfOPR6vYOjrGm+D0U9RsgCIFgBOBo91x5luzRgFotF+PnzZ2GvtVqtfjveZrOpZUDlnQq879DiW6feaxRFodvtpto+R5QCUJamSwDwOIbDYW3u1dxsNrkiLEmSsF6vw3g8vijitvFb1jTjovT7/cLuP+71ervpz4ciMoqi3SrE7XZ7d32TJLmJFZQBEKwA1MTHx0d4f3/PHCxxHB+NtLwRmSdWL4nZ2WwWVqtVeHp6yhxz2wWW6j4NOIQQms1m4VsSDYfD8M8//5yN1H3dbjd3sBpdBUCwApA5WK4dppe+/nK5DH/99VfodrthMBicDdf1eh3m83mqxZu25x1F0W//XrUipuN+t10xOoqi0Ov1jkbq9+f8+vWr8CAVswAIVoA7lmeU9fsI27WcG0VNO9o7n8/DfD4PcRyHVqsV4jgOcRzvjvH19RVWq1WuEcJrBtVwONy9j6L9+PEj2/8sNJshjuPMKykLUgAEKwCZ46PT6YTFYnFX72u1Wp0MqmuMkObVarVCr9er1Tl1Op1C738WswCkYZVggAd0aouUOoVEkdupXLoC8Pb5ZV+fKIpKmQp8qW63KzoBEKwAZHPJnqxVReexsEkTgEXvAVpEZJUZasPh8OB+qdfWbrd/O69LPjehC4BgBeCoQ3ty3npQZB39vPQ97r9eUSOv29V666rdbgtOAAQrANnkGWU9NS24rKCsU9wWGa7fI/bc6OKhfxqNRhiNRrX+nhUR02IXAMEKwFmdTic0m81ahEUR04LrFk/HwvSY0WhU+4WhOp1OqnM8NQUcAAQrAKkMh8PaRERR0Zpnem4Viymdst0Pte6iKDq7322Ze+8CIFgBuFF1X3ypiqit+/EPieO48unZl8g7LbioBbYAEKwAPIg4jkO/368sIKoMlrzHqjqanp6ebmrksdPplHLtxCoAghWAf6nb4ktpfl723qtVxdNgMDg7xbZu4jg+OH1ZrAIgWAE4Kc+04F6vV/m+n1VPDc0brWkWS8qr2WyeHN2us++jrGlWRQYAwQpALtdYfOnWXq/I842i6OamAu/bv4+1TtcVAMEKQM3dwp6sRQTLNVYDLmrEdTAYnNxSqO6azWaI49h/bAAIVgCqCZBTi+mUFaNFTCW91j2qWfdZ3Wq32zc7FXhft9st5H5kABCsAJy1nRZch/tHsz4/72hrGY6F7GazCVEUhdFodBffl3Pb24hVAAQrAAfl3ZP1WvdUFhU3WcN1Pybb7XbpK/aORqO7mUrbbrePLtYlVgEQrAAUKoqiMBgMrhKkVR3jmFarFZ6fn8PLy0sYjUalhHu32z07KnlrDk0jtwgTAIIVgLPqtvhSEfurZhlpTavZbIaXl5ddpPb7/fD6+lroaGuj0bibqcDfIzzrdT933zIACFYADup0OqHVapW2d2ZZiyjlPU4cx+HHjx//GlGN4zi8vLwUtvXMeDyufK/bqoI1y/URqwAIVgAusj/Keq1oPff8Iu5pbTQa4eXl5eQ9pb1eL7y9ve2mvuYJ+V6vF9rt9l1+V6Io+u3aXOs7AYBgBeAG5V186dqKnB586LFRFJ2N1f2wfX5+DuPxePf4tK/dbDbvcirwvk6nU+nIOQCCFYAHFsdx6fuEFnUvap7R1iiKwo8fP0Kz2cx0zt1uN7y9vYVer/fb8U7tx1rUlOI6S7OQ1LHPqKyp5wAIVgDuWNnTgrNGa5HhOh6Pc0/RjaIojMfjVKOzg8Gg9G1y6iCO45PX89Tncu8xD4BgBeCMPNOCe71eIfuFngvJomP43PGen58L2Vqm3W6Ht7e3o9OnW61WLaZWV+XQNU3z2RtdBUCwApBLmVvcXMPT09NuOm8RoigKo9EovL6+/ja9eDsK+0ijh1l/CSBUARCsAOxce0/WIkbasj5u//HD4bC0Ec9WqxXe3t7CcDjcRWzW+2NvXavV+m1E/pJRdTELwL6mSwDAwb8gms3Q6XTCarUqNFqPjTxuF0S69Djf9fv9SlbqHQ6HhU2lvkW9Xi/8+vUrd4wKVQAOMcIKwMkIK1pR9zWmeVyv1wvj8biy6/WosRrC+WnBghQAwQrAUXn3ZC3jXsyipoWeelyn0wnPz88++Ip0Op3QaPjfCgAEKwAViaKo9qvdHorWdrsdXl5ebJtSsWOjrFYLBkCwAnDWtRdfyhIqWacHbx/barXE6pXsr8K8/TzctwqAYAWgNJfcl5kmOtP8PG3YNBqN8PLyYmrqlXS73RBFkVgFQLAC8FjOBU6j0Qhvb28PvfDRtUVRFDqdzsWfJQAIVoAHlWdacNmxeWnANBqN8Pr6+nD7n9bRpasFi1kABCsAV4nWNPesZn1MFEXh5eUltNttF7kG9u9jFasACFYA7jJu0z7m5eUl1TRUqhHH8cHPQ4wCIFgBSOUa04Kzhkuaxz0/P5+dgkr19j+TtItmCVoABCsAtVBExIzH49rvEfuottOCi/zlBACCFYAHUsUoaxH3LB66b3U0GoXRaORDrKlWq5VqteYsWxYBIFgB4CrRmiVaBoNBGI/HLmzN9fv9i74XACBYAahFtKZ9TLfbDT9+/HBBb8Cx1YKNqgIgWAFIpcrFl7JM/z0Wq6+vrz60G9HpdEKj0cj0HRCyAAhWAK4m7yI87XY7vL6+hiiKXMQbcmpPVgAQrACcVfUWN1midbPZhGazGf74449/jdZRf9v7WE+NnB9aVAsAtpouAQBV28ZJmhHTZrMZ/v7779SPL9ItjOhuNpvdeVYVfVl/6XDpcQAQrABQedikCdfpdHpxRBYVnnUJ2KJCL8txsr6m+1UBKIL5VQCUOi24qBWCLwmdIgOv6umr+69XxGvneQ9Fv1+xCkBaRlgBqCS6Qjg9Qrk/tTVL8GR9TlGjpFVH1yWvl/e5RY+qpnmMmAVAsAJwtXA9F615QzTtc44F0T2tQLwf52WPSOdd+VmsApCGKcEAhBCqWy047XTUqqf+3sNqtd/PP2t4XvP9i1UADjHCCsDVAuXcqGaWacLfw+eSEdM8r3vN63it5xf1iwexCsAxRlgB2Cl6lDXN/YpFPObU84p6/jUXXCrjXPI8P8trlzmSDsDjMMIKQC2cGxm9dOQ0z/2xl0TW/mscu6e0yv1Tq1q0qch7WgFAsAJw1RD9Hi9ZFmbKG59FrxicNsi+/1mZ0XaNIDSiCkDRTAkG4DdlLb5UxwWN7mGhpTKiMOu+r/d4DQGoByOsAFQeU2kWW9oq8rF5Iq/uiy8VGYp5VhguelRV+AIgWAE46ePjI7y/v198nPf397MBck/7n3J5fDYaJn8BIFgBqEC73XYRAIDc/BoTAAAAwQrA7Shr8SUAAMEKAACAYAUAAADBCkBlTAsGAAQrAAAACFYAsjDKCgAIVgAAABCsAAAACFYAbp5pwQCAYAUAAID/03QJAEjDKCsAUDUjrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAACFYAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAAAQrAAAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAACBYAQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAIBgBQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAMEKAAAAghUAAAAEKwAAAIIVAAAABCsAAACCFQAAAAQrAAAAghUAAAAEKwAAAAhWAAAABCsAAAAIVgAAAAQrAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAACFYAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAAAQrAAAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAIBgBQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAMEKAAAAghUAAAAEKwAAAIIVAAAABCsAAACCFQAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAAAQrAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAACFYAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAAAQrAAAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAIBgBQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAACCFQAAAAQrAAAAghUAAAAEKwAAAIIVAAAABCsAAACCFQAAAAQrAAAACFYAAAAEKwAAAAhWAAAABCsAAAAIVgAAAAQrAAAACFYAAAAQrAAAAAhWAAAAEKwAAAAIVgAAABCsAAAACFYAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAIBgdQkAAAAQrAAAACBYAQAAEKwAAAAgWAEAABCsAAAAIFgBAABAsAIAACBYAQAAQLACAAAgWAEAAECwAgAAIFgBAABAsAIAAIBgBQAAQLACAACAYAUAAECwAgAAgGAFAABAsAIAAIBgBQAAAMEKAACAYAUAAADBCgAAgGAFAAAAwQoAAACCFQAAAMEKAAAAghUAAADBCgAAAIIVAAAAwQoAAABX9L8BAKQ7EyoSS1uLAAAAAElFTkSuQmCC",svgPlaceholder:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaGVpZ2h0PSI1OHB4IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1OCA1OCIgd2lkdGg9IjU4cHgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjx0aXRsZS8+PGRlc2MvPjxkZWZzLz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIj48ZyBpZD0iMDE5LS0tU3RhciIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEuMDAwMDAwLCAwLjAwMDAwMCkiPjxwYXRoIGQ9Ik0zMS43NTY5LDEuMTQ0MzUgTDM5LjIwMDYsMTYuOTQ4MDkgQzM5LjQ3NDIwNDcsMTcuNTQ1MDYwNSA0MC4wMjc0OTY2LDE3Ljk2NjI2NjkgNDAuNjc1NzYsMTguMDcxMDkgTDU3LjMyMDM3LDIwLjYwNTM0IEM1OC4wNzI4MzM4LDIwLjc1MTI0OTcgNTguNjg0MDc2OSwyMS4yOTkxNjU2IDU4LjkxMTA5MDksMjIuMDMxMjU1OCBDNTkuMTM4MTA0OCwyMi43NjMzNDYxIDU4Ljk0NDA5NzcsMjMuNTYwOTYyIDU4LjQwNjIsMjQuMTA3IEw0Ni4zNjIwNSwzNi40MDg0NSBDNDUuODk2OTg2MSwzNi44OTA2ODUxIDQ1LjY4Nzk1MzIsMzcuNTY0Nzc1MiA0NS43OTg1OCwzOC4yMjU1MyBMNDguNjQxODIsNTUuNTk1NTMgQzQ4Ljc5NjkzMTMsNTYuMzQyMjMwMyA0OC41MDkzODYzLDU3LjExMTY0MDcgNDcuOTAyNTc1NCw1Ny41NzM1OTQ1IEM0Ny4yOTU3NjQ2LDU4LjAzNTU0ODQgNDYuNDc3NTcyOSw1OC4xMDc5MTQ4IDQ1Ljc5OTEsNTcuNzU5NjQgTDMwLjkxMTcsNDkuNTU4NjQgQzMwLjM0NDU2MDUsNDkuMjQ0MjI5NyAyOS42NTU0Mzk1LDQ5LjI0NDIyOTcgMjkuMDg4Myw0OS41NTg2NCBMMTQuMjAwOSw1Ny43NTk2NCBDMTMuNTIyNDI3MSw1OC4xMDc5MTQ4IDEyLjcwNDIzNTQsNTguMDM1NTQ4NCAxMi4wOTc0MjQ2LDU3LjU3MzU5NDUgQzExLjQ5MDYxMzcsNTcuMTExNjQwNyAxMS4yMDMwNjg3LDU2LjM0MjIzMDMgMTEuMzU4MTgsNTUuNTk1NTMgTDE0LjIwMTQyLDM4LjIyNTUzIEMxNC4zMTIwNDY4LDM3LjU2NDc3NTIgMTQuMTAzMDEzOSwzNi44OTA2ODUxIDEzLjYzNzk1LDM2LjQwODQ1IEwxLjU5MzgsMjQuMTA3IEMxLjA1NTkzMDQ2LDIzLjU2MDk1OTcgMC44NjE5NDE0NzgsMjIuNzYzMzYxOCAxLjA4ODk1Mjk5LDIyLjAzMTI4OTggQzEuMzE1OTY0NDksMjEuMjk5MjE3NyAxLjkyNzE4NjkyLDIwLjc1MTMxMTUgMi42Nzk2MywyMC42MDUzOSBMMTkuMzI0MjQsMTguMDcxMSBDMTkuOTcyNTAzNCwxNy45NjYyNzY5IDIwLjUyNTc5NTMsMTcuNTQ1MDcwNSAyMC43OTk0LDE2Ljk0ODEgTDI4LjI0MzEsMS4xNDQzNSBDMjguNTUwNTQyMSwwLjQ0ODcyMTQyMiAyOS4yMzk0NjA5LC01LjE2NzE3OTY4ZS0wNiAzMCwtNS4xNjcxNzk2OGUtMDYgQzMwLjc2MDUzOTEsLTUuMTY3MTc5NjhlLTA2IDMxLjQ0OTQ1NzksMC40NDg3MjE0MjIgMzEuNzU2OSwxLjE0NDM1IFoiIGZpbGw9IiNGNkFCMjciIGlkPSJTaGFwZSIvPjxwYXRoIGQ9Ik0zNy4zOSwxMy4xMSBDMzIuNTg5MDc0NywxNS42NzcwNDE0IDI4LjE1NTg3LDE4Ljg3OTE3NDEgMjQuMjEsMjIuNjMgQzIwLjAwNDQ4MTIsMjYuNjU2MDUxNyAxNi40MzY4ODMsMzEuMjk5MzI0NyAxMy42MywzNi40IEwxLjU5MDA5LDI0LjExIEMxLjA1MjI0NDY3LDIzLjU2MzYzNTEgMC44NTg3Nzc4MjgsMjIuNzY1NTg3NyAxLjA4NjcxMywyMi4wMzM1NzgzIEMxLjMxNDY0ODE3LDIxLjMwMTU2ODkgMS45MjY5ODE3OSwyMC43NTQ0MzM5IDIuNjc5OTMsMjAuNjEgTDE5LjMyMDA3LDE4LjA3IEMxOS45Njc0NDQsMTcuOTYyNDc5MyAyMC41MjA2OTQsMTcuNTQzODAzNiAyMC44MDAwNywxNi45NSBMMjguMjQsMS4xNCBDMjguNTUwNzg5NSwwLjQ0NjQwNDk1MSAyOS4yMzk5NTc4LDEuOTUyNzc4ODZlLTA1IDMwLDEuOTUyNzc4ODZlLTA1IEMzMC43NjAwNDIyLDEuOTUyNzc4ODZlLTA1IDMxLjQ0OTIxMDUsMC40NDY0MDQ5NTEgMzEuNzYsMS4xNCBMMzcuMzksMTMuMTEgWiIgZmlsbD0iI0Y0Q0QxRSIgaWQ9IlNoYXBlIi8+PC9nPjwvZz48L3N2Zz4="};function Text(i){var t=new Konva$1.Text(i);return t}function Rect(i){var t=new Konva$1.Rect(i);return t}function Circle(i){var t=new Konva$1.Circle(i);return t}const{jsPDF}=window.jspdf;var z,K;class Print{constructor(t){W(this,z);this.doc=new jsPDF(t.docSize),this.config=t,this.pageWidth=t.pageWidth,this.pageHeight=t.pageHeight,this.pageMargin=t.pageMargin,this.pageWidth-=this.pageMargin*2,this.pageHeight-=this.pageMargin*2,this.pageMarginLeft=t.pageMarginLeft,this.pageMarginTop=t.pageMarginTop,this.cellPaddingLeft=t.cellPaddingLeft,this.cellPaddingTop=t.cellPaddingTop,this.cellPadding=t.cellPadding,this.cellWidth=t.cellWidth,this.cellHeight=t.cellHeight,this.startX=this.pageMarginLeft,this.startY=this.pageMarginTop}createLabel(t){var e=this.startX+this.cellWidth+this.cellPadding*2,r=this.startY+this.cellHeight+this.cellPadding*2;e<=this.pageWidth?(V(this,z,K).call(this,t,this.startX+this.cellPadding,this.startY+this.cellPadding),this.startX=e+this.cellPaddingLeft):(r+this.cellHeight>this.pageHeight?(this.doc.addPage(),this.startY=this.pageMargin):this.startY=r+this.cellPaddingTop,this.startX=this.pageMarginLeft,V(this,z,K).call(this,t,this.startX+this.cellPadding,this.startY+this.cellPadding),this.startX=this.startX+this.cellWidth+this.cellPadding*2+this.cellPaddingLeft)}}z=new WeakSet,K=function(t,e,r){this.doc.addImage(t,"JPEG",e,r,this.cellWidth,this.cellHeight)};class Sheet{constructor(t){var e=document.getElementById(t);e.addEventListener("change",this.handleFileAsync,!1)}async handleFileAsync(t){const r=await t.target.files[0].arrayBuffer(),n=XLSX.read(r),a=n.Sheets[n.SheetNames[0]];var o=XLSX.utils.sheet_to_json(a,{header:1});localStorage.setItem("sheetData",JSON.stringify(o))}}var browser={},canPromise$1=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$1={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$1.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};utils$1.getSymbolTotalCodewords=function(t){return CODEWORDS_COUNT[t]};utils$1.getBCHDigit=function(i){let t=0;for(;i!==0;)t++,i>>>=1;return t};utils$1.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=t};utils$1.isKanjiModeEnabled=function(){return typeof toSJISFunction<"u"};utils$1.toSJIS=function(t){return toSJISFunction(t)};var errorCorrectionLevel={};(function(i){i.L={bit:1},i.M={bit:0},i.Q={bit:3},i.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return i.L;case"m":case"medium":return i.M;case"q":case"quartile":return i.Q;case"h":case"high":return i.H;default:throw new Error("Unknown EC Level: "+e)}}i.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},i.from=function(r,n){if(i.isValid(r))return r;try{return t(r)}catch{return n}}})(errorCorrectionLevel);function BitBuffer$1(){this.buffer=[],this.length=0}BitBuffer$1.prototype={get:function(i){const t=Math.floor(i/8);return(this.buffer[t]>>>7-i%8&1)===1},put:function(i,t){for(let e=0;e<t;e++)this.putBit((i>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(i){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),i&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(i){if(!i||i<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=i,this.data=new Uint8Array(i*i),this.reservedBit=new Uint8Array(i*i)}BitMatrix$1.prototype.set=function(i,t,e,r){const n=i*this.size+t;this.data[n]=e,r&&(this.reservedBit[n]=!0)};BitMatrix$1.prototype.get=function(i,t){return this.data[i*this.size+t]};BitMatrix$1.prototype.xor=function(i,t,e){this.data[i*this.size+t]^=e};BitMatrix$1.prototype.isReserved=function(i,t){return this.reservedBit[i*this.size+t]};var bitMatrix=BitMatrix$1,alignmentPattern={};(function(i){const t=utils$1.getSymbolSize;i.getRowColCoords=function(r){if(r===1)return[];const n=Math.floor(r/7)+2,a=t(r),o=a===145?26:Math.ceil((a-13)/(2*n-2))*2,h=[a-7];for(let l=1;l<n-1;l++)h[l]=h[l-1]-o;return h.push(6),h.reverse()},i.getPositions=function(r){const n=[],a=i.getRowColCoords(r),o=a.length;for(let h=0;h<o;h++)for(let l=0;l<o;l++)h===0&&l===0||h===0&&l===o-1||h===o-1&&l===0||n.push([a[h],a[l]]);return n}})(alignmentPattern);var finderPattern={};const getSymbolSize=utils$1.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function(t){const e=getSymbolSize(t);return[[0,0],[e-FINDER_PATTERN_SIZE,0],[0,e-FINDER_PATTERN_SIZE]]};var maskPattern={};(function(i){i.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};i.isValid=function(n){return n!=null&&n!==""&&!isNaN(n)&&n>=0&&n<=7},i.from=function(n){return i.isValid(n)?parseInt(n,10):void 0},i.getPenaltyN1=function(n){const a=n.size;let o=0,h=0,l=0,d=null,u=null;for(let c=0;c<a;c++){h=l=0,d=u=null;for(let f=0;f<a;f++){let p=n.get(c,f);p===d?h++:(h>=5&&(o+=t.N1+(h-5)),d=p,h=1),p=n.get(f,c),p===u?l++:(l>=5&&(o+=t.N1+(l-5)),u=p,l=1)}h>=5&&(o+=t.N1+(h-5)),l>=5&&(o+=t.N1+(l-5))}return o},i.getPenaltyN2=function(n){const a=n.size;let o=0;for(let h=0;h<a-1;h++)for(let l=0;l<a-1;l++){const d=n.get(h,l)+n.get(h,l+1)+n.get(h+1,l)+n.get(h+1,l+1);(d===4||d===0)&&o++}return o*t.N2},i.getPenaltyN3=function(n){const a=n.size;let o=0,h=0,l=0;for(let d=0;d<a;d++){h=l=0;for(let u=0;u<a;u++)h=h<<1&2047|n.get(d,u),u>=10&&(h===1488||h===93)&&o++,l=l<<1&2047|n.get(u,d),u>=10&&(l===1488||l===93)&&o++}return o*t.N3},i.getPenaltyN4=function(n){let a=0;const o=n.data.length;for(let l=0;l<o;l++)a+=n.data[l];return Math.abs(Math.ceil(a*100/o/5)-10)*t.N4};function e(r,n,a){switch(r){case i.Patterns.PATTERN000:return(n+a)%2===0;case i.Patterns.PATTERN001:return n%2===0;case i.Patterns.PATTERN010:return a%3===0;case i.Patterns.PATTERN011:return(n+a)%3===0;case i.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(a/3))%2===0;case i.Patterns.PATTERN101:return n*a%2+n*a%3===0;case i.Patterns.PATTERN110:return(n*a%2+n*a%3)%2===0;case i.Patterns.PATTERN111:return(n*a%3+(n+a)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}i.applyMask=function(n,a){const o=a.size;for(let h=0;h<o;h++)for(let l=0;l<o;l++)a.isReserved(l,h)||a.xor(l,h,e(n,l,h))},i.getBestMask=function(n,a){const o=Object.keys(i.Patterns).length;let h=0,l=1/0;for(let d=0;d<o;d++){a(d),i.applyMask(d,n);const u=i.getPenaltyN1(n)+i.getPenaltyN2(n)+i.getPenaltyN3(n)+i.getPenaltyN4(n);i.applyMask(d,n),u<l&&(l=u,h=d)}return h}})(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function(t,e){switch(e){case ECLevel$1.L:return EC_BLOCKS_TABLE[(t-1)*4+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[(t-1)*4+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[(t-1)*4+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[(t-1)*4+3];default:return}};errorCorrectionCode.getTotalCodewordsCount=function(t,e){switch(e){case ECLevel$1.L:return EC_CODEWORDS_TABLE[(t-1)*4+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[(t-1)*4+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[(t-1)*4+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[(t-1)*4+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)EXP_TABLE[e]=t,LOG_TABLE[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)EXP_TABLE[e]=EXP_TABLE[e-255]})();galoisField.log=function(t){if(t<1)throw new Error("log("+t+")");return LOG_TABLE[t]};galoisField.exp=function(t){return EXP_TABLE[t]};galoisField.mul=function(t,e){return t===0||e===0?0:EXP_TABLE[LOG_TABLE[t]+LOG_TABLE[e]]};(function(i){const t=galoisField;i.mul=function(r,n){const a=new Uint8Array(r.length+n.length-1);for(let o=0;o<r.length;o++)for(let h=0;h<n.length;h++)a[o+h]^=t.mul(r[o],n[h]);return a},i.mod=function(r,n){let a=new Uint8Array(r);for(;a.length-n.length>=0;){const o=a[0];for(let l=0;l<n.length;l++)a[l]^=t.mul(n[l],o);let h=0;for(;h<a.length&&a[h]===0;)h++;a=a.slice(h)}return a},i.generateECPolynomial=function(r){let n=new Uint8Array([1]);for(let a=0;a<r;a++)n=i.mul(n,new Uint8Array([1,t.exp(a)]));return n}})(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(i){this.genPoly=void 0,this.degree=i,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function(t){this.degree=t,this.genPoly=Polynomial.generateECPolynomial(this.degree)};ReedSolomonEncoder$1.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const r=Polynomial.mod(e,this.genPoly),n=this.degree-r.length;if(n>0){const a=new Uint8Array(this.degree);return a.set(r,n),a}return r};var reedSolomonEncoder=ReedSolomonEncoder$1,version={},mode={},versionCheck={};versionCheck.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(kanji,"g");regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");regex.BYTE=new RegExp(byte,"g");regex.NUMERIC=new RegExp(numeric,"g");regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function(t){return TEST_KANJI.test(t)};regex.testNumeric=function(t){return TEST_NUMERIC.test(t)};regex.testAlphanumeric=function(t){return TEST_ALPHANUMERIC.test(t)};(function(i){const t=versionCheck,e=regex;i.NUMERIC={id:"Numeric",bit:1<<0,ccBits:[10,12,14]},i.ALPHANUMERIC={id:"Alphanumeric",bit:1<<1,ccBits:[9,11,13]},i.BYTE={id:"Byte",bit:1<<2,ccBits:[8,16,16]},i.KANJI={id:"Kanji",bit:1<<3,ccBits:[8,10,12]},i.MIXED={bit:-1},i.getCharCountIndicator=function(a,o){if(!a.ccBits)throw new Error("Invalid mode: "+a);if(!t.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?a.ccBits[0]:o<27?a.ccBits[1]:a.ccBits[2]},i.getBestModeForData=function(a){return e.testNumeric(a)?i.NUMERIC:e.testAlphanumeric(a)?i.ALPHANUMERIC:e.testKanji(a)?i.KANJI:i.BYTE},i.toString=function(a){if(a&&a.id)return a.id;throw new Error("Invalid mode")},i.isValid=function(a){return a&&a.bit&&a.ccBits};function r(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"numeric":return i.NUMERIC;case"alphanumeric":return i.ALPHANUMERIC;case"kanji":return i.KANJI;case"byte":return i.BYTE;default:throw new Error("Unknown mode: "+n)}}i.from=function(a,o){if(i.isValid(a))return a;try{return r(a)}catch{return o}}})(mode);(function(i){const t=utils$1,e=errorCorrectionCode,r=errorCorrectionLevel,n=mode,a=versionCheck,o=1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,h=t.getBCHDigit(o);function l(f,p,g){for(let _=1;_<=40;_++)if(p<=i.getCapacity(_,g,f))return _}function d(f,p){return n.getCharCountIndicator(f,p)+4}function u(f,p){let g=0;return f.forEach(function(_){const v=d(_.mode,p);g+=v+_.getBitsLength()}),g}function c(f,p){for(let g=1;g<=40;g++)if(u(f,g)<=i.getCapacity(g,p,n.MIXED))return g}i.from=function(p,g){return a.isValid(p)?parseInt(p,10):g},i.getCapacity=function(p,g,_){if(!a.isValid(p))throw new Error("Invalid QR Code version");typeof _>"u"&&(_=n.BYTE);const v=t.getSymbolTotalCodewords(p),E=e.getTotalCodewordsCount(p,g),C=(v-E)*8;if(_===n.MIXED)return C;const m=C-d(_,p);switch(_){case n.NUMERIC:return Math.floor(m/10*3);case n.ALPHANUMERIC:return Math.floor(m/11*2);case n.KANJI:return Math.floor(m/13);case n.BYTE:default:return Math.floor(m/8)}},i.getBestVersionForData=function(p,g){let _;const v=r.from(g,r.M);if(Array.isArray(p)){if(p.length>1)return c(p,v);if(p.length===0)return 1;_=p[0]}else _=p;return l(_.mode,_.getLength(),v)},i.getEncodedBits=function(p){if(!a.isValid(p)||p<7)throw new Error("Invalid QR Code version");let g=p<<12;for(;t.getBCHDigit(g)-h>=0;)g^=o<<t.getBCHDigit(g)-h;return p<<12|g}})(version);var formatInfo={};const Utils$3=utils$1,G15=1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,G15_MASK=1<<14|1<<12|1<<10|1<<4|1<<1,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function(t,e){const r=t.bit<<3|e;let n=r<<10;for(;Utils$3.getBCHDigit(n)-G15_BCH>=0;)n^=G15<<Utils$3.getBCHDigit(n)-G15_BCH;return(r<<10|n)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(i){this.mode=Mode$4.NUMERIC,this.data=i.toString()}NumericData.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};NumericData.prototype.getLength=function(){return this.data.length};NumericData.prototype.getBitsLength=function(){return NumericData.getBitsLength(this.data.length)};NumericData.prototype.write=function(t){let e,r,n;for(e=0;e+3<=this.data.length;e+=3)r=this.data.substr(e,3),n=parseInt(r,10),t.put(n,10);const a=this.data.length-e;a>0&&(r=this.data.substr(e),n=parseInt(r,10),t.put(n,a*3+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(i){this.mode=Mode$3.ALPHANUMERIC,this.data=i}AlphanumericData.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};AlphanumericData.prototype.getLength=function(){return this.data.length};AlphanumericData.prototype.getBitsLength=function(){return AlphanumericData.getBitsLength(this.data.length)};AlphanumericData.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let r=ALPHA_NUM_CHARS.indexOf(this.data[e])*45;r+=ALPHA_NUM_CHARS.indexOf(this.data[e+1]),t.put(r,11)}this.data.length%2&&t.put(ALPHA_NUM_CHARS.indexOf(this.data[e]),6)};var alphanumericData=AlphanumericData,encodeUtf8$1=function(t){for(var e=[],r=t.length,n=0;n<r;n++){var a=t.charCodeAt(n);if(a>=55296&&a<=56319&&r>n+1){var o=t.charCodeAt(n+1);o>=56320&&o<=57343&&(a=(a-55296)*1024+o-56320+65536,n+=1)}if(a<128){e.push(a);continue}if(a<2048){e.push(a>>6|192),e.push(a&63|128);continue}if(a<55296||a>=57344&&a<65536){e.push(a>>12|224),e.push(a>>6&63|128),e.push(a&63|128);continue}if(a>=65536&&a<=1114111){e.push(a>>18|240),e.push(a>>12&63|128),e.push(a>>6&63|128),e.push(a&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer};const encodeUtf8=encodeUtf8$1,Mode$2=mode;function ByteData(i){this.mode=Mode$2.BYTE,typeof i=="string"&&(i=encodeUtf8(i)),this.data=new Uint8Array(i)}ByteData.getBitsLength=function(t){return t*8};ByteData.prototype.getLength=function(){return this.data.length};ByteData.prototype.getBitsLength=function(){return ByteData.getBitsLength(this.data.length)};ByteData.prototype.write=function(i){for(let t=0,e=this.data.length;t<e;t++)i.put(this.data[t],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$1;function KanjiData(i){this.mode=Mode$1.KANJI,this.data=i}KanjiData.getBitsLength=function(t){return t*13};KanjiData.prototype.getLength=function(){return this.data.length};KanjiData.prototype.getBitsLength=function(){return KanjiData.getBitsLength(this.data.length)};KanjiData.prototype.write=function(i){let t;for(t=0;t<this.data.length;t++){let e=Utils$2.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),i.put(e,13)}};var kanjiData=KanjiData,dijkstra={exports:{}};(function(i){var t={single_source_shortest_paths:function(e,r,n){var a={},o={};o[r]=0;var h=t.PriorityQueue.make();h.push(r,0);for(var l,d,u,c,f,p,g,_,v;!h.empty();){l=h.pop(),d=l.value,c=l.cost,f=e[d]||{};for(u in f)f.hasOwnProperty(u)&&(p=f[u],g=c+p,_=o[u],v=typeof o[u]>"u",(v||_>g)&&(o[u]=g,h.push(u,g),a[u]=d))}if(typeof n<"u"&&typeof o[n]>"u"){var E=["Could not find a path from ",r," to ",n,"."].join("");throw new Error(E)}return a},extract_shortest_path_from_predecessor_list:function(e,r){for(var n=[],a=r;a;)n.push(a),e[a],a=e[a];return n.reverse(),n},find_path:function(e,r,n){var a=t.single_source_shortest_paths(e,r,n);return t.extract_shortest_path_from_predecessor_list(a,n)},PriorityQueue:{make:function(e){var r=t.PriorityQueue,n={},a;e=e||{};for(a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);return n.queue=[],n.sorter=e.sorter||r.default_sorter,n},default_sorter:function(e,r){return e.cost-r.cost},push:function(e,r){var n={value:e,cost:r};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};i.exports=t})(dijkstra);(function(i){const t=mode,e=numericData,r=alphanumericData,n=byteData,a=kanjiData,o=regex,h=utils$1,l=dijkstra.exports;function d(E){return unescape(encodeURIComponent(E)).length}function u(E,C,m){const A=[];let S;for(;(S=E.exec(m))!==null;)A.push({data:S[0],index:S.index,mode:C,length:S[0].length});return A}function c(E){const C=u(o.NUMERIC,t.NUMERIC,E),m=u(o.ALPHANUMERIC,t.ALPHANUMERIC,E);let A,S;return h.isKanjiModeEnabled()?(A=u(o.BYTE,t.BYTE,E),S=u(o.KANJI,t.KANJI,E)):(A=u(o.BYTE_KANJI,t.BYTE,E),S=[]),C.concat(m,A,S).sort(function(y,b){return y.index-b.index}).map(function(y){return{data:y.data,mode:y.mode,length:y.length}})}function f(E,C){switch(C){case t.NUMERIC:return e.getBitsLength(E);case t.ALPHANUMERIC:return r.getBitsLength(E);case t.KANJI:return a.getBitsLength(E);case t.BYTE:return n.getBitsLength(E)}}function p(E){return E.reduce(function(C,m){const A=C.length-1>=0?C[C.length-1]:null;return A&&A.mode===m.mode?(C[C.length-1].data+=m.data,C):(C.push(m),C)},[])}function g(E){const C=[];for(let m=0;m<E.length;m++){const A=E[m];switch(A.mode){case t.NUMERIC:C.push([A,{data:A.data,mode:t.ALPHANUMERIC,length:A.length},{data:A.data,mode:t.BYTE,length:A.length}]);break;case t.ALPHANUMERIC:C.push([A,{data:A.data,mode:t.BYTE,length:A.length}]);break;case t.KANJI:C.push([A,{data:A.data,mode:t.BYTE,length:d(A.data)}]);break;case t.BYTE:C.push([{data:A.data,mode:t.BYTE,length:d(A.data)}])}}return C}function _(E,C){const m={},A={start:{}};let S=["start"];for(let w=0;w<E.length;w++){const y=E[w],b=[];for(let O=0;O<y.length;O++){const T=y[O],P=""+w+O;b.push(P),m[P]={node:T,lastCount:0},A[P]={};for(let R=0;R<S.length;R++){const x=S[R];m[x]&&m[x].node.mode===T.mode?(A[x][P]=f(m[x].lastCount+T.length,T.mode)-f(m[x].lastCount,T.mode),m[x].lastCount+=T.length):(m[x]&&(m[x].lastCount=T.length),A[x][P]=f(T.length,T.mode)+4+t.getCharCountIndicator(T.mode,C))}}S=b}for(let w=0;w<S.length;w++)A[S[w]].end=0;return{map:A,table:m}}function v(E,C){let m;const A=t.getBestModeForData(E);if(m=t.from(C,A),m!==t.BYTE&&m.bit<A.bit)throw new Error('"'+E+'" cannot be encoded with mode '+t.toString(m)+`.
 Suggested mode is: `+t.toString(A));switch(m===t.KANJI&&!h.isKanjiModeEnabled()&&(m=t.BYTE),m){case t.NUMERIC:return new e(E);case t.ALPHANUMERIC:return new r(E);case t.KANJI:return new a(E);case t.BYTE:return new n(E)}}i.fromArray=function(C){return C.reduce(function(m,A){return typeof A=="string"?m.push(v(A,null)):A.data&&m.push(v(A.data,A.mode)),m},[])},i.fromString=function(C,m){const A=c(C,h.isKanjiModeEnabled()),S=g(A),w=_(S,m),y=l.find_path(w.map,"start","end"),b=[];for(let O=1;O<y.length-1;O++)b.push(w.table[y[O]].node);return i.fromArray(p(b))},i.rawSplit=function(C){return i.fromArray(c(C,h.isKanjiModeEnabled()))}})(segments);const Utils$1=utils$1,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(i,t){const e=i.size,r=FinderPattern.getPositions(t);for(let n=0;n<r.length;n++){const a=r[n][0],o=r[n][1];for(let h=-1;h<=7;h++)if(!(a+h<=-1||e<=a+h))for(let l=-1;l<=7;l++)o+l<=-1||e<=o+l||(h>=0&&h<=6&&(l===0||l===6)||l>=0&&l<=6&&(h===0||h===6)||h>=2&&h<=4&&l>=2&&l<=4?i.set(a+h,o+l,!0,!0):i.set(a+h,o+l,!1,!0))}}function setupTimingPattern(i){const t=i.size;for(let e=8;e<t-8;e++){const r=e%2===0;i.set(e,6,r,!0),i.set(6,e,r,!0)}}function setupAlignmentPattern(i,t){const e=AlignmentPattern.getPositions(t);for(let r=0;r<e.length;r++){const n=e[r][0],a=e[r][1];for(let o=-2;o<=2;o++)for(let h=-2;h<=2;h++)o===-2||o===2||h===-2||h===2||o===0&&h===0?i.set(n+o,a+h,!0,!0):i.set(n+o,a+h,!1,!0)}}function setupVersionInfo(i,t){const e=i.size,r=Version.getEncodedBits(t);let n,a,o;for(let h=0;h<18;h++)n=Math.floor(h/3),a=h%3+e-8-3,o=(r>>h&1)===1,i.set(n,a,o,!0),i.set(a,n,o,!0)}function setupFormatInfo(i,t,e){const r=i.size,n=FormatInfo.getEncodedBits(t,e);let a,o;for(a=0;a<15;a++)o=(n>>a&1)===1,a<6?i.set(a,8,o,!0):a<8?i.set(a+1,8,o,!0):i.set(r-15+a,8,o,!0),a<8?i.set(8,r-a-1,o,!0):a<9?i.set(8,15-a-1+1,o,!0):i.set(8,15-a-1,o,!0);i.set(r-8,8,1,!0)}function setupData(i,t){const e=i.size;let r=-1,n=e-1,a=7,o=0;for(let h=e-1;h>0;h-=2)for(h===6&&h--;;){for(let l=0;l<2;l++)if(!i.isReserved(n,h-l)){let d=!1;o<t.length&&(d=(t[o]>>>a&1)===1),i.set(n,h-l,d),a--,a===-1&&(o++,a=7)}if(n+=r,n<0||e<=n){n-=r,r=-r;break}}}function createData(i,t,e){const r=new BitBuffer;e.forEach(function(l){r.put(l.mode.bit,4),r.put(l.getLength(),Mode.getCharCountIndicator(l.mode,i)),l.write(r)});const n=Utils$1.getSymbolTotalCodewords(i),a=ECCode.getTotalCodewordsCount(i,t),o=(n-a)*8;for(r.getLengthInBits()+4<=o&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const h=(o-r.getLengthInBits())/8;for(let l=0;l<h;l++)r.put(l%2?17:236,8);return createCodewords(r,i,t)}function createCodewords(i,t,e){const r=Utils$1.getSymbolTotalCodewords(t),n=ECCode.getTotalCodewordsCount(t,e),a=r-n,o=ECCode.getBlocksCount(t,e),h=r%o,l=o-h,d=Math.floor(r/o),u=Math.floor(a/o),c=u+1,f=d-u,p=new ReedSolomonEncoder(f);let g=0;const _=new Array(o),v=new Array(o);let E=0;const C=new Uint8Array(i.buffer);for(let y=0;y<o;y++){const b=y<l?u:c;_[y]=C.slice(g,g+b),v[y]=p.encode(_[y]),g+=b,E=Math.max(E,b)}const m=new Uint8Array(r);let A=0,S,w;for(S=0;S<E;S++)for(w=0;w<o;w++)S<_[w].length&&(m[A++]=_[w][S]);for(S=0;S<f;S++)for(w=0;w<o;w++)m[A++]=v[w][S];return m}function createSymbol(i,t,e,r){let n;if(Array.isArray(i))n=Segments.fromArray(i);else if(typeof i=="string"){let d=t;if(!d){const u=Segments.rawSplit(i);d=Version.getBestVersionForData(u,e)}n=Segments.fromString(i,d||40)}else throw new Error("Invalid data");const a=Version.getBestVersionForData(n,e);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=a;else if(t<a)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+a+`.
`);const o=createData(t,e,n),h=Utils$1.getSymbolSize(t),l=new BitMatrix(h);return setupFinderPattern(l,t),setupTimingPattern(l),setupAlignmentPattern(l,t),setupFormatInfo(l,e,0),t>=7&&setupVersionInfo(l,t),setupData(l,o),isNaN(r)&&(r=MaskPattern.getBestMask(l,setupFormatInfo.bind(null,l,e))),MaskPattern.applyMask(r,l),setupFormatInfo(l,e,r),{modules:l,version:t,errorCorrectionLevel:e,maskPattern:r,segments:n}}qrcode.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let r=ECLevel.M,n,a;return typeof e<"u"&&(r=ECLevel.from(e.errorCorrectionLevel,ECLevel.M),n=Version.from(e.version),a=MaskPattern.from(e.maskPattern),e.toSJISFunc&&Utils$1.setToSJISFunction(e.toSJISFunc)),createSymbol(t,n,r,a)};var canvas$1={},utils={};(function(i){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let r=e.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+e);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(a){return[a,a]}))),r.length===6&&r.push("F","F");const n=parseInt(r.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+r.slice(0,6).join("")}}i.getOptions=function(r){r||(r={}),r.color||(r.color={});const n=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,a=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:a,scale:a?4:o,margin:n,color:{dark:t(r.color.dark||"#000000ff"),light:t(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},i.getScale=function(r,n){return n.width&&n.width>=r+n.margin*2?n.width/(r+n.margin*2):n.scale},i.getImageWidth=function(r,n){const a=i.getScale(r,n);return Math.floor((r+n.margin*2)*a)},i.qrToImageData=function(r,n,a){const o=n.modules.size,h=n.modules.data,l=i.getScale(o,a),d=Math.floor((o+a.margin*2)*l),u=a.margin*l,c=[a.color.light,a.color.dark];for(let f=0;f<d;f++)for(let p=0;p<d;p++){let g=(f*d+p)*4,_=a.color.light;if(f>=u&&p>=u&&f<d-u&&p<d-u){const v=Math.floor((f-u)/l),E=Math.floor((p-u)/l);_=c[h[v*o+E]?1:0]}r[g++]=_.r,r[g++]=_.g,r[g++]=_.b,r[g]=_.a}}})(utils);(function(i){const t=utils;function e(n,a,o){n.clearRect(0,0,a.width,a.height),a.style||(a.style={}),a.height=o,a.width=o,a.style.height=o+"px",a.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}i.render=function(a,o,h){let l=h,d=o;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),o||(d=r()),l=t.getOptions(l);const u=t.getImageWidth(a.modules.size,l),c=d.getContext("2d"),f=c.createImageData(u,u);return t.qrToImageData(f.data,a,l),e(c,d,u),c.putImageData(f,0,0),d},i.renderToDataURL=function(a,o,h){let l=h;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),l||(l={});const d=i.render(a,o,l),u=l.type||"image/png",c=l.rendererOpts||{};return d.toDataURL(u,c.quality)}})(canvas$1);var svgTag={};const Utils=utils;function getColorAttrib(i,t){const e=i.a/255,r=t+'="'+i.hex+'"';return e<1?r+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':r}function svgCmd(i,t,e){let r=i+t;return typeof e<"u"&&(r+=" "+e),r}function qrToPath(i,t,e){let r="",n=0,a=!1,o=0;for(let h=0;h<i.length;h++){const l=Math.floor(h%t),d=Math.floor(h/t);!l&&!a&&(a=!0),i[h]?(o++,h>0&&l>0&&i[h-1]||(r+=a?svgCmd("M",l+e,.5+d+e):svgCmd("m",n,0),n=0,a=!1),l+1<t&&i[h+1]||(r+=svgCmd("h",o),o=0)):n++}return r}svgTag.render=function(t,e,r){const n=Utils.getOptions(e),a=t.modules.size,o=t.modules.data,h=a+n.margin*2,l=n.color.light.a?"<path "+getColorAttrib(n.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",d="<path "+getColorAttrib(n.color.dark,"stroke")+' d="'+qrToPath(o,a,n.margin)+'"/>',u='viewBox="0 0 '+h+" "+h+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(n.width?'width="'+n.width+'" height="'+n.width+'" ':"")+u+' shape-rendering="crispEdges">'+l+d+`</svg>
`;return typeof r=="function"&&r(null,f),f};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer$1=canvas$1,SvgRenderer=svgTag;function renderCanvas(i,t,e,r,n){const a=[].slice.call(arguments,1),o=a.length,h=typeof a[o-1]=="function";if(!h&&!canPromise())throw new Error("Callback required as last argument");if(h){if(o<2)throw new Error("Too few arguments provided");o===2?(n=e,e=t,t=r=void 0):o===3&&(t.getContext&&typeof n>"u"?(n=r,r=void 0):(n=r,r=e,e=t,t=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(e=t,t=r=void 0):o===2&&!t.getContext&&(r=e,e=t,t=void 0),new Promise(function(l,d){try{const u=QRCode.create(e,r);l(i(u,t,r))}catch(u){d(u)}})}try{const l=QRCode.create(e,r);n(null,i(l,t,r))}catch(l){n(l)}}browser.create=QRCode.create;browser.toCanvas=renderCanvas.bind(null,CanvasRenderer$1.render);browser.toDataURL=renderCanvas.bind(null,CanvasRenderer$1.renderToDataURL);browser.toString=renderCanvas.bind(null,function(i,t,e){return SvgRenderer.render(i,e)});var barcodes={},CODE39$1={},Barcode$1={};Object.defineProperty(Barcode$1,"__esModule",{value:!0});function _classCallCheck$s(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var Barcode=function i(t,e){_classCallCheck$s(this,i),this.data=t,this.text=e.text||t,this.options=e};Barcode$1.default=Barcode;Object.defineProperty(CODE39$1,"__esModule",{value:!0});CODE39$1.CODE39=void 0;var _createClass$l=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2$b=Barcode$1,_Barcode3$b=_interopRequireDefault$x(_Barcode2$b);function _interopRequireDefault$x(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$r(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$n(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$n(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE39=function(i){_inherits$n(t,i);function t(e,r){return _classCallCheck$r(this,t),e=e.toUpperCase(),r.mod43&&(e+=getCharacter(mod43checksum(e))),_possibleConstructorReturn$n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$l(t,[{key:"encode",value:function(){for(var r=getEncoding("*"),n=0;n<this.data.length;n++)r+=getEncoding(this.data[n])+"0";return r+=getEncoding("*"),{data:r,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}]),t}(_Barcode3$b.default),characters=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],encodings=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function getEncoding(i){return getBinary(characterValue(i))}function getBinary(i){return encodings[i].toString(2)}function getCharacter(i){return characters[i]}function characterValue(i){return characters.indexOf(i)}function mod43checksum(i){for(var t=0,e=0;e<i.length;e++)t+=characterValue(i[e]);return t=t%43,t}CODE39$1.CODE39=CODE39;var CODE128$2={},CODE128_AUTO={},CODE128$1={},constants$2={};Object.defineProperty(constants$2,"__esModule",{value:!0});var _SET_BY_CODE;function _defineProperty(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var SET_A=constants$2.SET_A=0,SET_B=constants$2.SET_B=1,SET_C=constants$2.SET_C=2;constants$2.SHIFT=98;var START_A=constants$2.START_A=103,START_B=constants$2.START_B=104,START_C=constants$2.START_C=105;constants$2.MODULO=103;constants$2.STOP=106;constants$2.FNC1=207;constants$2.SET_BY_CODE=(_SET_BY_CODE={},_defineProperty(_SET_BY_CODE,START_A,SET_A),_defineProperty(_SET_BY_CODE,START_B,SET_B),_defineProperty(_SET_BY_CODE,START_C,SET_C),_SET_BY_CODE);constants$2.SWAP={101:SET_A,100:SET_B,99:SET_C};constants$2.A_START_CHAR=String.fromCharCode(208);constants$2.B_START_CHAR=String.fromCharCode(209);constants$2.C_START_CHAR=String.fromCharCode(210);constants$2.A_CHARS="[\0-_\xC8-\xCF]";constants$2.B_CHARS="[ -\x7F\xC8-\xCF]";constants$2.C_CHARS="(\xCF*[0-9]{2}\xCF*)";constants$2.BARS=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011];Object.defineProperty(CODE128$1,"__esModule",{value:!0});var _createClass$k=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2$a=Barcode$1,_Barcode3$a=_interopRequireDefault$w(_Barcode2$a),_constants$a=constants$2;function _interopRequireDefault$w(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$q(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$m(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$m(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE128=function(i){_inherits$m(t,i);function t(e,r){_classCallCheck$q(this,t);var n=_possibleConstructorReturn$m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.substring(1),r));return n.bytes=e.split("").map(function(a){return a.charCodeAt(0)}),n}return _createClass$k(t,[{key:"valid",value:function(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}},{key:"encode",value:function(){var r=this.bytes,n=r.shift()-105,a=_constants$a.SET_BY_CODE[n];if(a===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&r.unshift(_constants$a.FNC1);var o=t.next(r,1,a);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:t.getBar(n)+o.result+t.getBar((o.checksum+n)%_constants$a.MODULO)+t.getBar(_constants$a.STOP)}}},{key:"shouldEncodeAsEan128",value:function(){var r=this.options.ean128||!1;return typeof r=="string"&&(r=r.toLowerCase()==="true"),r}}],[{key:"getBar",value:function(r){return _constants$a.BARS[r]?_constants$a.BARS[r].toString():""}},{key:"correctIndex",value:function(r,n){if(n===_constants$a.SET_A){var a=r.shift();return a<32?a+64:a-32}else return n===_constants$a.SET_B?r.shift()-32:(r.shift()-48)*10+r.shift()-48}},{key:"next",value:function(r,n,a){if(!r.length)return{result:"",checksum:0};var o=void 0,h=void 0;if(r[0]>=200){h=r.shift()-105;var l=_constants$a.SWAP[h];l!==void 0?o=t.next(r,n+1,l):((a===_constants$a.SET_A||a===_constants$a.SET_B)&&h===_constants$a.SHIFT&&(r[0]=a===_constants$a.SET_A?r[0]>95?r[0]-96:r[0]:r[0]<32?r[0]+96:r[0]),o=t.next(r,n+1,a))}else h=t.correctIndex(r,a),o=t.next(r,n+1,a);var d=t.getBar(h),u=h*n;return{result:d+o.result,checksum:u+o.checksum}}}]),t}(_Barcode3$a.default);CODE128$1.default=CODE128;var auto={};Object.defineProperty(auto,"__esModule",{value:!0});var _constants$9=constants$2,matchSetALength=function(t){return t.match(new RegExp("^"+_constants$9.A_CHARS+"*"))[0].length},matchSetBLength=function(t){return t.match(new RegExp("^"+_constants$9.B_CHARS+"*"))[0].length},matchSetC=function(t){return t.match(new RegExp("^"+_constants$9.C_CHARS+"*"))[0]};function autoSelectFromAB(i,t){var e=t?_constants$9.A_CHARS:_constants$9.B_CHARS,r=i.match(new RegExp("^("+e+"+?)(([0-9]{2}){2,})([^0-9]|$)"));if(r)return r[1]+String.fromCharCode(204)+autoSelectFromC(i.substring(r[1].length));var n=i.match(new RegExp("^"+e+"+"))[0];return n.length===i.length?i:n+String.fromCharCode(t?205:206)+autoSelectFromAB(i.substring(n.length),!t)}function autoSelectFromC(i){var t=matchSetC(i),e=t.length;if(e===i.length)return i;i=i.substring(e);var r=matchSetALength(i)>=matchSetBLength(i);return t+String.fromCharCode(r?206:205)+autoSelectFromAB(i,r)}auto.default=function(i){var t=void 0,e=matchSetC(i).length;if(e>=2)t=_constants$9.C_START_CHAR+autoSelectFromC(i);else{var r=matchSetALength(i)>matchSetBLength(i);t=(r?_constants$9.A_START_CHAR:_constants$9.B_START_CHAR)+autoSelectFromAB(i,r)}return t.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(n,a){return String.fromCharCode(203)+a})};Object.defineProperty(CODE128_AUTO,"__esModule",{value:!0});var _CODE2$4=CODE128$1,_CODE3$3=_interopRequireDefault$v(_CODE2$4),_auto=auto,_auto2=_interopRequireDefault$v(_auto);function _interopRequireDefault$v(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$p(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$l(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$l(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE128AUTO=function(i){_inherits$l(t,i);function t(e,r){if(_classCallCheck$p(this,t),/^[\x00-\x7F\xC8-\xD3]+$/.test(e))var n=_possibleConstructorReturn$l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,_auto2.default)(e),r));else var n=_possibleConstructorReturn$l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return _possibleConstructorReturn$l(n)}return t}(_CODE3$3.default);CODE128_AUTO.default=CODE128AUTO;var CODE128A$1={};Object.defineProperty(CODE128A$1,"__esModule",{value:!0});var _createClass$j=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_CODE2$3=CODE128$1,_CODE3$2=_interopRequireDefault$u(_CODE2$3),_constants$8=constants$2;function _interopRequireDefault$u(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$o(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$k(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$k(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE128A=function(i){_inherits$k(t,i);function t(e,r){return _classCallCheck$o(this,t),_possibleConstructorReturn$k(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,_constants$8.A_START_CHAR+e,r))}return _createClass$j(t,[{key:"valid",value:function(){return new RegExp("^"+_constants$8.A_CHARS+"+$").test(this.data)}}]),t}(_CODE3$2.default);CODE128A$1.default=CODE128A;var CODE128B$1={};Object.defineProperty(CODE128B$1,"__esModule",{value:!0});var _createClass$i=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_CODE2$2=CODE128$1,_CODE3$1=_interopRequireDefault$t(_CODE2$2),_constants$7=constants$2;function _interopRequireDefault$t(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$n(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$j(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$j(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE128B=function(i){_inherits$j(t,i);function t(e,r){return _classCallCheck$n(this,t),_possibleConstructorReturn$j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,_constants$7.B_START_CHAR+e,r))}return _createClass$i(t,[{key:"valid",value:function(){return new RegExp("^"+_constants$7.B_CHARS+"+$").test(this.data)}}]),t}(_CODE3$1.default);CODE128B$1.default=CODE128B;var CODE128C$1={};Object.defineProperty(CODE128C$1,"__esModule",{value:!0});var _createClass$h=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_CODE2$1=CODE128$1,_CODE3=_interopRequireDefault$s(_CODE2$1),_constants$6=constants$2;function _interopRequireDefault$s(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$m(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$i(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$i(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var CODE128C=function(i){_inherits$i(t,i);function t(e,r){return _classCallCheck$m(this,t),_possibleConstructorReturn$i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,_constants$6.C_START_CHAR+e,r))}return _createClass$h(t,[{key:"valid",value:function(){return new RegExp("^"+_constants$6.C_CHARS+"+$").test(this.data)}}]),t}(_CODE3.default);CODE128C$1.default=CODE128C;Object.defineProperty(CODE128$2,"__esModule",{value:!0});CODE128$2.CODE128C=CODE128$2.CODE128B=CODE128$2.CODE128A=CODE128$2.CODE128=void 0;var _CODE128_AUTO=CODE128_AUTO,_CODE128_AUTO2=_interopRequireDefault$r(_CODE128_AUTO),_CODE128A=CODE128A$1,_CODE128A2=_interopRequireDefault$r(_CODE128A),_CODE128B=CODE128B$1,_CODE128B2=_interopRequireDefault$r(_CODE128B),_CODE128C=CODE128C$1,_CODE128C2=_interopRequireDefault$r(_CODE128C);function _interopRequireDefault$r(i){return i&&i.__esModule?i:{default:i}}CODE128$2.CODE128=_CODE128_AUTO2.default;CODE128$2.CODE128A=_CODE128A2.default;CODE128$2.CODE128B=_CODE128B2.default;CODE128$2.CODE128C=_CODE128C2.default;var EAN_UPC={},EAN13$1={},constants$1={};Object.defineProperty(constants$1,"__esModule",{value:!0});constants$1.SIDE_BIN="101";constants$1.MIDDLE_BIN="01010";constants$1.BINARIES={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]};constants$1.EAN2_STRUCTURE=["LL","LG","GL","GG"];constants$1.EAN5_STRUCTURE=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"];constants$1.EAN13_STRUCTURE=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"];var EAN$1={},encoder={};Object.defineProperty(encoder,"__esModule",{value:!0});var _constants$5=constants$1,encode$1=function(t,e,r){var n=t.split("").map(function(o,h){return _constants$5.BINARIES[e[h]]}).map(function(o,h){return o?o[t[h]]:""});if(r){var a=t.length-1;n=n.map(function(o,h){return h<a?o+r:o})}return n.join("")};encoder.default=encode$1;Object.defineProperty(EAN$1,"__esModule",{value:!0});var _createClass$g=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_constants$4=constants$1,_encoder$4=encoder,_encoder2$4=_interopRequireDefault$q(_encoder$4),_Barcode2$9=Barcode$1,_Barcode3$9=_interopRequireDefault$q(_Barcode2$9);function _interopRequireDefault$q(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$l(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$h(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$h(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var EAN=function(i){_inherits$h(t,i);function t(e,r){_classCallCheck$l(this,t);var n=_possibleConstructorReturn$h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.fontSize=!r.flat&&r.fontSize>r.width*10?r.width*10:r.fontSize,n.guardHeight=r.height+n.fontSize/2+r.textMargin,n}return _createClass$g(t,[{key:"encode",value:function(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}},{key:"leftText",value:function(r,n){return this.text.substr(r,n)}},{key:"leftEncode",value:function(r,n){return(0,_encoder2$4.default)(r,n)}},{key:"rightText",value:function(r,n){return this.text.substr(r,n)}},{key:"rightEncode",value:function(r,n){return(0,_encoder2$4.default)(r,n)}},{key:"encodeGuarded",value:function(){var r={fontSize:this.fontSize},n={height:this.guardHeight};return[{data:_constants$4.SIDE_BIN,options:n},{data:this.leftEncode(),text:this.leftText(),options:r},{data:_constants$4.MIDDLE_BIN,options:n},{data:this.rightEncode(),text:this.rightText(),options:r},{data:_constants$4.SIDE_BIN,options:n}]}},{key:"encodeFlat",value:function(){var r=[_constants$4.SIDE_BIN,this.leftEncode(),_constants$4.MIDDLE_BIN,this.rightEncode(),_constants$4.SIDE_BIN];return{data:r.join(""),text:this.text}}}]),t}(_Barcode3$9.default);EAN$1.default=EAN;Object.defineProperty(EAN13$1,"__esModule",{value:!0});var _createClass$f=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_get$1=function i(t,e,r){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,r)}else{if("value"in n)return n.value;var o=n.get;return o===void 0?void 0:o.call(r)}},_constants$3=constants$1,_EAN2$2=EAN$1,_EAN3$2=_interopRequireDefault$p(_EAN2$2);function _interopRequireDefault$p(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$k(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$g(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$g(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var checksum$4=function(t){var e=t.substr(0,12).split("").map(function(r){return+r}).reduce(function(r,n,a){return a%2?r+n*3:r+n},0);return(10-e%10)%10},EAN13=function(i){_inherits$g(t,i);function t(e,r){_classCallCheck$k(this,t),e.search(/^[0-9]{12}$/)!==-1&&(e+=checksum$4(e));var n=_possibleConstructorReturn$g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.lastChar=r.lastChar,n}return _createClass$f(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===checksum$4(this.data)}},{key:"leftText",value:function(){return _get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,1,6)}},{key:"leftEncode",value:function(){var r=this.data.substr(1,6),n=_constants$3.EAN13_STRUCTURE[this.data[0]];return _get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,r,n)}},{key:"rightText",value:function(){return _get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,7,6)}},{key:"rightEncode",value:function(){var r=this.data.substr(7,6);return _get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,r,"RRRRRR")}},{key:"encodeGuarded",value:function(){var r=_get$1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"encodeGuarded",this).call(this);return this.options.displayValue&&(r.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(r.push({data:"00"}),r.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),r}}]),t}(_EAN3$2.default);EAN13$1.default=EAN13;var EAN8$1={};Object.defineProperty(EAN8$1,"__esModule",{value:!0});var _createClass$e=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_get=function i(t,e,r){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var a=Object.getPrototypeOf(t);return a===null?void 0:i(a,e,r)}else{if("value"in n)return n.value;var o=n.get;return o===void 0?void 0:o.call(r)}},_EAN2$1=EAN$1,_EAN3$1=_interopRequireDefault$o(_EAN2$1);function _interopRequireDefault$o(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$j(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$f(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$f(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var checksum$3=function(t){var e=t.substr(0,7).split("").map(function(r){return+r}).reduce(function(r,n,a){return a%2?r+n:r+n*3},0);return(10-e%10)%10},EAN8=function(i){_inherits$f(t,i);function t(e,r){return _classCallCheck$j(this,t),e.search(/^[0-9]{7}$/)!==-1&&(e+=checksum$3(e)),_possibleConstructorReturn$f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$e(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===checksum$3(this.data)}},{key:"leftText",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftText",this).call(this,0,4)}},{key:"leftEncode",value:function(){var r=this.data.substr(0,4);return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"leftEncode",this).call(this,r,"LLLL")}},{key:"rightText",value:function(){return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightText",this).call(this,4,4)}},{key:"rightEncode",value:function(){var r=this.data.substr(4,4);return _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"rightEncode",this).call(this,r,"RRRR")}}]),t}(_EAN3$1.default);EAN8$1.default=EAN8;var EAN5$1={};Object.defineProperty(EAN5$1,"__esModule",{value:!0});var _createClass$d=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_constants$2=constants$1,_encoder$3=encoder,_encoder2$3=_interopRequireDefault$n(_encoder$3),_Barcode2$8=Barcode$1,_Barcode3$8=_interopRequireDefault$n(_Barcode2$8);function _interopRequireDefault$n(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$i(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$e(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$e(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var checksum$2=function(t){var e=t.split("").map(function(r){return+r}).reduce(function(r,n,a){return a%2?r+n*9:r+n*3},0);return e%10},EAN5=function(i){_inherits$e(t,i);function t(e,r){return _classCallCheck$i(this,t),_possibleConstructorReturn$e(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$d(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{5}$/)!==-1}},{key:"encode",value:function(){var r=_constants$2.EAN5_STRUCTURE[checksum$2(this.data)];return{data:"1011"+(0,_encoder2$3.default)(this.data,r,"01"),text:this.text}}}]),t}(_Barcode3$8.default);EAN5$1.default=EAN5;var EAN2$1={};Object.defineProperty(EAN2$1,"__esModule",{value:!0});var _createClass$c=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_constants$1=constants$1,_encoder$2=encoder,_encoder2$2=_interopRequireDefault$m(_encoder$2),_Barcode2$7=Barcode$1,_Barcode3$7=_interopRequireDefault$m(_Barcode2$7);function _interopRequireDefault$m(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$h(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$d(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$d(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var EAN2=function(i){_inherits$d(t,i);function t(e,r){return _classCallCheck$h(this,t),_possibleConstructorReturn$d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$c(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{2}$/)!==-1}},{key:"encode",value:function(){var r=_constants$1.EAN2_STRUCTURE[parseInt(this.data)%4];return{data:"1011"+(0,_encoder2$2.default)(this.data,r,"01"),text:this.text}}}]),t}(_Barcode3$7.default);EAN2$1.default=EAN2;var UPC$1={};Object.defineProperty(UPC$1,"__esModule",{value:!0});var _createClass$b=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}();UPC$1.checksum=checksum$1;var _encoder$1=encoder,_encoder2$1=_interopRequireDefault$l(_encoder$1),_Barcode2$6=Barcode$1,_Barcode3$6=_interopRequireDefault$l(_Barcode2$6);function _interopRequireDefault$l(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$g(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$c(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$c(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var UPC=function(i){_inherits$c(t,i);function t(e,r){_classCallCheck$g(this,t),e.search(/^[0-9]{11}$/)!==-1&&(e+=checksum$1(e));var n=_possibleConstructorReturn$c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.displayValue=r.displayValue,r.fontSize>r.width*10?n.fontSize=r.width*10:n.fontSize=r.fontSize,n.guardHeight=r.height+n.fontSize/2+r.textMargin,n}return _createClass$b(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==checksum$1(this.data)}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var r="";return r+="101",r+=(0,_encoder2$1.default)(this.data.substr(0,6),"LLLLLL"),r+="01010",r+=(0,_encoder2$1.default)(this.data.substr(6,6),"RRRRRR"),r+="101",{data:r,text:this.text}}},{key:"guardedEncoding",value:function(){var r=[];return this.displayValue&&r.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),r.push({data:"101"+(0,_encoder2$1.default)(this.data[0],"L"),options:{height:this.guardHeight}}),r.push({data:(0,_encoder2$1.default)(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),r.push({data:"01010",options:{height:this.guardHeight}}),r.push({data:(0,_encoder2$1.default)(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),r.push({data:(0,_encoder2$1.default)(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&r.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),r}}]),t}(_Barcode3$6.default);function checksum$1(i){var t=0,e;for(e=1;e<11;e+=2)t+=parseInt(i[e]);for(e=0;e<11;e+=2)t+=parseInt(i[e])*3;return(10-t%10)%10}UPC$1.default=UPC;var UPCE$1={};Object.defineProperty(UPCE$1,"__esModule",{value:!0});var _createClass$a=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_encoder=encoder,_encoder2=_interopRequireDefault$k(_encoder),_Barcode2$5=Barcode$1,_Barcode3$5=_interopRequireDefault$k(_Barcode2$5),_UPC$1=UPC$1;function _interopRequireDefault$k(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$f(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$b(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$b(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var EXPANSIONS=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],PARITIES=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]],UPCE=function(i){_inherits$b(t,i);function t(e,r){_classCallCheck$f(this,t);var n=_possibleConstructorReturn$b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));if(n.isValid=!1,e.search(/^[0-9]{6}$/)!==-1)n.middleDigits=e,n.upcA=expandToUPCA(e,"0"),n.text=r.text||""+n.upcA[0]+e+n.upcA[n.upcA.length-1],n.isValid=!0;else if(e.search(/^[01][0-9]{7}$/)!==-1)if(n.middleDigits=e.substring(1,e.length-1),n.upcA=expandToUPCA(n.middleDigits,e[0]),n.upcA[n.upcA.length-1]===e[e.length-1])n.isValid=!0;else return _possibleConstructorReturn$b(n);else return _possibleConstructorReturn$b(n);return n.displayValue=r.displayValue,r.fontSize>r.width*10?n.fontSize=r.width*10:n.fontSize=r.fontSize,n.guardHeight=r.height+n.fontSize/2+r.textMargin,n}return _createClass$a(t,[{key:"valid",value:function(){return this.isValid}},{key:"encode",value:function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}},{key:"flatEncoding",value:function(){var r="";return r+="101",r+=this.encodeMiddleDigits(),r+="010101",{data:r,text:this.text}}},{key:"guardedEncoding",value:function(){var r=[];return this.displayValue&&r.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),r.push({data:"101",options:{height:this.guardHeight}}),r.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),r.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&r.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),r}},{key:"encodeMiddleDigits",value:function(){var r=this.upcA[0],n=this.upcA[this.upcA.length-1],a=PARITIES[parseInt(n)][parseInt(r)];return(0,_encoder2.default)(this.middleDigits,a)}}]),t}(_Barcode3$5.default);function expandToUPCA(i,t){for(var e=parseInt(i[i.length-1]),r=EXPANSIONS[e],n="",a=0,o=0;o<r.length;o++){var h=r[o];h==="X"?n+=i[a++]:n+=h}return n=""+t+n,""+n+(0,_UPC$1.checksum)(n)}UPCE$1.default=UPCE;Object.defineProperty(EAN_UPC,"__esModule",{value:!0});EAN_UPC.UPCE=EAN_UPC.UPC=EAN_UPC.EAN2=EAN_UPC.EAN5=EAN_UPC.EAN8=EAN_UPC.EAN13=void 0;var _EAN=EAN13$1,_EAN2=_interopRequireDefault$j(_EAN),_EAN3=EAN8$1,_EAN4=_interopRequireDefault$j(_EAN3),_EAN5=EAN5$1,_EAN6=_interopRequireDefault$j(_EAN5),_EAN7=EAN2$1,_EAN8=_interopRequireDefault$j(_EAN7),_UPC=UPC$1,_UPC2=_interopRequireDefault$j(_UPC),_UPCE=UPCE$1,_UPCE2=_interopRequireDefault$j(_UPCE);function _interopRequireDefault$j(i){return i&&i.__esModule?i:{default:i}}EAN_UPC.EAN13=_EAN2.default;EAN_UPC.EAN8=_EAN4.default;EAN_UPC.EAN5=_EAN6.default;EAN_UPC.EAN2=_EAN8.default;EAN_UPC.UPC=_UPC2.default;EAN_UPC.UPCE=_UPCE2.default;var ITF$2={},ITF$1={},constants={};Object.defineProperty(constants,"__esModule",{value:!0});constants.START_BIN="1010";constants.END_BIN="11101";constants.BINARIES=["00110","10001","01001","11000","00101","10100","01100","00011","10010","01010"];Object.defineProperty(ITF$1,"__esModule",{value:!0});var _createClass$9=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_constants=constants,_Barcode2$4=Barcode$1,_Barcode3$4=_interopRequireDefault$i(_Barcode2$4);function _interopRequireDefault$i(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$e(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$a(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$a(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var ITF=function(i){_inherits$a(t,i);function t(){return _classCallCheck$e(this,t),_possibleConstructorReturn$a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _createClass$9(t,[{key:"valid",value:function(){return this.data.search(/^([0-9]{2})+$/)!==-1}},{key:"encode",value:function(){var r=this,n=this.data.match(/.{2}/g).map(function(a){return r.encodePair(a)}).join("");return{data:_constants.START_BIN+n+_constants.END_BIN,text:this.text}}},{key:"encodePair",value:function(r){var n=_constants.BINARIES[r[1]];return _constants.BINARIES[r[0]].split("").map(function(a,o){return(a==="1"?"111":"1")+(n[o]==="1"?"000":"0")}).join("")}}]),t}(_Barcode3$4.default);ITF$1.default=ITF;var ITF14$1={};Object.defineProperty(ITF14$1,"__esModule",{value:!0});var _createClass$8=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_ITF2$1=ITF$1,_ITF3$1=_interopRequireDefault$h(_ITF2$1);function _interopRequireDefault$h(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$d(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$9(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$9(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var checksum=function(t){var e=t.substr(0,13).split("").map(function(r){return parseInt(r,10)}).reduce(function(r,n,a){return r+n*(3-a%2*2)},0);return Math.ceil(e/10)*10-e},ITF14=function(i){_inherits$9(t,i);function t(e,r){return _classCallCheck$d(this,t),e.search(/^[0-9]{13}$/)!==-1&&(e+=checksum(e)),_possibleConstructorReturn$9(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$8(t,[{key:"valid",value:function(){return this.data.search(/^[0-9]{14}$/)!==-1&&+this.data[13]===checksum(this.data)}}]),t}(_ITF3$1.default);ITF14$1.default=ITF14;Object.defineProperty(ITF$2,"__esModule",{value:!0});ITF$2.ITF14=ITF$2.ITF=void 0;var _ITF$1=ITF$1,_ITF2=_interopRequireDefault$g(_ITF$1),_ITF3=ITF14$1,_ITF4=_interopRequireDefault$g(_ITF3);function _interopRequireDefault$g(i){return i&&i.__esModule?i:{default:i}}ITF$2.ITF=_ITF2.default;ITF$2.ITF14=_ITF4.default;var MSI$2={},MSI$1={};Object.defineProperty(MSI$1,"__esModule",{value:!0});var _createClass$7=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2$3=Barcode$1,_Barcode3$3=_interopRequireDefault$f(_Barcode2$3);function _interopRequireDefault$f(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$c(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$8(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$8(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var MSI=function(i){_inherits$8(t,i);function t(e,r){return _classCallCheck$c(this,t),_possibleConstructorReturn$8(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$7(t,[{key:"encode",value:function(){for(var r="110",n=0;n<this.data.length;n++){var a=parseInt(this.data[n]),o=a.toString(2);o=addZeroes(o,4-o.length);for(var h=0;h<o.length;h++)r+=o[h]=="0"?"100":"110"}return r+="1001",{data:r,text:this.text}}},{key:"valid",value:function(){return this.data.search(/^[0-9]+$/)!==-1}}]),t}(_Barcode3$3.default);function addZeroes(i,t){for(var e=0;e<t;e++)i="0"+i;return i}MSI$1.default=MSI;var MSI10$1={},checksums={};Object.defineProperty(checksums,"__esModule",{value:!0});checksums.mod10=mod10;checksums.mod11=mod11;function mod10(i){for(var t=0,e=0;e<i.length;e++){var r=parseInt(i[e]);(e+i.length)%2===0?t+=r:t+=r*2%10+Math.floor(r*2/10)}return(10-t%10)%10}function mod11(i){for(var t=0,e=[2,3,4,5,6,7],r=0;r<i.length;r++){var n=parseInt(i[i.length-1-r]);t+=e[r%e.length]*n}return(11-t%11)%11}Object.defineProperty(MSI10$1,"__esModule",{value:!0});var _MSI2$4=MSI$1,_MSI3$4=_interopRequireDefault$e(_MSI2$4),_checksums$3=checksums;function _interopRequireDefault$e(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$b(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$7(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$7(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var MSI10=function(i){_inherits$7(t,i);function t(e,r){return _classCallCheck$b(this,t),_possibleConstructorReturn$7(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,_checksums$3.mod10)(e),r))}return t}(_MSI3$4.default);MSI10$1.default=MSI10;var MSI11$1={};Object.defineProperty(MSI11$1,"__esModule",{value:!0});var _MSI2$3=MSI$1,_MSI3$3=_interopRequireDefault$d(_MSI2$3),_checksums$2=checksums;function _interopRequireDefault$d(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$a(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$6(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$6(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var MSI11=function(i){_inherits$6(t,i);function t(e,r){return _classCallCheck$a(this,t),_possibleConstructorReturn$6(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e+(0,_checksums$2.mod11)(e),r))}return t}(_MSI3$3.default);MSI11$1.default=MSI11;var MSI1010$1={};Object.defineProperty(MSI1010$1,"__esModule",{value:!0});var _MSI2$2=MSI$1,_MSI3$2=_interopRequireDefault$c(_MSI2$2),_checksums$1=checksums;function _interopRequireDefault$c(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$9(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$5(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$5(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var MSI1010=function(i){_inherits$5(t,i);function t(e,r){return _classCallCheck$9(this,t),e+=(0,_checksums$1.mod10)(e),e+=(0,_checksums$1.mod10)(e),_possibleConstructorReturn$5(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return t}(_MSI3$2.default);MSI1010$1.default=MSI1010;var MSI1110$1={};Object.defineProperty(MSI1110$1,"__esModule",{value:!0});var _MSI2$1=MSI$1,_MSI3$1=_interopRequireDefault$b(_MSI2$1),_checksums=checksums;function _interopRequireDefault$b(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$8(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$4(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$4(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var MSI1110=function(i){_inherits$4(t,i);function t(e,r){return _classCallCheck$8(this,t),e+=(0,_checksums.mod11)(e),e+=(0,_checksums.mod10)(e),_possibleConstructorReturn$4(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return t}(_MSI3$1.default);MSI1110$1.default=MSI1110;Object.defineProperty(MSI$2,"__esModule",{value:!0});MSI$2.MSI1110=MSI$2.MSI1010=MSI$2.MSI11=MSI$2.MSI10=MSI$2.MSI=void 0;var _MSI$1=MSI$1,_MSI2=_interopRequireDefault$a(_MSI$1),_MSI3=MSI10$1,_MSI4=_interopRequireDefault$a(_MSI3),_MSI5=MSI11$1,_MSI6=_interopRequireDefault$a(_MSI5),_MSI7=MSI1010$1,_MSI8=_interopRequireDefault$a(_MSI7),_MSI9=MSI1110$1,_MSI10=_interopRequireDefault$a(_MSI9);function _interopRequireDefault$a(i){return i&&i.__esModule?i:{default:i}}MSI$2.MSI=_MSI2.default;MSI$2.MSI10=_MSI4.default;MSI$2.MSI11=_MSI6.default;MSI$2.MSI1010=_MSI8.default;MSI$2.MSI1110=_MSI10.default;var pharmacode$1={};Object.defineProperty(pharmacode$1,"__esModule",{value:!0});pharmacode$1.pharmacode=void 0;var _createClass$6=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2$2=Barcode$1,_Barcode3$2=_interopRequireDefault$9(_Barcode2$2);function _interopRequireDefault$9(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$7(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$3(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$3(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var pharmacode=function(i){_inherits$3(t,i);function t(e,r){_classCallCheck$7(this,t);var n=_possibleConstructorReturn$3(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.number=parseInt(e,10),n}return _createClass$6(t,[{key:"encode",value:function(){for(var r=this.number,n="";!isNaN(r)&&r!=0;)r%2===0?(n="11100"+n,r=(r-2)/2):(n="100"+n,r=(r-1)/2);return n=n.slice(0,-2),{data:n,text:this.text}}},{key:"valid",value:function(){return this.number>=3&&this.number<=131070}}]),t}(_Barcode3$2.default);pharmacode$1.pharmacode=pharmacode;var codabar$1={};Object.defineProperty(codabar$1,"__esModule",{value:!0});codabar$1.codabar=void 0;var _createClass$5=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2$1=Barcode$1,_Barcode3$1=_interopRequireDefault$8(_Barcode2$1);function _interopRequireDefault$8(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$6(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$2(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$2(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var codabar=function(i){_inherits$2(t,i);function t(e,r){_classCallCheck$6(this,t),e.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(e="A"+e+"A");var n=_possibleConstructorReturn$2(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.toUpperCase(),r));return n.text=n.options.text||n.text.replace(/[A-D]/g,""),n}return _createClass$5(t,[{key:"valid",value:function(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}},{key:"encode",value:function(){for(var r=[],n=this.getEncodings(),a=0;a<this.data.length;a++)r.push(n[this.data.charAt(a)]),a!==this.data.length-1&&r.push("0");return{text:this.text,data:r.join("")}}},{key:"getEncodings",value:function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}]),t}(_Barcode3$1.default);codabar$1.codabar=codabar;var GenericBarcode$1={};Object.defineProperty(GenericBarcode$1,"__esModule",{value:!0});GenericBarcode$1.GenericBarcode=void 0;var _createClass$4=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_Barcode2=Barcode$1,_Barcode3=_interopRequireDefault$7(_Barcode2);function _interopRequireDefault$7(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$5(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn$1(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits$1(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var GenericBarcode=function(i){_inherits$1(t,i);function t(e,r){return _classCallCheck$5(this,t),_possibleConstructorReturn$1(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return _createClass$4(t,[{key:"encode",value:function(){return{data:"10101010101010101010101010101010101010101",text:this.text}}},{key:"valid",value:function(){return!0}}]),t}(_Barcode3.default);GenericBarcode$1.GenericBarcode=GenericBarcode;Object.defineProperty(barcodes,"__esModule",{value:!0});var _CODE=CODE39$1,_CODE2=CODE128$2,_EAN_UPC=EAN_UPC,_ITF=ITF$2,_MSI=MSI$2,_pharmacode=pharmacode$1,_codabar=codabar$1,_GenericBarcode=GenericBarcode$1;barcodes.default={CODE39:_CODE.CODE39,CODE128:_CODE2.CODE128,CODE128A:_CODE2.CODE128A,CODE128B:_CODE2.CODE128B,CODE128C:_CODE2.CODE128C,EAN13:_EAN_UPC.EAN13,EAN8:_EAN_UPC.EAN8,EAN5:_EAN_UPC.EAN5,EAN2:_EAN_UPC.EAN2,UPC:_EAN_UPC.UPC,UPCE:_EAN_UPC.UPCE,ITF14:_ITF.ITF14,ITF:_ITF.ITF,MSI:_MSI.MSI,MSI10:_MSI.MSI10,MSI11:_MSI.MSI11,MSI1010:_MSI.MSI1010,MSI1110:_MSI.MSI1110,pharmacode:_pharmacode.pharmacode,codabar:_codabar.codabar,GenericBarcode:_GenericBarcode.GenericBarcode};var merge={};Object.defineProperty(merge,"__esModule",{value:!0});var _extends=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r])}return i};merge.default=function(i,t){return _extends({},i,t)};var linearizeEncodings$1={};Object.defineProperty(linearizeEncodings$1,"__esModule",{value:!0});linearizeEncodings$1.default=linearizeEncodings;function linearizeEncodings(i){var t=[];function e(r){if(Array.isArray(r))for(var n=0;n<r.length;n++)e(r[n]);else r.text=r.text||"",r.data=r.data||"",t.push(r)}return e(i),t}var fixOptions$1={};Object.defineProperty(fixOptions$1,"__esModule",{value:!0});fixOptions$1.default=fixOptions;function fixOptions(i){return i.marginTop=i.marginTop||i.margin,i.marginBottom=i.marginBottom||i.margin,i.marginRight=i.marginRight||i.margin,i.marginLeft=i.marginLeft||i.margin,i}var getRenderProperties$1={},getOptionsFromElement$1={},optionsFromStrings$1={};Object.defineProperty(optionsFromStrings$1,"__esModule",{value:!0});optionsFromStrings$1.default=optionsFromStrings;function optionsFromStrings(i){var t=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var e in t)t.hasOwnProperty(e)&&(e=t[e],typeof i[e]=="string"&&(i[e]=parseInt(i[e],10)));return typeof i.displayValue=="string"&&(i.displayValue=i.displayValue!="false"),i}var defaults$1={};Object.defineProperty(defaults$1,"__esModule",{value:!0});var defaults={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}};defaults$1.default=defaults;Object.defineProperty(getOptionsFromElement$1,"__esModule",{value:!0});var _optionsFromStrings$1=optionsFromStrings$1,_optionsFromStrings2$1=_interopRequireDefault$6(_optionsFromStrings$1),_defaults$1=defaults$1,_defaults2$1=_interopRequireDefault$6(_defaults$1);function _interopRequireDefault$6(i){return i&&i.__esModule?i:{default:i}}function getOptionsFromElement(i){var t={};for(var e in _defaults2$1.default)_defaults2$1.default.hasOwnProperty(e)&&(i.hasAttribute("jsbarcode-"+e.toLowerCase())&&(t[e]=i.getAttribute("jsbarcode-"+e.toLowerCase())),i.hasAttribute("data-"+e.toLowerCase())&&(t[e]=i.getAttribute("data-"+e.toLowerCase())));return t.value=i.getAttribute("jsbarcode-value")||i.getAttribute("data-value"),t=(0,_optionsFromStrings2$1.default)(t),t}getOptionsFromElement$1.default=getOptionsFromElement;var renderers={},canvas={},shared={};Object.defineProperty(shared,"__esModule",{value:!0});shared.getTotalWidthOfEncodings=shared.calculateEncodingAttributes=shared.getBarcodePadding=shared.getEncodingHeight=shared.getMaximumHeightOfEncodings=void 0;var _merge$3=merge,_merge2$3=_interopRequireDefault$5(_merge$3);function _interopRequireDefault$5(i){return i&&i.__esModule?i:{default:i}}function getEncodingHeight(i,t){return t.height+(t.displayValue&&i.text.length>0?t.fontSize+t.textMargin:0)+t.marginTop+t.marginBottom}function getBarcodePadding(i,t,e){if(e.displayValue&&t<i){if(e.textAlign=="center")return Math.floor((i-t)/2);if(e.textAlign=="left")return 0;if(e.textAlign=="right")return Math.floor(i-t)}return 0}function calculateEncodingAttributes(i,t,e){for(var r=0;r<i.length;r++){var n=i[r],a=(0,_merge2$3.default)(t,n.options),o;a.displayValue?o=messureText(n.text,a,e):o=0;var h=n.data.length*a.width;n.width=Math.ceil(Math.max(o,h)),n.height=getEncodingHeight(n,a),n.barcodePadding=getBarcodePadding(o,h,a)}}function getTotalWidthOfEncodings(i){for(var t=0,e=0;e<i.length;e++)t+=i[e].width;return t}function getMaximumHeightOfEncodings(i){for(var t=0,e=0;e<i.length;e++)i[e].height>t&&(t=i[e].height);return t}function messureText(i,t,e){var r;if(e)r=e;else if(typeof document<"u")r=document.createElement("canvas").getContext("2d");else return 0;r.font=t.fontOptions+" "+t.fontSize+"px "+t.font;var n=r.measureText(i);if(!n)return 0;var a=n.width;return a}shared.getMaximumHeightOfEncodings=getMaximumHeightOfEncodings;shared.getEncodingHeight=getEncodingHeight;shared.getBarcodePadding=getBarcodePadding;shared.calculateEncodingAttributes=calculateEncodingAttributes;shared.getTotalWidthOfEncodings=getTotalWidthOfEncodings;Object.defineProperty(canvas,"__esModule",{value:!0});var _createClass$3=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_merge$2=merge,_merge2$2=_interopRequireDefault$4(_merge$2),_shared$1=shared;function _interopRequireDefault$4(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$4(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var CanvasRenderer=function(){function i(t,e,r){_classCallCheck$4(this,i),this.canvas=t,this.encodings=e,this.options=r}return _createClass$3(i,[{key:"render",value:function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var e=0;e<this.encodings.length;e++){var r=(0,_merge2$2.default)(this.options,this.encodings[e].options);this.drawCanvasBarcode(r,this.encodings[e]),this.drawCanvasText(r,this.encodings[e]),this.moveCanvasDrawing(this.encodings[e])}this.restoreCanvas()}},{key:"prepareCanvas",value:function(){var e=this.canvas.getContext("2d");e.save(),(0,_shared$1.calculateEncodingAttributes)(this.encodings,this.options,e);var r=(0,_shared$1.getTotalWidthOfEncodings)(this.encodings),n=(0,_shared$1.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=r+this.options.marginLeft+this.options.marginRight,this.canvas.height=n,e.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(e.fillStyle=this.options.background,e.fillRect(0,0,this.canvas.width,this.canvas.height)),e.translate(this.options.marginLeft,0)}},{key:"drawCanvasBarcode",value:function(e,r){var n=this.canvas.getContext("2d"),a=r.data,o;e.textPosition=="top"?o=e.marginTop+e.fontSize+e.textMargin:o=e.marginTop,n.fillStyle=e.lineColor;for(var h=0;h<a.length;h++){var l=h*e.width+r.barcodePadding;a[h]==="1"?n.fillRect(l,o,e.width,e.height):a[h]&&n.fillRect(l,o,e.width,e.height*a[h])}}},{key:"drawCanvasText",value:function(e,r){var n=this.canvas.getContext("2d"),a=e.fontOptions+" "+e.fontSize+"px "+e.font;if(e.displayValue){var o,h;e.textPosition=="top"?h=e.marginTop+e.fontSize-e.textMargin:h=e.height+e.textMargin+e.marginTop+e.fontSize,n.font=a,e.textAlign=="left"||r.barcodePadding>0?(o=0,n.textAlign="left"):e.textAlign=="right"?(o=r.width-1,n.textAlign="right"):(o=r.width/2,n.textAlign="center"),n.fillText(r.text,o,h)}}},{key:"moveCanvasDrawing",value:function(e){var r=this.canvas.getContext("2d");r.translate(e.width,0)}},{key:"restoreCanvas",value:function(){var e=this.canvas.getContext("2d");e.restore()}}]),i}();canvas.default=CanvasRenderer;var svg={};Object.defineProperty(svg,"__esModule",{value:!0});var _createClass$2=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}(),_merge$1=merge,_merge2$1=_interopRequireDefault$3(_merge$1),_shared=shared;function _interopRequireDefault$3(i){return i&&i.__esModule?i:{default:i}}function _classCallCheck$3(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var svgns="http://www.w3.org/2000/svg",SVGRenderer=function(){function i(t,e,r){_classCallCheck$3(this,i),this.svg=t,this.encodings=e,this.options=r,this.document=r.xmlDocument||document}return _createClass$2(i,[{key:"render",value:function(){var e=this.options.marginLeft;this.prepareSVG();for(var r=0;r<this.encodings.length;r++){var n=this.encodings[r],a=(0,_merge2$1.default)(this.options,n.options),o=this.createGroup(e,a.marginTop,this.svg);this.setGroupOptions(o,a),this.drawSvgBarcode(o,a,n),this.drawSVGText(o,a,n),e+=n.width}}},{key:"prepareSVG",value:function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,_shared.calculateEncodingAttributes)(this.encodings,this.options);var e=(0,_shared.getTotalWidthOfEncodings)(this.encodings),r=(0,_shared.getMaximumHeightOfEncodings)(this.encodings),n=e+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(n,r),this.options.background&&this.drawRect(0,0,n,r,this.svg).setAttribute("style","fill:"+this.options.background+";")}},{key:"drawSvgBarcode",value:function(e,r,n){var a=n.data,o;r.textPosition=="top"?o=r.fontSize+r.textMargin:o=0;for(var h=0,l=0,d=0;d<a.length;d++)l=d*r.width+n.barcodePadding,a[d]==="1"?h++:h>0&&(this.drawRect(l-r.width*h,o,r.width*h,r.height,e),h=0);h>0&&this.drawRect(l-r.width*(h-1),o,r.width*h,r.height,e)}},{key:"drawSVGText",value:function(e,r,n){var a=this.document.createElementNS(svgns,"text");if(r.displayValue){var o,h;a.setAttribute("style","font:"+r.fontOptions+" "+r.fontSize+"px "+r.font),r.textPosition=="top"?h=r.fontSize-r.textMargin:h=r.height+r.textMargin+r.fontSize,r.textAlign=="left"||n.barcodePadding>0?(o=0,a.setAttribute("text-anchor","start")):r.textAlign=="right"?(o=n.width-1,a.setAttribute("text-anchor","end")):(o=n.width/2,a.setAttribute("text-anchor","middle")),a.setAttribute("x",o),a.setAttribute("y",h),a.appendChild(this.document.createTextNode(n.text)),e.appendChild(a)}}},{key:"setSvgAttributes",value:function(e,r){var n=this.svg;n.setAttribute("width",e+"px"),n.setAttribute("height",r+"px"),n.setAttribute("x","0px"),n.setAttribute("y","0px"),n.setAttribute("viewBox","0 0 "+e+" "+r),n.setAttribute("xmlns",svgns),n.setAttribute("version","1.1"),n.setAttribute("style","transform: translate(0,0)")}},{key:"createGroup",value:function(e,r,n){var a=this.document.createElementNS(svgns,"g");return a.setAttribute("transform","translate("+e+", "+r+")"),n.appendChild(a),a}},{key:"setGroupOptions",value:function(e,r){e.setAttribute("style","fill:"+r.lineColor+";")}},{key:"drawRect",value:function(e,r,n,a,o){var h=this.document.createElementNS(svgns,"rect");return h.setAttribute("x",e),h.setAttribute("y",r),h.setAttribute("width",n),h.setAttribute("height",a),o.appendChild(h),h}}]),i}();svg.default=SVGRenderer;var object={};Object.defineProperty(object,"__esModule",{value:!0});var _createClass$1=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}();function _classCallCheck$2(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var ObjectRenderer=function(){function i(t,e,r){_classCallCheck$2(this,i),this.object=t,this.encodings=e,this.options=r}return _createClass$1(i,[{key:"render",value:function(){this.object.encodings=this.encodings}}]),i}();object.default=ObjectRenderer;Object.defineProperty(renderers,"__esModule",{value:!0});var _canvas=canvas,_canvas2=_interopRequireDefault$2(_canvas),_svg=svg,_svg2=_interopRequireDefault$2(_svg),_object=object,_object2=_interopRequireDefault$2(_object);function _interopRequireDefault$2(i){return i&&i.__esModule?i:{default:i}}renderers.default={CanvasRenderer:_canvas2.default,SVGRenderer:_svg2.default,ObjectRenderer:_object2.default};var exceptions={};Object.defineProperty(exceptions,"__esModule",{value:!0});function _classCallCheck$1(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(i,t){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:i}function _inherits(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(i,t):i.__proto__=t)}var InvalidInputException=function(i){_inherits(t,i);function t(e,r){_classCallCheck$1(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.name="InvalidInputException",n.symbology=e,n.input=r,n.message='"'+n.input+'" is not a valid input for '+n.symbology,n}return t}(Error),InvalidElementException=function(i){_inherits(t,i);function t(){_classCallCheck$1(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="InvalidElementException",e.message="Not supported type to render on",e}return t}(Error),NoElementException=function(i){_inherits(t,i);function t(){_classCallCheck$1(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="NoElementException",e.message="No element to render on.",e}return t}(Error);exceptions.InvalidInputException=InvalidInputException;exceptions.InvalidElementException=InvalidElementException;exceptions.NoElementException=NoElementException;Object.defineProperty(getRenderProperties$1,"__esModule",{value:!0});var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_getOptionsFromElement=getOptionsFromElement$1,_getOptionsFromElement2=_interopRequireDefault$1(_getOptionsFromElement),_renderers=renderers,_renderers2=_interopRequireDefault$1(_renderers),_exceptions$1=exceptions;function _interopRequireDefault$1(i){return i&&i.__esModule?i:{default:i}}function getRenderProperties(i){if(typeof i=="string")return querySelectedRenderProperties(i);if(Array.isArray(i)){for(var t=[],e=0;e<i.length;e++)t.push(getRenderProperties(i[e]));return t}else{if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLImageElement)return newCanvasRenderProperties(i);if(i&&i.nodeName&&i.nodeName.toLowerCase()==="svg"||typeof SVGElement<"u"&&i instanceof SVGElement)return{element:i,options:(0,_getOptionsFromElement2.default)(i),renderer:_renderers2.default.SVGRenderer};if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement)return{element:i,options:(0,_getOptionsFromElement2.default)(i),renderer:_renderers2.default.CanvasRenderer};if(i&&i.getContext)return{element:i,renderer:_renderers2.default.CanvasRenderer};if(i&&(typeof i>"u"?"undefined":_typeof(i))==="object"&&!i.nodeName)return{element:i,renderer:_renderers2.default.ObjectRenderer};throw new _exceptions$1.InvalidElementException}}function querySelectedRenderProperties(i){var t=document.querySelectorAll(i);if(t.length!==0){for(var e=[],r=0;r<t.length;r++)e.push(getRenderProperties(t[r]));return e}}function newCanvasRenderProperties(i){var t=document.createElement("canvas");return{element:t,options:(0,_getOptionsFromElement2.default)(i),renderer:_renderers2.default.CanvasRenderer,afterRender:function(){i.setAttribute("src",t.toDataURL())}}}getRenderProperties$1.default=getRenderProperties;var ErrorHandler$1={};Object.defineProperty(ErrorHandler$1,"__esModule",{value:!0});var _createClass=function(){function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}}();function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var ErrorHandler=function(){function i(t){_classCallCheck(this,i),this.api=t}return _createClass(i,[{key:"handleCatch",value:function(e){if(e.name==="InvalidInputException")if(this.api._options.valid!==this.api._defaults.valid)this.api._options.valid(!1);else throw e.message;else throw e;this.api.render=function(){}}},{key:"wrapBarcodeCall",value:function(e){try{var r=e.apply(void 0,arguments);return this.api._options.valid(!0),r}catch(n){return this.handleCatch(n),this.api}}}]),i}();ErrorHandler$1.default=ErrorHandler;var _barcodes=barcodes,_barcodes2=_interopRequireDefault(_barcodes),_merge=merge,_merge2=_interopRequireDefault(_merge),_linearizeEncodings=linearizeEncodings$1,_linearizeEncodings2=_interopRequireDefault(_linearizeEncodings),_fixOptions=fixOptions$1,_fixOptions2=_interopRequireDefault(_fixOptions),_getRenderProperties=getRenderProperties$1,_getRenderProperties2=_interopRequireDefault(_getRenderProperties),_optionsFromStrings=optionsFromStrings$1,_optionsFromStrings2=_interopRequireDefault(_optionsFromStrings),_ErrorHandler=ErrorHandler$1,_ErrorHandler2=_interopRequireDefault(_ErrorHandler),_exceptions=exceptions,_defaults=defaults$1,_defaults2=_interopRequireDefault(_defaults);function _interopRequireDefault(i){return i&&i.__esModule?i:{default:i}}var API=function(){},JsBarcode=function(t,e,r){var n=new API;if(typeof t>"u")throw Error("No element to render on was provided.");return n._renderProperties=(0,_getRenderProperties2.default)(t),n._encodings=[],n._options=_defaults2.default,n._errorHandler=new _ErrorHandler2.default(n),typeof e<"u"&&(r=r||{},r.format||(r.format=autoSelectBarcode()),n.options(r)[r.format](e,r).render()),n};JsBarcode.getModule=function(i){return _barcodes2.default[i]};for(var name in _barcodes2.default)_barcodes2.default.hasOwnProperty(name)&&registerBarcode(_barcodes2.default,name);function registerBarcode(i,t){API.prototype[t]=API.prototype[t.toUpperCase()]=API.prototype[t.toLowerCase()]=function(e,r){var n=this;return n._errorHandler.wrapBarcodeCall(function(){r.text=typeof r.text>"u"?void 0:""+r.text;var a=(0,_merge2.default)(n._options,r);a=(0,_optionsFromStrings2.default)(a);var o=i[t],h=encode(e,o,a);return n._encodings.push(h),n})}}function encode(i,t,e){i=""+i;var r=new t(i,e);if(!r.valid())throw new _exceptions.InvalidInputException(r.constructor.name,i);var n=r.encode();n=(0,_linearizeEncodings2.default)(n);for(var a=0;a<n.length;a++)n[a].options=(0,_merge2.default)(e,n[a].options);return n}function autoSelectBarcode(){return _barcodes2.default.CODE128?"CODE128":Object.keys(_barcodes2.default)[0]}API.prototype.options=function(i){return this._options=(0,_merge2.default)(this._options,i),this};API.prototype.blank=function(i){var t=new Array(i+1).join("0");return this._encodings.push({data:t}),this};API.prototype.init=function(){if(!!this._renderProperties){Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);var i;for(var t in this._renderProperties){i=this._renderProperties[t];var e=(0,_merge2.default)(this._options,i.options);e.format=="auto"&&(e.format=autoSelectBarcode()),this._errorHandler.wrapBarcodeCall(function(){var r=e.value,n=_barcodes2.default[e.format.toUpperCase()],a=encode(r,n,e);render(i,a,e)})}}};API.prototype.render=function(){if(!this._renderProperties)throw new _exceptions.NoElementException;if(Array.isArray(this._renderProperties))for(var i=0;i<this._renderProperties.length;i++)render(this._renderProperties[i],this._encodings,this._options);else render(this._renderProperties,this._encodings,this._options);return this};API.prototype._defaults=_defaults2.default;function render(i,t,e){t=(0,_linearizeEncodings2.default)(t);for(var r=0;r<t.length;r++)t[r].options=(0,_merge2.default)(e,t[r].options),(0,_fixOptions2.default)(t[r].options);(0,_fixOptions2.default)(e);var n=i.renderer,a=new n(i.element,t,e);a.render(),i.afterRender&&i.afterRender()}typeof window<"u"&&(window.JsBarcode=JsBarcode);typeof jQuery<"u"&&(jQuery.fn.JsBarcode=function(i,t){var e=[];return jQuery(this).each(function(){e.push(this)}),JsBarcode(e,i,t)});var JsBarcode_1=JsBarcode;function snapping(i,t,e){var r=5;function n(l){var d=[0,i.width()/2,i.width()],u=[0,i.height()/2,i.height()];return i.find("Text,Rect,Circle,Image,Polygon,Star,RegularPolygon,Arc,Ellipse,Line").forEach(c=>{if(!(c===l||["selectionRectangle","stageBackground","top-left _anchor","top-center _anchor","top-right _anchor","middle-right _anchor","middle-left _anchor","bottom-left _anchor","bottom-center _anchor","bottom-right _anchor","rotater _anchor","transform"].includes(c.name()))){var p=c.getClientRect();d.push([p.x,p.x+p.width,p.x+p.width/2]),u.push([p.y,p.y+p.height,p.y+p.height/2])}}),{vertical:d.flat(),horizontal:u.flat()}}function a(l){var d=l.getClientRect(),u=l.absolutePosition();return{vertical:[{guide:Math.round(d.x),offset:Math.round(u.x-d.x),snap:"start"},{guide:Math.round(d.x+d.width/2),offset:Math.round(u.x-d.x-d.width/2),snap:"center"},{guide:Math.round(d.x+d.width),offset:Math.round(u.x-d.x-d.width),snap:"end"}],horizontal:[{guide:Math.round(d.y),offset:Math.round(u.y-d.y),snap:"start"},{guide:Math.round(d.y+d.height/2),offset:Math.round(u.y-d.y-d.height/2),snap:"center"},{guide:Math.round(d.y+d.height),offset:Math.round(u.y-d.y-d.height),snap:"end"}]}}function o(l,d){var u=[],c=[];l.vertical.forEach(_=>{d.vertical.forEach(v=>{var E=Math.abs(_-v.guide);E<r&&u.push({lineGuide:_,diff:E,snap:v.snap,offset:v.offset})})}),l.horizontal.forEach(_=>{d.horizontal.forEach(v=>{var E=Math.abs(_-v.guide);E<r&&c.push({lineGuide:_,diff:E,snap:v.snap,offset:v.offset})})});var f=[],p=u.sort((_,v)=>_.diff-v.diff)[0],g=c.sort((_,v)=>_.diff-v.diff)[0];return p&&f.push({lineGuide:p.lineGuide,offset:p.offset,orientation:"V",snap:p.snap}),g&&f.push({lineGuide:g.lineGuide,offset:g.offset,orientation:"H",snap:g.snap}),f}function h(l){l.forEach(d=>{if(d.orientation==="H"){var u=new Konva.Line({points:[-6e3,0,6e3,0],stroke:"rgb(0, 161, 255)",strokeWidth:.5,name:"guid-line",dash:[2,2]});t.add(u),u.absolutePosition({x:0,y:d.lineGuide})}else if(d.orientation==="V"){var u=new Konva.Line({points:[0,-6e3,0,6e3],stroke:"rgb(0, 161, 255)",strokeWidth:.5,name:"guid-line",dash:[2,2]});t.add(u),u.absolutePosition({x:d.lineGuide,y:0})}})}t.on("dragmove",function(l){try{t.find(".guid-line").forEach(p=>p.destroy());var d=n(l.target),u=a(l.target),c=o(d,u);if(!c.length)return;h(c);var f=l.target.absolutePosition();c.forEach(p=>{switch(p.snap){case"start":{switch(p.orientation){case"V":{f.x=p.lineGuide+p.offset;break}case"H":{f.y=p.lineGuide+p.offset;break}}break}case"center":{switch(p.orientation){case"V":{f.x=p.lineGuide+p.offset;break}case"H":{f.y=p.lineGuide+p.offset;break}}break}case"end":{switch(p.orientation){case"V":{f.x=p.lineGuide+p.offset;break}case"H":{f.y=p.lineGuide+p.offset;break}}break}}}),l.target.absolutePosition(f)}catch{}}),t.on("dragend",function(l){try{t.find(".guid-line").forEach(d=>d.destroy())}catch{}})}class Features{constructor(t){this.editor=t,this.counter=0}saveEditor(){let t={type:"editor",data:JSON.parse(this.editor.editor.toJSON())};localStorage.setItem("editorData",JSON.stringify(t)),alert("Saved !")}addFont(t){var e=document.getElementsByTagName("head")[0],r=document.createElement("link"),n=t.replace(" ","+");r.id=n,r.rel="stylesheet",r.type="text/css",r.href="https://fonts.googleapis.com/css?family="+n,r.media="all",e.appendChild(r)}makeFunctionName(t){return"add"+t.attrs.type.charAt(0).toUpperCase()+t.attrs.type.slice(1)}addElement(t,e,r){typeof t[r]=="function"&&t[r](e.attrs)}addLine(t){var e=this.editor.layer,r=this;this.counter++;var n=this.counter;Object.keys(t).length===0&&(t={strokeWidth:1,stroke:"black",type:"line",lineCap:"round",id:"quadLinePath"+n,name:"line",points:[0,0],start1:20,start2:10,end1:this.editor.editorWidth/2,end2:10});var a={start:o(t.start1,t.start2),end:o(t.end1,t.end2)};function o(d,u){var c=new Konva$1.Circle({x:d,y:u,radius:2,stroke:"#666",fill:" rgba(0, 0, 0, 0.5)",strokeWidth:1,draggable:!0,type:"anchor",name:"anchor"});return e.add(c),c.on("mouseover",function(){document.body.style.cursor="pointer",this.strokeWidth(2)}),c.on("mouseout",function(){document.body.style.cursor="default",this.strokeWidth(1)}),c.on("dragmove",function(){h()}),c}function h(){var d=a,u=e.findOne("#quadLinePath"+n);u.points([d.start.x(),d.start.y(),d.end.x(),d.end.y()])}var l=new Konva$1.Line(t);e.add(l),r.editor.selectItem(l),l.on("click",function(){r.editor.editor.find(".anchor").forEach(d=>{d.hide()}),r.editor.selectItem(this),a.start.show(),a.end.show()}),h()}}class History{constructor(t){this.editor=t,this.history=[],this.step=0}addHistory(t){this.history.length>5&&this.delete(0),this.history.push(t)}formatValue(t,e){return typeof e=="object"&&(e.includes("x")||e.includes("scaleX"))?[t[e[0]](),t[e[1]]()]:t[e]()}delHistory(){this.history.pop()}delete(t){this.history.splice(t,1)}undo(){this.history.length===0&&(this.step=0),this.step===0&&(this.step=this.history.length-2),this.step===-1&&(this.step=this.history.length),this.applyChange(this.step),this.step--}redo(){}clearHistory(){this.history.length=0}applyChange(t){if(this.history[t]){let e=JSON.parse(this.history[t]);this.editor.clearAll(),this.editor.ImportData.source(e)}}revert(t){let e=this.history[t];e.item[e.attr](e.previous)}applyChanges(){let t=this.history[this.step];try{typeof t.item[t.attr]=="function"&&(t.item[t.attr](t.value),this.delHistory())}catch(e){console.log(e)}}}class Naming{constructor(t){this.editor=t,this.types={text:0,barcodeBasic:0,image:0,qrcode:0,rect:0,triangle:0,polygon:0,circle:0,line:0,star:0,arc:0,oval:0,path:0,svg:0,shape:0,video:0,audio:0,timer:0}}generateName(t){let e=this.types[t];return e++,this.types[t]=e,this.cleanString(t)+"_"+e}cleanString(t){return t==="barcodeBasic"?"Barcode":t==="qrcode"?"QRcode":t.charAt(0).toUpperCase()+t.slice(1)}}class DataImport{constructor(i){this.editor=i,this.indexs=[]}isEmpty(i){return Object.keys(i).length===0}source(jsonData){let data=jsonData,editor=this.editor;editor.editor.setAttrs(data.attrs);let elements={},background={};for(let i in data.children)data.children[i].attrs.name==="mainLayer"&&(elements=data.children[i].children),data.children[i].attrs.name==="backgroundLayer"&&(background=data.children[i].children);if(this.isEmpty(elements))return;this.isEmpty(background)||editor.background.setAttrs(background[0].attrs);let index=0;return elements.forEach(i=>{if(i.className!=="Transformer"){if(i.className==="Text"){let t=i.attrs.fontFamily;this.addFont(t),new FontFaceObserver(t).load().then(function(){i.fontFamily(t)}).catch(function(){})}this.addElement(editor,i,this.makeFunctionName(i),index),index++}}),Promise.all(this.indexs).then(el=>{el.forEach(i=>{i&&i.zIndex(i.attrs.index)}),editor.editor.getAttr("code")&&editor.readOnly&&(typeof window<"u"&&(window.labelbakerCanvas=editor),eval(editor.editor.getAttr("code")));const canvasScripts=editor.editor.getAttr("scripts");canvasScripts&&editor.readOnly&&(typeof window<"u"&&(window.labelbakerCanvas=editor),canvasScripts.forEach(s=>{let replacedCode=s.code.replace(/this\./g,"s.");eval(replacedCode)}))})}addElement(i,t,e,r){typeof i[e]=="function"&&(t.className==="Image"?(t.attrs.index=r,this.indexs.push(i[e](t.attrs))):t.className==="Group"?i[e](t):i[e](t.attrs))}makeFunctionName(i){if(i.attrs.hasOwnProperty("type"))return"add"+i.attrs.type.charAt(0).toUpperCase()+i.attrs.type.slice(1)}addFont(i){var t=document.getElementsByTagName("head")[0],e=document.createElement("link"),r=i.replace(" ","+");e.id=r,e.rel="stylesheet",e.type="text/css",e.href="https://fonts.googleapis.com/css?family="+r,e.media="all",t.appendChild(e)}}class Grid{constructor(t){this.editor=t,this.shadowRectangle=t.shadowRectangle}addGrid(){var t=this.editor.gridLayer;if(!this.editor.enableGrid){t.destroyChildren();return}var e=this.editor.editorWidth,r=this.editor.editorHeight,n=this.editor.blockSnapSize;t.destroyChildren();for(var a=n,o=0;o<e/a;o++)t.add(new Konva$1.Line({points:[Math.round(o*a),0,Math.round(o*a),r],stroke:"#ddd",strokeWidth:.5,draggable:!1,name:"gridLine"}));t.add(new Konva$1.Line({points:[0,0,10,10]}));for(var h=0;h<r/a;h++)t.add(new Konva$1.Line({points:[0,Math.round(h*a),e,Math.round(h*a)],stroke:"#ddd",strokeWidth:.5,draggable:!1,name:"gridLine"}));return this.shadowRectangle=this.editor.shadowRectangle,this.shadowRectangle.hide(),t.add(this.shadowRectangle),t.draw(),this.shadowRectangle}}class Ruler{constructor(t){this.editor=t}addRuler(){const t=this.editor.rulerLayer;if(!this.editor.enableRuler){t.destroyChildren();return}t.destroyChildren();const e=this.editor.rulerTickSize,r=this.editor.rulerTickSpacing,n=this.editor.rulerFontSize,a="sans-serif",o=this.editor.rulerFontColor;for(let h=0;h<=this.editor.editorWidth;h+=r){const l=new Konva$1.Line({points:[h,0,h,e],stroke:"#000",strokeWidth:.5,draggable:!1});t.add(l);const d=new Konva$1.Text({x:h,y:e+n,text:h,fontSize:n,fontFamily:a,fill:o,draggable:!1});t.add(d)}for(let h=0;h<=this.editor.editorHeight;h+=r){const l=new Konva$1.Line({points:[0,h,e,h],stroke:"#000",strokeWidth:.5,draggable:!1});t.add(l);const d=new Konva$1.Text({x:e+n,y:h,text:h,fontSize:n,fontFamily:a,fill:o,draggable:!1});t.add(d)}t.draw()}}class Selection{constructor(t){this.editor=t,this.stage=t.editor,this.tr=t.transform,this.layer=t.layer}addSelection(){let t=this.editor.editor,e=this.editor.transform,r=this.editor.layer,n=this;r.add(e);var a=new Konva$1.Rect({fill:"rgb(60 129 246 / 0.29)",visible:!1,name:"selectionRectangle"});this.editor.hiddenLayer.add(a);var o,h,l,d;t.on("mousedown touchstart",u=>{try{if((u.target.name()==="stageBackground"||u.target.attrs.type==="template")&&e.nodes([]),u.target.name()!=="stageBackground")return;u.evt.preventDefault(),o=t.getPointerPosition().x,h=t.getPointerPosition().y,l=t.getPointerPosition().x,d=t.getPointerPosition().y,a.visible(!0),a.width(0),a.height(0)}catch{}}),t.on("mousemove touchmove",u=>{try{if(!a.visible())return;u.evt.preventDefault(),l=parseInt(t.getPointerPosition().x),d=parseInt(t.getPointerPosition().y),a.setAttrs({x:Math.min(o,l)/t.scaleX(),y:Math.min(h,d)/t.scaleY(),width:Math.abs(l-o)/t.scaleX(),height:Math.abs(d-h)/t.scaleY()})}catch{}}),t.on("mouseup touchend",u=>{if(!!a.visible()){u.evt.preventDefault(),setTimeout(()=>{a.visible(!1)});try{var c=n.layer.find("Text,Rect,Circle,Image,Polygon,Star,RegularPolygon,Arc,Ellipse,Line"),f=a.getClientRect(),p=c.filter(g=>Konva$1.Util.haveIntersection(f,g.getClientRect())&&!this.editor.lockedItems.includes(g));setTimeout(()=>{e.nodes(p),p.length===1?n.editor.selectItem(p[0]):n.editor.selectItem(null)},100)}catch{}}})}}const change={changeText(i,t){i.text(t)},changeBarcodeBasic(i,t){return new Promise((e,r)=>{i.text("*"+t+"*"),e(t)})},changeBarcode(i,t){return console.log(t),new Promise((e,r)=>{var n="CODE39",a=t,o=!1;typeof t=="object"?(n=t.format,a=t.value,o=t.showValue):(n=i.attrs.format,o=i.attrs.displayValue);try{var h=document.createElement("canvas");JsBarcode_1(h,a,{format:n,displayValue:o});var l=h.toDataURL("image/png");let d=new Image;return d.crossOrigin="Anonymous",d.onload=()=>{i.image(d),e(d)},d.src=l,i.image(d),i.attrs.format=n,i.attrs.barcode=a,i.attrs.displayValue=o,{status:"success"}}catch(d){return r(d),{status:"error",message:d}}})},changeQrCode(i,t){return new Promise((e,r)=>{browser.toDataURL(t).then(n=>{let a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{i.image(a),e(n)},a.src=n,i.image(a),i.attrs.qrvalue=t})})},changeText(i,t){return new Promise((e,r)=>{i.text(t),e(t)})},changeImage(i,t){return new Promise((e,r)=>{try{let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{i.image(n),e(t)},n.src=t+"?"+Date.now(),i.image(n)}catch(n){r(n)}})}};class Printing{constructor(t){this.editor=t}getEditor(t){let e=this.editor.editor.clone(this.editor);return e.find(".gridLayer")[0].destroyChildren(),e.find(".rulerLayer")[0].destroyChildren(),e.find(".hiddenLayer")[0].destroyChildren(),this.changeQuality(e,t),e}print(t,e){const r=this,n=new r.editor.Print(t),a=e.sheetData,o=e.mappedData;let h=[],l=e.range.from,d=e.range.to;return a.forEach((u,c)=>{if(e.ignoreFirstRow&&c===0||e.dataSelection==="printSelectedData"&&e.selectedData.indexOf(c)===-1||e.dataSelection==="ignoreSelectedData"&&e.selectedData.indexOf(c)!==-1||e.dataSelection==="range"&&!(c+2>l&&c<d))return;let f=u,p=this.createLabel(this.getEditor(e),f,o,e);h.push(p.then(g=>{n.createLabel(g)}))}),Promise.all(h).then(u=>{n.doc.save("labels.pdf")})}async createLabel(t,e,r,n){let a=[];return r.forEach((o,h)=>{let l=o.elName,d=o.dataID;t.find("."+l).forEach(u=>{let c=e[d];c!=="none"&&a.push(this.changeElement(u,c))})}),Promise.all(a).then(o=>t.toDataURL({pixelRatio:n.printQuality}))}changeText(t,e){return new Promise((r,n)=>{t.text(e),r(e)})}changeElement(t,e){if(t.attrs.type==="text")return new Promise((r,n)=>{change.changeText(t,e).then(a=>{r(a)})});if(t.attrs.type==="qrcode")return new Promise((r,n)=>{this.changeQrCode(t,e).then(a=>{r(a)})});if(t.attrs.type==="image")return new Promise((r,n)=>{change.changeImage(t,e).then(a=>{r(a)})});if(t.attrs.type==="barcode")return new Promise((r,n)=>{change.changeBarcode(t,e).then(a=>{r(a)})});if(t.attrs.type==="barcodeBasic")return new Promise((r,n)=>{change.changeBarcodeBasic(t,e).then(a=>{r(a)})})}changeQrCode(t,e){return new Promise((r,n)=>{browser.toDataURL(e).then(a=>{let o=new Image;o.crossOrigin="Anonymous",o.onload=()=>{t.image(o),r(a)},o.src=a,t.image(o),t.attrs.qrvalue=e})})}changeQuality(t,e){var r=t.width(),n=e.cellWidth,a=e.cellHeight,o=r/n,h=n/r*o;t.width(n*h),t.height(a*h),t.scale({x:h,y:h})}}var H,Y;class LayoutMaker{constructor(t){W(this,H);this.stage=new Konva$1.Stage({container:t.container,width:t.pageWidth,height:t.pageHeight}),this.stage.getContent().style.background="white",this.doc=new Konva$1.Layer,this.config=t,this.pageWidth=t.pageWidth,this.pageHeight=t.pageHeight,this.pageMargin=t.pageMargin,this.pageMarginLeft=t.pageMarginLeft,this.pageMarginTop=t.pageMarginTop,this.cellPaddingLeft=t.cellPaddingLeft,this.cellPaddingTop=t.cellPaddingTop,this.pageWidth-=this.pageMargin*2,this.pageHeight-=this.pageMargin*2,this.cellPadding=t.cellPadding,this.cellWidth=t.cellWidth,this.cellHeight=t.cellHeight,this.startX=this.pageMarginLeft,this.startY=this.pageMarginTop,this.stage.add(this.doc),this.count=0}createLabel(t){var e=this.startX+this.cellWidth+this.cellPadding*2,r=this.startY+this.cellHeight+this.cellPadding*2;e<=this.pageWidth?(V(this,H,Y).call(this,t,this.startX+this.cellPadding,this.startY+this.cellPadding),this.startX=e+this.cellPaddingLeft):(r+this.cellHeight>this.pageHeight||(this.startY=r+this.cellPaddingTop),this.startX=this.pageMarginLeft,V(this,H,Y).call(this,t,this.startX+this.cellPadding,this.startY+this.cellPadding),this.startX=this.startX+this.cellWidth+this.cellPadding*2+this.cellPaddingLeft)}fitIntoContainer(){var t=document.querySelector("#"+this.config.container);this.containerWrapper&&(t=document.querySelector("#"+this.config.containerWrapper));var e=t.offsetWidth,r=this.pageWidth,n=this.pageHeight,a=e/r;this.stage.width(r*a),this.stage.height(n*a),this.stage.scale({x:a,y:a})}}H=new WeakSet,Y=function(t,e,r){this.count++;var n=new Konva$1.Rect({x:e,y:r,width:this.cellWidth,height:this.cellHeight,fill:"#3B82F6",stroke:"black",strokeWidth:4}),a=new Konva$1.Text({x:e,y:r,text:this.count,align:"center",verticalAlign:"middle",width:this.cellWidth,height:this.cellHeight,fill:"white",fontSize:20});this.doc.add(n),this.doc.add(a)};class URL{static showPointerCursor(t,e){e.attrs.url&&e.attrs.url.length>0&&(t.container().style.cursor="pointer")}static goToURL(t){t.attrs.url&&t.attrs.url.length>0&&window.open(t.attrs.url,"_blank")}}class InputField{constructor(t,e,r="input"){this.stage=t.editor,this.textNode=e,this.containerWrapper=t.containerWrapper,this.editor=t,this.inputType=r}apply(){const t=this.textNode,e=this.stage;t.hide();var r=t.absolutePosition(),n={x:e.container().offsetLeft+r.x,y:e.container().offsetTop+r.y},a=document.createElement(this.inputType);document.getElementById(this.containerWrapper).appendChild(a),a.value=t.text(),a.style.position="absolute",a.style.zIndex="9999999999999999",a.style.top=n.y+"px",a.style.left=n.x+"px",a.style.width=t.width()+"px",a.style.maxWidth=t.width()+"px",a.style.height=t.height()+"px",a.style.maxHeight=t.height()+"px",a.style.fontSize=t.fontSize()+"px",a.style.border="none",a.style.padding="0px",a.style.margin="0px",a.style.overflow="hidden",a.style.background="none",a.style.outline="none",a.style.resize="none",a.style.lineHeight=t.lineHeight(),a.style.fontFamily=t.fontFamily(),a.style.transformOrigin="left top",a.style.textAlign=t.align(),a.style.color=t.fill();const o=this.editor.editor.scaleX(),h=this.editor.editor.scaleY();a.style.transform=`scaleX(${o}) scaleY(${h})`,a.style.height="auto",a.style.height=a.scrollHeight+3+"px",a.focus();function l(){a.parentNode.removeChild(a),window.removeEventListener("click",u),t.show()}function d(c){c||(c=t.placeholder.length*t.fontSize());var f=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),p=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(f||p)&&(c=Math.ceil(c));var g=document.documentMode||/Edge/.test(navigator.userAgent);g&&(c+=1),a.style.width=c+"px"}a.addEventListener("keydown",function(c){c.keyCode===13&&!c.shiftKey&&(t.text(a.value),l()),c.keyCode===27&&l()}),a.addEventListener("keydown",function(c){const f=t.getAbsoluteScale().x;d(t.width()*f),a.style.height="auto",a.style.height=a.scrollHeight+t.fontSize()+"px"});function u(c){c.target!==a&&(t.text(a.value),l())}setTimeout(()=>{window.addEventListener("click",u)})}}/*!
 * VERSION: 0.1
 * 
 * Original Work: GreenSock. (Jack Doyle, jack@greensock.com)
 * Updated work: Anton Lavrenov
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 */var _gsScope=typeof module<"u"&&module.exports&&typeof global<"u"?global:globalThis||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){var i={scale:1,shadowOffset:1,fillPatternOffset:1,offset:1,fill:2,stroke:2,shadowColor:2},t={},e={},r=/(\d|\.)+/g,n=/(?:_cw|_ccw|_short)/,a=_gsScope._gsDefine.globals.com.greensock.plugins,o={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},h=function(A,S,w){return A=A<0?A+1:A>1?A-1:A,(A*6<1?S+(w-S)*A*6:A<.5?w:A*3<2?S+(w-S)*(2/3-A)*6:S)*255+.5|0},l=function(A){if(A===""||A==null||A==="none")return o.transparent;if(o[A])return o[A];if(typeof A=="number")return[A>>16,A>>8&255,A&255];if(A.charAt(0)==="#")return A.length===4&&(A="#"+A.charAt(1)+A.charAt(1)+A.charAt(2)+A.charAt(2)+A.charAt(3)+A.charAt(3)),A=parseInt(A.substr(1),16),[A>>16,A>>8&255,A&255];if(A.substr(0,3)==="hsl"){A=A.match(r);var S=Number(A[0])%360/360,w=Number(A[1])/100,y=Number(A[2])/100,b=y<=.5?y*(w+1):y+w-y*w,O=y*2-b;return A.length>3&&(A[3]=Number(A[3])),A[0]=h(S+1/3,O,b),A[1]=h(S,O,b),A[2]=h(S-1/3,O,b),A}for(var T=A.match(r)||o.transparent,P=T.length;--P>-1;)T[P]=Number(T[P]);return T},d=function(A,S,w,y){this.getter=S,this.setter=w;var b=l(A[S]());this.proxy={r:b[0],g:b[1],b:b[2],a:b.length>3?b[3]:1},y&&(this._next=y,y._prev=this)},u=[],c,f,p=function(){var A=u.length;if(A!==0){for(;--A>-1;)u[A].draw(),u[A]._gsDraw=!1;u.length=0}else c.removeEventListener("tick",p),f=!1},g=function(A,S){var w=S==="x"?"y":"x",y="_gs_"+A;t[A]=function(){return this["get"+A]()[S]},e[A]=function(b){var O=this["get"+A](),T=this[y];return T||(T=this[y]={}),T[S]=b,T[w]=O[w],this[A](T),this}},_=function(A,S){return function(w){return arguments.length?S(w):A()}},v=function(A,S){var w=[],y,b,O,T;for(y in S)if(b=S[y],y!=="bezier"&&y!=="autoDraw"&&y.substr(0,3)!=="set"&&A[y]===void 0&&(w.push(y),delete S[y],y="set"+y.charAt(0).toUpperCase()+y.substr(1),S[y]=b),i[y]){if(i[y]===1)return S[y+"X"]=S[y+"Y"]=S[y],delete S[y],v(A,S);!A[y]&&e[y]&&(T=A.prototype||A,T[y]=_(t[y],e[y]))}else if(y==="bezier")for(b=b instanceof Array?b:b.values||[],O=b.length;--O>-1;)O===0?w=w.concat(v(A,b[O])):v(A,b[O]);return w},E=function(A){var S={},w;for(w in A)S[w]=A[w];return S},C;for(C in i)i[C]===1&&(g(C,"x"),g(C,"y"));var m=_gsScope._gsDefine.plugin({propName:"konva",API:2,version:"0.1",init:function(A,S,w){var y,b,O,T,P,R;this._overwriteProps=v(A,S),this._target=A,this._layer=S.autoDraw!==!1?A.getLayer():null,!c&&this._layer&&(c=w.constructor.ticker);for(y in S){if(b=S[y],i[y]===2)T=this._firstSP=new d(A,y,y,this._firstSP),b=l(b),T.proxy.r!==b[0]&&this._addTween(T.proxy,"r",T.proxy.r,b[0],y),T.proxy.g!==b[1]&&this._addTween(T.proxy,"g",T.proxy.g,b[1],y),T.proxy.b!==b[2]&&this._addTween(T.proxy,"b",T.proxy.b,b[2],y),(b.length>3||T.proxy.a!==1)&&T.proxy.a!==b[3]&&this._addTween(T.proxy,"a",T.proxy.a,b.length>3?b[3]:1,y);else if(y==="bezier"){if(P=a.BezierPlugin,!P)throw"BezierPlugin not loaded";P=this._bezier=new P,typeof b=="object"&&b.autoRotate===!0&&(b.autoRotate=["x","y","rotation",0,!1]),P._onInitTween(A,b,w),this._overwriteProps=this._overwriteProps.concat(P._overwriteProps),this._addTween(P,"setRatio",0,1,y)}else if((y==="rotation"||y==="rotationDeg")&&typeof b=="string"&&n.test(b)){if(R=a.DirectionalRotationPlugin,!R)throw"DirectionalRotationPlugin not loaded";R=this._directionalRotation=new R,O={useRadians:!1},O[y]=b,R._onInitTween(A,O,w),this._addTween(R,"setRatio",0,1,y)}else b instanceof Array?this._initArrayTween(A[y](),b,y):y!=="autoDraw"&&(O="get"+y.substr(3),this._addTween(A,y,(typeof A[y]=="function"?A[O!=="get"&&typeof A[O]=="function"?O:y]():A[y])||0,b,y));this._overwriteProps.push(y)}return!0},kill:function(A){return A=E(A),v(this._target,A),this._bezier&&this._bezier._kill(A),this._directionalRotation&&this._directionalRotation._kill(A),this._super._kill.call(this,A)},round:function(A,S){return A=E(A),v(this._target,A),this._bezier&&this._bezier._roundProps(A,S),this._super._roundProps.call(this,A,S)},set:function(A){this._super.setRatio.call(this,A);var S=this._firstSP,w=this._layer,y=this._arrayTweens,b,O,T,P,R,x;if(S)for(R=this._target;S;)x=S.proxy,R[S.setter]((x.a!==1?"rgba(":"rgb(")+(x.r|0)+", "+(x.g|0)+", "+(x.b|0)+(x.a!==1?", "+x.a:"")+")"),S=S._next;if(y){for(b=y.length;--b>-1;)O=y[b],P=O.s+O.c*A,O.a[O.i]=P<1e-6&&P>-1e-6?0:P;for(T in this._arrayProps)this._target[T](this._arrayProps[T])}w&&!w._gsDraw&&(u.push(w),w._gsDraw=!0,f||(c.addEventListener("tick",p),f=!0))}});C=m.prototype,C._initArrayTween=function(A,S,w){this._arrayTweens||(this._arrayTweens=[],this._arrayProps={});for(var y=A.length,b=this._arrayTweens,O,T;--y>-1;)O=A[y],T=S[y],O!==T&&b.push({a:A,i:y,s:O,c:T-O});b.length&&(this._arrayProps[w]=A)}});_gsScope._gsDefine&&_gsScope._gsQueue.pop()();function applyAnimation(i,t,e,r,n=1){if(e==="--None--"){for(let o=0;o<window.lableBakerIntervals.length;o++)clearInterval(window.lableBakerIntervals[o]);return}({leftToRight:(o,h)=>{let l=h;l?l=h:l=1;let d=o.attrs.x,u=o.attrs.y;o.position({x:0,y:u}),o.to({x:d,duration:l})},rotateExitRight:(o,h)=>{let l=o.attrs.x,d=o.attrs.y,u=new Konva$1.Animation(f=>{o.rotation(f.time%360)},t),c=new Konva$1.Animation(f=>{o.x(l+f.time)},t);u.start(),c.start(),setTimeout(()=>{u.stop(),c.stop(),o.setAttrs({x:l,y:d,rotation:0}),t.draw()},2e3)},fadeInItem:(o,h)=>{!h&&(h=1),o.attrs,o.opacity(0),new Konva$1.Tween({node:o,easing:Konva$1.Easings.EaseIn,duration:h,opacity:1}).play()},easingLeftToRight:(o,h)=>{!h&&(h=1);let l=o.attrs.x,d=o.attrs.y;o.position({x:-o.attrs.x/2,y:d}),o.tween=new Konva$1.Tween({node:o,x:l,easing:Konva$1.Easings.StrongEaseOut,duration:h}),o.tween.play()},spellTowardsTheScreen:(o,h)=>{!h&&(h=1),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.StrongEaseIn,duration:h,scaleX:12,scaleY:12,opacity:0,onFinish:function(){o.tween.reset()}}),o.tween.play()},shrinkToCanvas:(o,h)=>{!h&&(h=1),o.scale({x:12,y:12}),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.StrongEaseOut,duration:h,scaleX:1,scaleY:1,opacity:1}),o.tween.play()},opacityFadeOut:(o,h)=>{!h&&(h=1),o.tween=new Konva$1.Tween({node:o,duration:h,opacity:0,onFinish:function(){o.tween.reset()}}),o.tween.play()},opacityFadeIn:(o,h)=>{!h&&(h=1),o.opacity(0),o.tween=new Konva$1.Tween({node:o,duration:h,opacity:1}),o.tween.play()},typewriting:(o,h)=>{if(o.attrs.type!="text")return;const l=o.getText();let d=0;function u(){d<=l.length&&(o.setAttrs({text:l.substr(0,d)}),t.draw(),d++,setTimeout(u,50))}u()},blurFadeIn:(o,h)=>{!h&&(h=.6),o.blurRasdius(0),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.EaseInOut,duration:h,blurRadius:10,onFinish:function(){o.filters([]),o.blurRadius(0),t.add(o),i.add(t)}}).play(),o.cache(),o.filters([Konva$1.Filters.Blur]),t.add(o),i.add(t)},fallingAndBouncing:(o,h)=>{!h&&(h=1);let l=o.attrs.x,d=o.attrs.y;o.position({x:i.width()/2,y:0}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.BounceEaseOut,duration:h}),o.tween.play()},twistyFallingAndBouncing:(o,h)=>{!h&&(h=1);let l=o.attrs.x,d=o.attrs.y;o.rotate(-30),o.position({x:i.width()/2,y:0}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.BounceEaseOut,duration:h}),o.tween.play(),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.EaseInOut,duration:h,rotation:0}),o.tween.play()},backEasingMiddleToTop:(o,h)=>{!h&&(h=.55);let l=o.attrs.x,d=o.attrs.y;o.position({x:i.width()/2,y:i.height()}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.BackEaseOut,duration:h}),o.tween.play()},middleToTopAndRotateClassicNegative:(o,h)=>{!h&&(h=1);let l=o.attrs.x,d=o.attrs.y;o.rotate(-30),o.opacity(0),o.position({x:i.width()/2,y:i.height()}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.StrongEaseOut,duration:h,rotation:0,opacity:1}),o.tween.play()},middleToTopAndRotateClassicPositive:(o,h)=>{!h&&(h=1);let l=o.attrs.x,d=o.attrs.y;o.rotate(30),o.opacity(0),o.position({x:i.width()/2,y:i.height()}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.StrongEaseOut,duration:h,rotation:0,opacity:1}),o.tween.play()},middleToTopAndRotateNegative:(o,h)=>{!h&&(h=1.45);let l=o.attrs.x,d=o.attrs.y;o.rotate(-30),o.opacity(0),o.position({x:i.width()/2,y:i.height()}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.ElasticEaseOut,duration:h,rotation:0,opacity:1}),o.tween.play()},middleToTopAndRotatePositive:(o,h)=>{!h&&(h=1.45);let l=o.attrs.x,d=o.attrs.y;o.rotate(30),o.opacity(0),o.position({x:i.width()/2,y:i.height()}),o.tween=new Konva$1.Tween({node:o,x:l,y:d,easing:Konva$1.Easings.ElasticEaseOut,duration:h,rotation:0,opacity:1}),o.tween.play()},twistyRotatedRightToTheLeft:(o,h)=>{!h&&(h=.8);let l=o.attrs.x,d=o.attrs.y;o.rotate(30),o.position({x:i.width(),y:d}),o.tween=new Konva$1.Tween({node:o,x:l,easing:Konva$1.Easings.BackEaseOut,duration:h}),o.tween.play(),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.ElasticEaseOut,duration:h+1.5,rotation:0}),o.tween.play()},centeredResizingAndRotationingOnTheMiddle:(o,h)=>{!h&&(h=.8),o.scale({x:0,y:0}),o.rotate(30),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.BackEaseOut,duration:h,scaleX:1,scaleY:1,rotation:0}),o.tween.play()},centeredResizingOnTheMiddle:(o,h)=>{!h&&(h=.8),o.scale({x:0,y:0}),o.tween=new Konva$1.Tween({node:o,easing:Konva$1.Easings.BackEaseOut,duration:h,scaleX:1,scaleY:1}),o.tween.play()},easingRightToTheLeft:(o,h)=>{!h&&(h=1.5);let l=o.attrs.x,d=o.attrs.y;o.position({x:i.width()+o.attrs.x/2,y:d}),o.tween=new Konva$1.Tween({node:o,x:l,easing:Konva$1.Easings.StrongEaseOut,duration:h}),o.tween.play()},strobeLightEffectForText:(o,h)=>{const l=new TimelineLite;let d=0,c=setInterval(()=>{d++,l.to(o,.1,{konva:{shadowColor:"red",strokeWidth:5,shadowBlur:.2,shadowOffsetX:4,shadowOffsetY:0,shadowOpacity:.5},ease:Konva$1.Easings.Linear}).to(o,.1,{konva:{shadowColor:"black",strokeWidth:5,shadowBlur:.2,shadowOffsetX:-4,shadowOffsetY:4,shadowOpacity:.5},ease:Konva$1.Easings.Linear}).to(o,.1,{konva:{shadowColor:"blue",strokeWidth:5,shadowBlur:.2,shadowOffsetX:0,shadowOffsetY:-4,shadowOpacity:.5},ease:Konva$1.Easings.Linear}).to(o,.1,{konva:{shadowColor:"red",strokeWidth:5,shadowBlur:.2,shadowOffsetX:4,shadowOffsetY:4,shadowOpacity:.5},ease:Konva$1.Easings.Linear}).to(o,.1,{konva:{shadowColor:"green",strokeWidth:5,shadowBlur:.2,shadowOffsetX:0,shadowOffsetY:-4,shadowOpacity:.5},ease:Konva$1.Easings.Linear}),d%3===0&&l.to(o,.1,{konva:{shadowColor:"green",strokeWidth:5,shadowBlur:.2,shadowOffsetX:4,shadowOffsetY:-4,shadowOpacity:.5,scaleY:1.1},ease:Konva$1.Easings.Linear}).to(o,.1,{konva:{scaleY:1,shadowColor:"green",strokeWidth:5,shadowBlur:.2,shadowOffsetX:0,shadowOffsetY:-4,shadowOpacity:.5},ease:Konva$1.Easings.Linear})},500);window.lableBakerIntervals.push(c)},flipinX:(o,h)=>{o.opacity(1),new TimelineLite().to(o,.1,{konva:{opacity:0},onComplete:()=>{o.setAttr("scaleY",0)}}).to(o,1,{konva:{scaleY:1,opacity:1},ease:Konva$1.Easings.ElasticEaseOut})},flipOutX:(o,h)=>{o.opacity(1),new TimelineLite().to(o,.3,{konva:{scaleY:2*Math.PI*.01,opacity:.1,rotation:1},ease:Konva$1.Easings.BackEaseIn}).to(o,.3,{konva:{opacity:1,scaleY:1}})},zoomOutDown:(o,h)=>{const l=new TimelineLite;let d=o.attrs.x,u=o.attrs.y;l.to(o,.5,{konva:{x:i.width()/2,y:i.height()/2-10,scale:.5,opacity:1},ease:Konva$1.Easings.BackEaseInOut}).to(o,.8,{konva:{x:i.width()/2,y:100*Math.cos(4*Math.PI/1e3)+i.height()/2+50,scale:0},ease:Konva$1.Easings.EaseIn}).to(o,.2,{konva:{x:d,y:u,scale:1}})},pulse:(o,h)=>{new TimelineLite().to(o,.4,{konva:{scale:1.1}}).to(o,.4,{konva:{scale:1}})},jello:(o,h)=>{new TimelineLite().to(o,.3,{konva:{rotation:-5,scaleY:1.5}}).to(o,.1,{konva:{rotation:4,scaleY:.8}}).to(o,.1,{konva:{rotation:-3,scaleY:1}}).to(o,.1,{konva:{rotation:2}}).to(o,.1,{konva:{rotation:-1}}).to(o,.1,{konva:{rotation:0}})},tada:(o,h)=>{const l=new TimelineLite;l.to(o,.2,{konva:{rotation:-2,scale:.8}}).to(o,.1,{konva:{rotation:2,scale:1.1}});for(let d=0;d<4;d++)l.to(o,.1,{konva:{rotation:-2}}).to(o,.1,{konva:{rotation:2}});l.to(o,.1,{konva:{rotation:0,scale:1}})},spring:(o,h)=>{o.opacity(0),o.attrs.text,o.setAttr("offsetX",0),o.scaleX(1.2),new TimelineLite().to(o,1,{konva:{opacity:.7,offsetX:o.width()/2,scaleX:1},onComplete:()=>{o.setAttr("opacity",1)}}).to(o,1,{delay:2,konva:{scaleX:1.2,opacity:0,offsetX:o.width()}}).to(o,0,{delay:.5,konva:{opacity:1,offsetX:o.width()/2,scaleX:1}})}})[e](r,n)}class ConvertToHTML{constructor(t){this.editor=t}export(){this.generateHTML(this.editor)}generateContent(t){let e="",r="";return t.attrs.type==="text"&&(r+=t.text()),t.attrs.type==="line"&&(r+=`<img src="${t.toDataURL()}" style="${this.generateCSS(t.attrs)}" />`),e+=`<div style="${this.generateCSS(t.attrs)}">${r}</div>`,t.attrs.type==="image"&&(e=`<img src="${t.attrs.imageSrc}" style="${this.generateCSS(t.attrs)}" />`),e}generateHTML(t){let e="";this.filterList(t.layer.children).forEach(a=>{if(a.attrs.type==="group"){let o=`<div style="${this.generateCSS(a.attrs)}">`;a.children.forEach(h=>{o+=this.generateContent(h)}),e+=o}e+=this.generateContent(a)});let n=`<div style="width:${t.editorWidth}px;height:${t.editorHeight}px;background:${t.background.fill()}">${e}</div>`;console.log(n)}generateCSS(t){console.log(t);let e=`position:absolute;left:${t.x}px;top:${t.y}px;`;return t!=null&&t.fill&&(t.type==="text"?e+=this.textCSS(t):e+=`background-color:${t.fill};`),(t==null?void 0:t.width)&&(t==null?void 0:t.height)&&(e+=`width:${t.width}px; height:${t.height}px;`),console.log(t),e}textCSS(t){let e="";return e+=`font-size:${t.fontSize}px;`,e+=`color:${t.fill};`,t!=null&&t.fontFamily&&(e+=`font-family:${t.fontFamily} ;`),e}filterList(t){return t.filter(e=>e.getClassName()!=="Transformer"&&e.name()!=="guid-line"&&e.name()!=="anchor")}}class Editor{constructor(t){this.templateName="",this.templateId="",this.editorHeight=t.height,this.editorWidth=t.width,this.pageWidth=t.pageWidth,this.pageHeight=t.pageHeight,this.container=t.container,this.containerWrapper=t.containerWrapper,this.readOnly=t.readOnly,this.core=Konva$1,this.Konva=Konva$1,this.elements=[],this.selected=null,this.eventName="editor_element_change",this.eventSelected="editor_selected_element",this.changeEvent=new CustomEvent(this.eventName),this.selectEvent=new CustomEvent(this.eventSelected),this.blockSnapSize=10,this.lockedItems=[],this.act="browser",this.groupCount=0,this.copiedStyle=null,this.defaultConfiguration=configuration,this.medias=[],window.lableBakerIntervals=[],this.act==="browser"?this.editor=new Konva$1.Stage({height:this.editorHeight,width:this.editorWidth,container:this.container}):this.editor=new Konva$1.Stage({height:this.editorHeight,width:this.editorWidth}),this.editor.setAttr("type","stage"),this.enableGrid=!1,this.enableRuler=!1,this.backgroundLayer=new Konva$1.Layer,this.backgroundLayer.name("backgroundLayer"),this.editor.add(this.backgroundLayer),this.background=new Konva$1.Rect({x:0,y:0,width:this.editorWidth,height:this.editorHeight,fill:"#ffffffff",name:"stageBackground",type:"background"}),this.background.on("click tap",()=>{this.deselect()}),this.backgroundLayer.add(this.background),this.gridLayer=new Konva$1.Layer,this.gridLayer.name("gridLayer"),this.editor.add(this.gridLayer),this.rulerLayer=new Konva$1.Layer,this.rulerLayer.name("rulerLayer"),this.editor.add(this.rulerLayer),this.layer=new Konva$1.Layer,this.layer.name("mainLayer"),this.editor.add(this.layer),this.hiddenLayer=new Konva$1.Layer,this.hiddenLayer.name("hiddenLayer"),this.editor.add(this.hiddenLayer),this.grid=new Grid(this),this.shadowRectangle=new Konva$1.Rect({x:0,y:0,width:this.blockSnapSize*6,height:this.blockSnapSize*3,fill:"#FF7B17",opacity:.6,stroke:"#CF6412",strokeWidth:1,dash:[5,2],name:"shadowBox"}),this.marker=new Konva$1.Rect({x:0,y:0,width:0,height:0,fill:"#FF7B17",opacity:.6,name:"marker"}),this.hiddenLayer.add(this.marker),this.grid.addGrid(),this.rulerTickSize=4,this.rulerTickSpacing=10,this.rulerFontSize=2,this.rulerFontColor="#333",this.ruler=new Ruler(this),this.ruler.addRuler(),this.transform=new Konva$1.Transformer({shouldOverdrawWholeArea:!0,ignoreStroke:!0,padding:10}),this.transform.name("transform"),snapping(this.editor,this.layer,this.transform),this.layer.add(this.transform),this.QRCode=browser,this.Barcode=JsBarcode_1,this.Print=Print,this.Sheet=Sheet,this.InputField=InputField,this.anim=new Konva$1.Animation(function(){},this.layer),this.readOnly||(this.Features=new Features(this),this.Selection=new Selection(this),this.Selection.addSelection(),this.History=new History(this)),this.Naming=new Naming(this),this.ImportData=new DataImport(this),this.Printing=new Printing(this),this.LayoutMaker=LayoutMaker,this.ConvertToHTML=new ConvertToHTML(this)}mark(t){this.marker.x(t.x()),this.marker.y(t.y()),this.marker.height(t.height()),this.marker.width(t.width())}resetMark(){this.marker.x(0),this.marker.y(0),this.marker.height(0),this.marker.width(0)}undo(){this.History.undo()}selectAll(){let t=[];this.layer.children.forEach(e=>{e.getClassName()!=="Transformer"&&t.push(e)}),this.transform.nodes(t)}hideAnchor(){this.editor.find(".anchor").forEach(t=>{t.hide()})}backToOrginalSize(){this.editor.width(this.editorWidth/this.editor.scaleX()),this.editor.height(this.editorHeight/this.editor.scaleY()),this.editor.scale({x:1,y:1})}fitIntoContainer(t="fit"){var e=document.querySelector("#preview-canvas-holder");this.containerWrapper&&(e=document.querySelector("#"+this.containerWrapper));var r=e.offsetWidth,n=e.offsetHeight,a=this.editorWidth,o=this.editorHeight;if(t==="fit")if(a>o)var h=r/a;else var h=n/o;else var h=r/a;this.editor.width(a*h),this.editor.height(o*h),this.editor.scale({x:h,y:h}),this.background.width(this.editorWidth),this.background.height(this.editorHeight)}zoom(t){var e=document.querySelector("#preview-canvas-holder");this.containerWrapper&&(e=document.querySelector("#"+this.containerWrapper));var r=e.offsetWidth,n=this.editorWidth,a=this.editorHeight,o=r/n+t;this.editor.width(n*o),this.editor.height(a*o),this.editor.scale({x:o,y:o})}addText(t){const e=Text(t);return this.add(e),e}addRect(t){const e=Rect(t);return this.add(e),e}getShape(t){return{clipFunc:e=>{e.arc(0,0,30,0,Math.PI*2,!1)},type:"shape",x:0,y:0,width:100,height:100,draggable:!0}}addShape(t){this.isEmpty(t)&&(t={});var e=new Konva$1.Group(this.getShape(t));let r=this.addTriangle({});e.add(r),this.add(e)}addTriangle(t){this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize(),this.getSize()),y:this.getYCenter(this.getSize(),this.getSize()),sides:3,radius:this.getSize(),fill:Konva$1.Util.getRandomColor(),stroke:Konva$1.Util.getRandomColor(),strokeWidth:0,draggable:!0,strokeScaleEnabled:!1,type:"triangle"});var e=new Konva$1.RegularPolygon(t);return this.add(e),e}addPolygon(t){this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize(),this.getSize()),y:this.getXCenter(this.getSize(),this.getSize()),sides:6,radius:this.getSize(),fill:Konva$1.Util.getRandomColor(),stroke:Konva$1.Util.getRandomColor(),strokeWidth:0,draggable:!0,strokeScaleEnabled:!1,type:"polygon"});var e=new Konva$1.RegularPolygon(t);return this.add(e),e}addOval(t){this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize(),this.getSize()),y:this.getXCenter(this.getSize(),this.getSize()),radiusX:this.getSize()/2,radiusY:this.getSize(),fill:Konva$1.Util.getRandomColor(),stroke:Konva$1.Util.getRandomColor(),strokeWidth:0,strokeScaleEnabled:!1,draggable:!0,type:"oval"});var e=new Konva$1.Ellipse(t);return this.add(e),e}addArc(t){this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize()),y:this.getXCenter(this.getSize()),innerRadius:this.getSize()/2,outerRadius:this.getSize(),strokeScaleEnabled:!1,angle:300,fill:Konva$1.Util.getRandomColor(),stroke:Konva$1.Util.getRandomColor(),strokeWidth:0,draggable:!0,type:"arc"});var e=new Konva$1.Arc(t);return this.add(e),e}addStar(t){this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize()),y:this.getXCenter(this.getSize()),numPoints:6,innerRadius:this.getSize()/1.7,outerRadius:this.getSize(),fill:Konva$1.Util.getRandomColor(),stroke:Konva$1.Util.getRandomColor(),strokeScaleEnabled:!1,strokeWidth:4,draggable:!0,type:"star"});var e=new Konva$1.Star(t);return this.add(e),e}addCircle(t){const e=Circle(t);return this.add(e),e}addLine(t){this.isEmpty(t)&&(t={points:[10,10,this.getSize(),this.getSize()/2],stroke:Konva$1.Util.getRandomColor(),strokeWidth:this.getSize()/50,type:"line",draggable:!0});let e=new Konva$1.Line(t);this.add(e)}isEmpty(t){return Object.keys(t).length===0}clearIntervals(){if(!!window.lableBakerIntervals)for(let t=0;t<window.lableBakerIntervals.length;t++)clearInterval(window.lableBakerIntervals[t])}getSize(){let t=this.editorHeight/3;return this.editorHeight>this.editorWidth&&(t=this.editorWidth/3),t}getYCenter(t,e=0){return e>0&&(e=t/2),this.editorHeight/2-t/2+e}getXCenter(t,e=0){return e>0&&(e=t/2),this.editorWidth/2-t/2+e}createVideoElement(t){const e=document.createElement("video");return e.src=t,e.controls=!0,e.muted=!0,e.crossOrigin="anonymous",e}addMediaOptionsEvent(t,e){let r=null,n=0;if(t.progressBar){let a=this.editor.find("."+t.progressBar);a.length>0&&(r=a[0],n=r.width())}if(e.ontimeupdate=a=>{if(!!this.readOnly&&r){const o=e.currentTime/e.duration*n;r.width(o)}},t.playBtn){let a=this.editor.find("."+t.playBtn);a.length>0&&a[0].on("click",()=>{e.play()})}if(t.pauseBtn){let a=this.editor.find("."+t.pauseBtn);a.length>0&&a[0].on("click",()=>{e.pause()})}}addAudio(t,e=""){let r=e;this.isEmpty(t)||(r=t.audioSrc);const n=this.createVideoElement(r),a={x:50,y:50,type:"audio",image:n,draggable:!0,width:this.editorWidth/3,height:this.editorWidth/3};return new Promise((o,h)=>{n.onloadedmetadata=l=>{var f,p;let d=t;this.isEmpty(t)?d=a:t.image=n;var u=new Konva$1.Image(d);let c=this.calculateNewSize(n.videoWidth,n.videoHeight,u.width());u.width(c.width),u.height(c.height),u.setAttr("audioSrc",r),this.medias.push(n),u.hide(!0),this.add(u),n.play(),this.readOnly?(n.muted=(f=d==null?void 0:d.isMuted)!=null?f:!1,((p=d==null?void 0:d.isAutoPlay)==null||p)&&n.pause()):n.pause(),this.anim.start()},this.addMediaOptionsEvent(t,n),o()})}updateVideo(t,e){let r=t.attrs;r.type==="audio"&&(r.audioSrc=e),r.videoSrc=e,t.destroy();let n=JSON.parse(JSON.stringify(r));n.type==="audio"?this.addAudio(n):this.addVideo(n)}addVideo(t){let r="https://upload.wikimedia.org/wikipedia/commons/transcoded/c/c4/Physicsworks.ogv/Physicsworks.ogv.240p.vp9.webm";this.isEmpty(t)||(r=t.videoSrc);const n=this.createVideoElement(r),a={x:50,y:50,type:"video",image:n,draggable:!0,width:this.editorWidth/3,height:this.editorWidth/3};return new Promise((o,h)=>{n.onloadedmetadata=()=>{var c,f;let l=t;this.isEmpty(t)?l=a:t.image=n;var d=new Konva$1.Image(l);let u=this.calculateNewSize(n.videoWidth,n.videoHeight,d.width());d.width(u.width),d.height(u.height),d.setAttr("videoSrc",r),this.add(d),this.medias.push(n),n.play(),this.readOnly?(n.muted=(c=l==null?void 0:l.isMuted)!=null?c:!1,((f=l==null?void 0:l.isAutoPlay)==null||f)&&n.pause()):n.pause(),this.anim.start()},o()})}addImage(t){return new Promise((e,r)=>{if(this.isEmpty(t)){let h=configuration.placeHolderImage;var n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{var l=new Konva$1.Image({x:this.getXCenter(this.getSize()),y:this.getYCenter(this.getSize()),image:n,width:this.getSize(),height:this.getSize(),draggable:!0,strokeWidth:0,strokeScaleEnabled:!1,type:"image"});this.add(l),e(l)},n.src=h}else{let h=t.src;t.hasOwnProperty("imageSrc")&&(h=t.imageSrc),t.hasOwnProperty("src")&&(h=t.src);var n=new Image;n.crossOrigin="Anonymous";var a={x:t.x,y:t.y,image:n,width:t.width,height:t.height,draggable:!0,strokeWidth:0,type:"image"},o={...a,...t};n.onload=()=>{var d=new Konva$1.Image(o);this.add(d),e(d)},n.src=h}})}addSvg(t){return this.isEmpty(t)&&(t={type:"svg",imageSrc:configuration.svgPlaceholder}),Konva$1.Image.fromURL(t.imageSrc,e=>{e.setAttrs(t),e.draggable(!0),this.add(e),this.layer.draw()})}addPath(t){this.isEmpty(t)&&(t={x:10,y:10,data:"M213.1,6.7c-32.4-14.4-73.7,0-88.1,30.6C110.6,4.9,67.5-9.5,36.9,6.7C2.8,22.9-13.4,62.4,13.5,110.9C33.3,145.1,67.5,170.3,125,217c59.3-46.7,93.5-71.9,111.5-106.1C263.4,64.2,247.2,22.9,213.1,6.7z",fill:"green",scaleX:.1,scaleY:.1,type:"path",draggable:!0});let e=new Konva$1.Path(t);this.add(e)}calculateNewSize(t,e,r){var n=t/e,a=r/n;return{width:r,height:a}}updateImage(t,e,r={}){let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{let a=this.calculateNewSize(n.width,n.height,t.width());t.image(n),t.width(a.width),t.height(a.height),this.isEmpty(r)||t.setAttrs(r),t.setAttr("imageSrc",e)},n.src=e}addQrcode(t){return new Promise((e,r)=>{this.isEmpty(t)&&(t={x:this.getXCenter(this.getSize()),y:this.getYCenter(this.getSize()),width:this.getSize(),height:this.getSize(),type:"qrcode",qrvalue:"hello"}),browser.toDataURL(t.qrvalue,{errorCorrectionLevel:"H"}).then(n=>{let a=n;Konva$1.Image.fromURL(a,o=>{o.setAttrs(t),this.add(o),e(o)})}).catch(n=>{r(n)})})}addBarcodeBasic(t){return this.isEmpty(t)&&(t={type:"barcodeBasic",x:1,y:1,text:"*1234*",fontSize:this.editorWidth/10,fontFamily:"Libre Barcode 39",fill:"#000000",stroke:"#000000",strokeWidth:0,draggable:!0,strokeScaleEnabled:!1}),this.addText(t)}addBarcode(t){var e="1234",r="CODE39",n=!1;this.isEmpty(t)?t={x:this.getXCenter(this.getSize()),y:this.getYCenter(this.getSize()),width:this.getSize(),height:this.getSize()/2,draggable:!0,type:"barcode",barcode:e,displayValue:!1,format:"CODE39"}:e=t.barcode,r=t.format,n=t.displayValue;var a=document.createElement("canvas");JsBarcode_1(a,e,{format:r,displayValue:n});var o=a.toDataURL("image/png");let h=o;var l=new Image;l.crossOrigin="Anonymous",l.onload=()=>{t.image=l;var d=new Konva$1.Image(t);this.add(d)},l.src=h}lockUnlock(){if(this.lockedItems.includes(this.selected)){let t=this.lockedItems.indexOf(this.selected);t>-1&&this.lockedItems.splice(t,1),this.transform.nodes([this.selected]),this.selected.draggable(!0)}else this.lockedItems.push(this.selected),this.transform.nodes([]),this.selected.draggable(!1)}isLocked(){return this.lockedItems.includes(this.selected)}selectItem(t){this.selected=t,this.selectEvent.data=t,document.dispatchEvent(this.selectEvent)}add(t){t.on("click tap",()=>{this.onClick(t)}),t.on("dblclick dbltap",()=>{this.onDobleClick(t)}),t.on("mouseenter",()=>{this.onMouseenter(t)}),t.on("mouseleave",()=>{this.onMouseleave(t)}),this.onLoad(t)}manipulateTarget(t,e){var n;let r=t+"targetElements";(n=e.attrs)!=null&&n[r]&&e.attrs[r].forEach(o=>{this.applyAction(o)})}applyAction(t){this.layer.find(`.${t.name}`).forEach(e=>{let r=t.action[0];r&&r.src==="func"&&e.attrs[r.attr][r.value]()})}onDobleClick(t){t.attrs.type==="text"&&!this.readOnly&&new this.InputField(this,t,"textarea").apply()}onClick(t){var e,r;if(this.selected=t,this.selectEvent.data=t,this.selectItem(t),document.dispatchEvent(this.selectEvent),this.readOnly){if((e=t.attrs)!=null&&e.onClickAction)switch(t.attrs.onClickAction){case"showHide":this.showHide(t,"onclick_");break;case"goToLink":URL.goToURL(t);break}this.manipulateTarget("onclick_",t),(r=t.attrs)!=null&&r.onclickanimationEnable&&this.animate(t,"onclick"),t.attrs.type==="text"&&t.attrs.inputField&&new this.InputField(this,t).apply()}this.lockedItems.includes(t)?this.transform.nodes([]):this.readOnly||this.transform.nodes([t])}onMouseenter(t){var e,r;this.readOnly&&((e=t.attrs)!=null&&e.onClickAction&&(this.editor.container().style.cursor="pointer",URL.showPointerCursor(this.editor,t)),(r=t.attrs)!=null&&r.hoveranimationEnable&&this.animate(t,"hover"))}onMouseleave(t){var e;this.editor.container().style.cursor="default",this.readOnly&&(e=t.attrs)!=null&&e.hoveranimationEnable}onLoad(t){console.warn=()=>{},this.transform.zIndex(99999);let e=this.blockSnapSize,r=this.shadowRectangle;if(t.getAttr("name")?t.name(t.getAttr("name")):t.name(this.Naming.generateName(t.attrs.type)),t.draggable(!this.readOnly),this.elements.push(t),this.layer.add(t),this.readOnly||(this.transform.nodes([t]),this.selected=t,this.selectEvent.data=t,document.dispatchEvent(this.selectEvent),t.on("transform",function(){if(t.attrs.type!=="group"){if(this.attrs.type==="line"){const a=this.points(),o=[];for(var n=0;n<a.length/2;n++){const h={x:a[n*2]*this.scaleX(),y:a[n*2+1]*this.scaleY()};o.push(h.x,h.y)}this.points(o)}this.width(Math.max(1,this.width()*this.scaleX())),this.height(Math.max(1,this.height()*this.scaleY())),this.scaleX(1),this.scaleY(1)}}),t.on("dragstart",function(n){self.enableGrid&&(r.width(this.width()),r.height(this.height()),r.show(),r.moveToTop(),this.moveToTop())}),t.on("dragmove",function(){if(self.enableGrid){let n=Math.round(this.x()/e)*e,a=Math.round(this.y()/e)*e,o=t.attrs.type;try{o==="arc"||o==="star"?(n=n-t.outerRadius(),a=a-t.outerRadius()):o==="triangle"||o==="circle"||o==="polygon"?(n=n-t.radius(),a=a-t.radius()):o==="line"?(n=n+t.attrs.points[0],a=a+t.attrs.points[1]):o==="oval"&&(n=n-t.radiusX(),a=a-t.radiusY()),r.position({x:n,y:a})}catch{}}}),t.on("dragend",n=>{self.readOnly||this.History.addHistory(this.editor.toJSON()),self.enableGrid&&(this.position({x:Math.round(this.x()/e)*e,y:Math.round(this.y()/e)*e}),self.editor.batchDraw(),r.hide())}),t.on("transformstart",function(n){n.target.scaleX(),n.target.scaleY()}),t.on("transformend",n=>{this.readOnly||this.History.addHistory(this.editor.toJSON())})),this.readOnly){const n="common_";this.animate(t,n)}}showHide(t,e){var r;if((r=t.attrs)!=null&&r.onclick_showHideElements)for(let n of t.attrs[e+"showHideElements"]){const a=this.layer.find(o=>o.name()===n.name);a.length>0&&a.forEach(o=>{o[n.action]()})}}animation(t,e,r){applyAnimation(this.editor,this.layer,t,e,r)}animate(t,e){var n,a,o,h,l,d,u,c,f;if((a=(n=t.attrs)==null?void 0:n[e+"animationEnable"])!=null&&a){let p=(h=(o=t.attrs)==null?void 0:o[e+"animationType"])!=null?h:"default";if(p==="default"&&t.getAttr(e+"animation")&&this.animation(t.getAttr(e+"animation"),t),p==="custom"&&t.getAttr(e+"easing")&&t.attrs.easing!=="-None-"){let g={node:t,easing:Konva$1.Easings[t.getAttr(e+"easing")],duration:(d=(l=t.attrs)==null?void 0:l[e+"easingDuration"])!=null?d:2,onFinish:function(){var m,A;((A=(m=t.attrs)==null?void 0:m[e+"easingLoop"])!=null?A:!1)&&this.reverse()}},_={};(u=t.attrs)!=null&&u[e+"easingProperties"]&&(_=t.attrs[e+"easingProperties"]);let v={...g,..._};var r=new Konva$1.Tween(v);t.tween=r,((f=(c=t.attrs)==null?void 0:c[e+"easingStart"])!=null?f:0)!==0?setTimeout(()=>{t.tween.play()},parseInt(t.attrs[e+"easingStart"])*1e3):t.tween.play()}}}getElements(){return this.elements}getElement(t){return this.layer.children.filter(e=>e._id===t)}sheetToJson(t){var e=XLSX.utils.sheet_to_json(t,{header:1});return e}getSelected(){return this.selected}setEelement(t,e){let r=this.elements.filter(n=>n._id===parseInt(t));return r.length!==0&&r[0].text(e.text),this}moveUp(){const t=this.layer.find("Transformer");try{t[0]._nodes[0].moveUp()}catch{}}moveDown(){const t=this.layer.find("Transformer");try{t[0]._nodes[0].moveDown()}catch{}}clearAll(){this.clearEditor(),this.medias.forEach(t=>{t.pause()}),document.dispatchEvent(this.selectEvent)}clearEditor(){this.layer.children.forEach(t=>{setTimeout(()=>{t.getClassName()!=="Transformer"&&t.destroy()},100)}),this.backgroundLayer.children.forEach(t=>{setTimeout(()=>{t.name()!=="stageBackground"&&t.destroy()},100)}),this.transform.nodes([]),this.selectEvent.data=null}deleteSelected(){this.layer.find("Transformer");try{this.transform.nodes().forEach(t=>t.destroy()),this.transform.nodes([]),this.selectEvent.data=null,document.dispatchEvent(this.selectEvent)}catch{}}duplicateSelected(){this.layer.find("Transformer");try{let t=[];this.transform.nodes().forEach(e=>{let r=e.clone({x:e.x()+10,y:e.y()+10});r.name(r.name()+"_duplicate_"+Math.floor(Math.random()*(99-10+1)+10)),this.layer.add(r),t.push(r)}),this.selectItem(t),this.transform.nodes(t)}catch{}}copyStyle(){this.copiedStyle=JSON.parse(JSON.stringify(this.selected.getAttrs()))}filterStyle(t){let e=["name","image","id","x","y"];for(let r in t)(typeof this.selected[r]!="function"||e.includes(r))&&delete t[r];return t}pasteStyle(){if(this.selected){let t={...this.selected.attrs,...this.filterStyle(this.copiedStyle)};this.selected.setAttrs(t)}else alert("You can't paste style on multiple selection")}addGroup(t){return new Promise((e,r)=>{if(t!=null&&t.children){let n=new Konva$1.Group(t.attrs);this.groupCount++,n.name(t.attrs.name),t.children.forEach((o,h)=>{let l=this.ImportData.makeFunctionName(o);if(typeof this[l]=="function")try{o.attrs.type=="image"?this[l](o.attrs).then(d=>{n.add(d)}):n.add(this[l](o.attrs))}catch(d){console.log(d)}}),this.layer.add(n);let a=n;a.on("click tap",()=>{this.onClick(a)}),a.on("dblclick dbltap",()=>{this.onDobleClick(a)}),a.on("mouseenter",()=>{this.onMouseenter(a)}),a.on("mouseleave",()=>{this.onMouseleave(a)}),this.onLoad(a),e()}r()})}groupSelected(){try{let t=this.transform.nodes();if(t.length>1){this.groupCount++;let e=t[1],r=new Konva$1.Group({x:0,y:0,type:"group",draggable:!0});r.name("Group "+this.groupCount),t.forEach(n=>{r.add(n)}),r.on("click tap",()=>{this.selected=r,document.dispatchEvent(this.selectEvent)}),this.layer.add(r)}}catch{}}deselect(){this.resetMark(),this.transform.nodes([]),this.selectEvent.data=null,document.dispatchEvent(this.selectEvent)}getOriginalImage(t=1){let e=this.editor.clone(this);return e.width(this.editorWidth/e.scaleX()),e.height(this.editorHeight/e.scaleY()),e.toDataURL({pixelRatio:t})}save(t=3,e={},r=!1){this.deselect();let n=this.editor.clone(this);return n.find(".gridLayer")[0].destroyChildren(),n.find(".rulerLayer")[0].destroyChildren(),r&&n.find(".backgroundLayer")[0].destroyChildren(),n.toDataURL({pixelRatio:t})}downloadAsImage(){this.deselect();let t=this.save();this.downloadURI(t,"template.jpeg")}exportToURL(t,e=null){return new Promise((r,n)=>{this.deselect();let a=this.save();const o=new FormData;o.append("image_data",a),e&&o.append("additional_params",e),fetch(t,{method:"POST",body:o}).then(h=>h.json()).then(h=>{r(h)}).catch(h=>{n(h)})})}downloadAsTransparentImage(){this.deselect();let t=this.save(3,{},!0);this.downloadURI(t,"template.png")}getOrientation(){return this.editorWidth>this.editorHeight?"l":"p"}getFormat(){return[this.editorWidth,this.editorHeight]}downloadAsPDF(t=null){const e={pageWidth:this.editorWidth,pageHeight:this.editorHeight,cellWidth:this.editorWidth,cellHeight:this.editorHeight,cellPadding:0,pageMargin:0,pageMarginLeft:0,pageMarginTop:0,cellPaddingLeft:0,cellPaddingTop:0,docSize:{orientation:this.getOrientation(),unit:"pt",format:this.getFormat()}},r={canvasContainer:{cellWidth:this.editorWidth,cellHeight:this.editorHeight,numberOfCellPrint:1,printQuality:3}};if(t)return this.staticPrint(e,r,!0);this.staticPrint(e,r)}downloadURI(t,e){var r=document.createElement("a");r.download=e,r.href=t,document.body.appendChild(r),r.click(),document.body.removeChild(r)}saveImage(){let t=this.editor.clone(this);return t.find(".gridLayer")[0].destroyChildren(),t.find(".rulerLayer")[0].destroyChildren(),t.toDataURL({pixelRatio:3})}dynamicPrint(t,e){return this.Printing.print(t,e)}staticPrint(t,e,r=null){this.deselect();const n=new Print(t);var a=this.editor.clone(this);a.find(".gridLayer")[0].destroyChildren(),a.find(".rulerLayer")[0].destroyChildren();var o=a.width(),h=e.canvasContainer.cellWidth,l=e.canvasContainer.cellHeight,d=o/h,u=h/o*d;a.width(h*u),a.height(l*u),a.scale({x:u,y:u});for(var c=0;c<parseInt(e.canvasContainer.numberOfCellPrint);c++)n.createLabel(a.toDataURL({pixelRatio:e.canvasContainer.printQuality}));const f=n.doc;if(r)return f.output();f.save("labels.pdf")}}export{Editor as E,Konva$1 as K,change as c};
