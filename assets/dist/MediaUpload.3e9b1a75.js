import{h as y,U as u,a as b,o as p,c,b as l,q as m,P as g,j as h,x,Z as v,i as B,w as U,e as w}from"./index.d2b5948f.js";import{_ as C,s as k}from"./App.8a7f3b43.js";const T={props:["selected"],data(){return{stats:k,prompt:"",isBusy:!1,selectedMode:"uploader",imageUrl:null,activeClass:"bg-gray-200  rounded-md dark:bg-gray-800",canvasContainer:y,type:"image",uploaderText:"Upload Image",uploaderTitle:"Insert image",uploaderBtnTxt:"Use this image",format:"PNG,JPG"}},watch:{selected:function(s,e){this.changeText()}},methods:{removeBg(){if(!window.labelbakerBgRemover)return alert("Pro version not found");let s={model:"small",progress:(r,d,i)=>{console.log(`Downloading ${r}: ${d} of ${i}`)}},e=this.selected.getAttr("imageSrc");window.labelbakerBgRemover(e,s).then(r=>{this.uploadBlob(r)})},uploadBlob(s){let e={};((d,i)=>{const a=new FileReader;a.onload=o=>{const t=o.target.result;i(t)},a.readAsDataURL(d)})(s,d=>{const i=d.split(",")[1];let a=this.serverEndpoint+"/upload",o={base64Image:i};this.appMode==="noAuth"&&(a=this.exportURL,o={image_data:i}),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(t=>t.json()).then(t=>{this.isBusy=!1,this.appMode==="noAuth"?t.success?(this.canvasContainer.editor.updateImage(this.selected,t.imageUrl,e),this.stats.isBusy=!1):(u(t.message),this.stats.isBusy=!1):(this.canvasContainer.editor.updateImage(this.selected,t.imageUrl,e),this.stats.isBusy=!1)}).catch(t=>{this.isBusy=!1,u("Unable to upload image"),this.stats.isBusy=!1,console.error(t)})})},ai(){if(this.prompt.length===0)return alert("Write something");this.stats.isBusy=!0;async function s(e){return await(await fetch("https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-2",{headers:{Authorization:"Bearer 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"},method:"POST",body:JSON.stringify(e)})).blob()}s({inputs:this.prompt}).then(e=>{let r=e;this.uploadBlob(r)}).catch(e=>{console.log(e),this.stats.isBusy=!1})},changeText(){this.selected.attrs.type==="video"&&(this.uploaderText="Upload Video",this.format="MP4,webm",this.type="video",this.uploaderTitle="Insert video",this.uploaderBtnTxt="Use this video"),this.selected.attrs.type==="image"&&(this.uploaderText="Upload Image",this.format="PNG,JPG",this.type="image",this.uploaderTitle="Insert image",this.uploaderBtnTxt="Use this image"),this.selected.attrs.type==="audio"&&(this.uploaderText="Upload audio",this.format="mp3",this.type="audio",this.uploaderTitle="Insert audio",this.uploaderBtnTxt="Use this audio")},wpMedia(){if(this.appMode==="auth")return;const s=wp.media({title:this.uploaderTitle,library:{type:this.type},button:{text:this.uploaderBtnTxt},multiple:!1}).on("select",()=>{const e=s.state().get("selection").first().toJSON();this.selected.attrs.type==="image"&&this.canvasContainer.editor.updateImage(this.selected,e.url,{}),(this.selected.attrs.type==="video"||this.selected.attrs.type==="audio")&&this.canvasContainer.editor.updateVideo(this.selected,e.url)});s.open()},importMedia(){if(this.isBusy=!0,!this.imageUrl)return alert("Image URL required.");try{this.canvasContainer.editor.updateImage(this.selected,this.imageUrl,{}),this.selected.attrs.type==="image"&&this.canvasContainer.editor.updateImage(this.selected,this.imageUrl,{}),(this.selected.attrs.type==="video"||this.selected.attrs.type==="audio")&&this.canvasContainer.editor.updateVideo(this.selected,this.imageUrl),this.isBusy=!1}catch(s){this.isBusy=!1,console.log(s)}},setActiveClass(s){this.selectedMode=s},getActiveClass(s){return this.selectedMode===s?this.activeClass:""},fileUpload(s){const e=s.target.files[0];this.isBusy=!0;let r={};if(!["image/svg+xml","image/png","image/jpeg"].includes(e.type)){alert("File type not supported");return}if(e.type==="image/svg+xml"&&r.type=="svg",!e){alert("Please select an image file.");return}const i=new FileReader;i.addEventListener("load",a=>{const o=a.target.result.split(",")[1];let t=this.serverEndpoint+"/upload",f={base64Image:o};this.appMode==="noAuth"&&(t=this.exportURL,f={image_data:o}),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then(n=>n.json()).then(n=>{this.isBusy=!1,this.appMode==="noAuth"?n.success?this.canvasContainer.editor.updateImage(this.selected,n.imageUrl,r):u(n.message):this.canvasContainer.editor.updateImage(this.selected,n.imageUrl,r)}).catch(n=>{this.isBusy=!1,u("Unable to upload image"),console.error(n)})}),i.readAsDataURL(e)}},mounted(){this.changeText()}},M={class:"flex flex-col justify-center items-center w-full my-2"},I={class:"flex justify-between w-full py-2"},A={class:"flex flex-col justify-center items-center py-2"},P=l("p",{class:"text-sm text-gray-500 dark:text-gray-400"},[l("span",{class:"font-semibold"},"Click to upload")],-1),_={class:"text-xs text-gray-500 dark:text-gray-400"},j={key:1,class:"w-full flex flex-col justify-start items-start"};function S(s,e,r,d,i,a){const o=b("lable");return p(),c("div",null,[l("div",M,[l("div",I,[l("button",{class:m(["px-1 text-[12px] py-1",a.getActiveClass("uploader")]),onClick:e[0]||(e[0]=t=>a.setActiveClass("uploader"))},g(i.uploaderText),3),l("button",{class:m(["px-1 text-[12px] py-1",a.getActiveClass("url")]),onClick:e[1]||(e[1]=t=>a.setActiveClass("url"))},"From URL",2)]),i.selectedMode==="uploader"?(p(),c("label",{key:0,onClick:e[3]||(e[3]=(...t)=>a.wpMedia&&a.wpMedia(...t)),for:"dropzone-file",class:"flex flex-col justify-center items-center w-full bg-gray-50 rounded-lg border-2 border-gray-300 border-dashed cursor-pointer dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600"},[l("div",A,[P,l("p",_,g(this.format),1)]),s.appMode==="auth"?(p(),c("input",{key:0,onChange:e[2]||(e[2]=(...t)=>a.fileUpload&&a.fileUpload(...t)),id:"dropzone-file",type:"file",class:"hidden"},null,32)):h("",!0)])):h("",!0),i.selectedMode==="url"?(p(),c("div",j,[x(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.imageUrl=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-2 py-1 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",type:"text"},null,512),[[v,i.imageUrl]]),l("button",{onClick:e[5]||(e[5]=(...t)=>a.importMedia&&a.importMedia(...t)),class:"bg-blue-500 mt-2 px-2 py-1 text-white rounded-full"},"Import "+g(i.type),1)])):h("",!0),i.isBusy?(p(),B(o,{key:2,class:"w-full pt-2"},{default:U(()=>[w("Uploading...")]),_:1})):h("",!0)])])}const R=C(T,[["render",S]]);export{R as default};
